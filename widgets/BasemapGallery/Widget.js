//>>built
require({cache:{"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(f,k,h,q,e,t,u){f=f(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(e,f){e=e||{};e.layers||e.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=e.id;this.itemId=e.itemId;this.layers=
e.layers;this.title=e.title||"";this.thumbnailUrl=e.thumbnailUrl;this.basemapGallery=f},getLayers:function(f){if(this.layers)return this.layers;if(this.itemId)return f=t({url:(f||e.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:h.hitch(this,function(e,f){this.basemapGallery?this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item."):console.error("esri.dijit.Basemap: could not access basemap item.")})}),f.addCallback(h.hitch(this,
function(e,f){return e.baseMap?(this.layers=[],k.forEach(e.baseMap.baseMapLayers,function(e){this.layers.push(new u(e))},this),this.layers):(this.basemapGallery?this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item."):console.error("esri.dijit.Basemap: could not access basemap item."),[])})),f}});return q("extend-esri")&&h.setObject("dijit.Basemap",f,e),f})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,
k,h,q){f=f(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(e){e=e||{};e.url||e.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=e.url;this.type=e.type;this.isReference=!0===e.isReference;this.opacity=e.opacity;this.visibleLayers=e.visibleLayers;this.displayLevels=e.displayLevels;this.exclusionAreas=e.exclusionAreas;this.bandIds=e.bandIds;this.templateUrl=e.templateUrl;this.copyright=e.copyright;this.subDomains=e.subDomains;
this.fullExtent=e.fullExtent;this.initialExtent=e.initialExtent;this.tileInfo=e.tileInfo;this.tileServers=e.tileServers;this.styleUrl=e.styleUrl}});return h("extend-esri")&&k.setObject("dijit.BasemapLayer",f,q),f})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(f,k,h,q,e,t,u,z,A,v,w,p,r,x,m,g,a,b,d,l,y,D,B,K,E,F,L,G,M,H,I,J,N,O,P){k=k([O,m,g],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:P,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(c,b){c=c||{};c.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=c.map;this._hasUI=!!b;this.bingMapsKey=c.bingMapsKey&&0<c.bingMapsKey.length?c.bingMapsKey:null;this.showArcGISBasemaps=!1!==c.showArcGISBasemaps;this.basemaps=c.basemaps||[];this.basemapIds=c.basemapIds;this.referenceIds=c.referenceIds;this.basemapsGroup=c.basemapsGroup;this.arcgisUrl=a.dijit._arcgisUrl;c.portalUrl&&(this.arcgisUrl=c.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=d.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);h.forEach(this.basemaps,function(c){c.id&&0!==c.id.length||(c.id=this._getUniqueId());h.forEach(c.layers,function(c){c.opacity=0<=c.opacity?c.opacity:1;c.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&h.forEach(this.basemapIds,function(c){this.map.getLayer(c)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&h.forEach(this.referenceIds,
function(c){c=this.map.getLayer(c);c._basemapGalleryLayerType="reference";c.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(e.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(e.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup();this._checkVTLSupport().then(e.hitch(this,function(c){this._supportsVTL=c}))},startup:function(){this.loaded?
this._refreshUI():q.connect(this,"onLoad",e.hitch(this,function(){this._refreshUI()}))},select:function(c){this._select(c)},getSelected:function(){return this._selectedBasemap},get:function(c){var a;for(a=0;a<this.basemaps.length;a++)if(this.basemaps[a].id===c)return this.basemaps[a];return null},add:function(c){return c&&!c.id?(c.id=this._getUniqueId(),this.basemaps.push(c),this._refreshUI(),this.onAdd(c),!0):!(!c||!this._isUniqueId(c.id))&&(this.basemaps.push(c),this._refreshUI(),this.onAdd(c),
!0)},remove:function(c){var a;for(a=0;a<this.basemaps.length;a++){var b=this.basemaps[a];if(b.id===c)return this._selectedBasemap&&this._selectedBasemap.id===b.id&&(this._selectedBasemap=null),this.basemaps.splice(a,1),this._refreshUI(),this.onRemove(b),b}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(c){},onRemove:function(c){},onError:function(c){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=
!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(c){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,c):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(c))},_findArcGISBasemapsGroup:function(c){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(c);
else{var a=this.arcgisUrl+"/portals/self",b={f:"json"};b.culture=t.locale;l({url:a,content:b,callbackParamName:"callback",load:e.hitch(this,function(a,b){a&&a.useVectorBasemaps&&a.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(e.hitch(this,function(b){b?this._basemapGalleryGroupQuery=a.vectorBasemapGalleryGroupQuery:a&&a.basemapGalleryGroupQuery?this._basemapGalleryGroupQuery=a.basemapGalleryGroupQuery:this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(c)})):
a&&a.basemapGalleryGroupQuery?(this._basemapGalleryGroupQuery=a.basemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(c)):(this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(c))}),error:e.hitch(this,function(c,a){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(c){var a=e.hitch(this,"_findArcGISBasemaps"),b=this.arcgisUrl+"/community/groups",d={};d.q=this._basemapGalleryGroupQuery;
d.f="json";l({url:b,content:d,callbackParamName:"callback",load:e.hitch(this,function(b,n){if(0<b.results.length)a(b.results[0].id,c,b.results[0].sortField,b.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:e.hitch(this,function(c){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(c,a,b,d){var n=e.hitch(this,function(a,c,b,n){var d=this.arcgisUrl+"/search",C={};C.q="group:"+
a+' AND type:"web map" NOT type:"web mapping application"';C.sortField=b;C.sortOrder="asc"===n?"desc":"asc";C.num=50;C.f="json";l({url:d,content:C,callbackParamName:"callback",load:e.hitch(this,function(a,b){if(0<a.results.length)c(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:e.hitch(this,function(a,c){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});b&&d?n(c,a,b,d):l({url:this.arcgisUrl+"/community/groups/"+
c,content:{f:"json"},callbackParamName:"callback",load:e.hitch(this,function(b,d){b.sortField?n(c,a,b.sortField,b.sortOrder):n(c,a,"name","desc")}),error:e.hitch(this,function(b,d){n(c,a,"name","desc")})})},_handleArcGISBasemapsResponse:function(c){0<c.length&&(h.forEach(c,function(c,b){if(this.bingMapsKey||!this.bingMapsKey&&c.title&&-1===c.title.indexOf("Bing Maps")){b={};if(b.id=this._getUniqueId(),b.title=c.title,b.thumbnailUrl="",c.thumbnail&&c.thumbnail.length&&(b.thumbnailUrl=this.arcgisUrl+
"/content/items/"+c.id+"/info/"+c.thumbnail,a.id)){var n=a.id.findCredential(d.urlToObject(this.arcgisUrl).path);n&&(b.thumbnailUrl+="?token\x3d"+n.token)}b.itemId=c.id;c=new N(b,this);this.basemaps.splice(0,0,c)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(r.empty(this.flowContainer),h.forEach(this.basemaps,function(c,a){c.id||(c.id="basemap_"+a);this.flowContainer.appendChild(this._buildNodeLayout(c))},this),r.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},
_buildNodeLayout:function(c){var a=r.create("div",{id:"galleryNode_"+c.id,class:"esriBasemapGalleryNode"}),b=r.create("a",{href:"javascript:void(0);"},a);q.connect(b,"onclick",e.hitch(this,"_onNodeClick",c));var d=c.title||"";c.thumbnailUrl?r.create("img",{class:"esriBasemapGalleryThumbnail",src:c.thumbnailUrl,title:d,alt:d},b):r.create("img",{class:"esriBasemapGalleryThumbnail",src:f.toUrl("./images/transparent.gif"),title:d,alt:d},b);c=r.create("div",{class:"esriBasemapGalleryLabelContainer"},a);
return r.create("span",{innerHTML:d,alt:d,title:d},c),a},_onNodeClick:function(c,a){a.preventDefault();this._markSelected(c);this.select(c.id)},_markSelected:function(a){a&&(h.forEach(t.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){x.remove(a,"esriBasemapGallerySelectedNode")}),(a=p.byId("galleryNode_"+a.id))&&x.add(a,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=!0;var c=this.get(a);c?(c.layers?this._getServiceInfos(c):(a=c.getLayers(this.arcgisUrl),
e.isArray(a)?this._getServiceInfos(c):a.addCallback(e.hitch(this,function(a){this._getServiceInfos(c)}))),this._markSelected(c)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"===location.protocol&&h.forEach(a.layers,function(a){(this._isAgolService(a.url)||this._isHostedService(a.url))&&(a.url=a.url.replace("http:","https:"))},this);this._selectedBasemap=a;var c=[];(h.forEach(a.layers,function(a){a.url&&0<a.url.length&&!a.isReference&&!a.type&&(a.deferredsPos=c.length,c.push(this._getServiceInfo(a.url)))},
this),0<c.length)?(new w(c)).addCallback(e.hitch(this,function(c){var b=null;(h.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=c[a.deferredsPos][1];var d=a.serviceInfoResponse.fullExtent;d||(d=a.serviceInfoResponse.extent);b=b?b.union(new y(d)):new y(d)}},this),this.map.extent)&&5>this._getIntersectionPercent(b,this.map.extent)&&this.map.setExtent(b,!0);this._switchBasemapLayers(a);this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},
_checkVTLSupport:function(){var a=new v;return u("ie")?a.resolve(!1):a.resolve(G.supported()),a},_switchBasemapLayers:function(a){var c,b,d,l=a.layers,g=!1;if(h.forEach(l,function(a){"VectorTileLayer"===a.type&&(g=!0)}),g&&!0!==this._supportsVTL)return c="esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.",void this.onError(c);if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===l[0].type||l[0].type&&-1<
l[0].type.indexOf("BingMaps")||"WebTiledLayer"===l[0].type||"VectorTileLayer"===l[0].type))return c="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",void this.onError(c);h.forEach(l,function(a){if(!a.isReference&&a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)return void this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var f=0;h.forEach(l,function(a,c){if(!a.isReference){var n,g;
if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels())return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",void this.onError(g);n=new K({id:"layer_osm",opacity:a.opacity})}else if(a.type&&-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels())return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",
void this.onError(g);n=B.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===a.type?n=B.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(n=B.MAP_STYLE_ROAD);n=new B({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:n,opacity:a.opacity})}else if("WebTiledLayer"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels())return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",void this.onError(g);n=a.initialExtent||
a.fullExtent;n=new L(a.templateUrl||a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new y(a.fullExtent),initialExtent:n&&new y(n),subDomains:a.subDomains,tileInfo:a.tileInfo?new M(a.tileInfo):null,tileServers:a.tileServers})}else if("VectorTileLayer"===a.type){n=new G(a.styleUrl,{visible:a.visibility,opacity:a.opacity});0===c&&1<l.length&&this._removeBasemapLayers();var h=this;q.connect(n,"onLoad",e.hitch(this,function(a,c,b){var d;return h._sameSpatialReference(b.spatialReference,
h.map.spatialReference)?0<h.map.getNumLevels()?h._sameTilingScheme(b.tileInfo,h.map.__tileInfo)?(0===c&&1===l.length&&h._removeBasemapLayers(),b._basemapGalleryLayerType="basemap",void h.map.addLayer(b,a)):(d="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.",void h.onError(d)):(d="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",void h.onError(d)):(d="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.",
void h.onError(d))},f,c))}else if(a.serviceInfoResponse&&a.serviceInfoResponse.mapName){if(b=new D(a.serviceInfoResponse.spatialReference),d=this._sameSpatialReference(b,this.map.spatialReference),this.map.spatialReference&&!d)return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.",void this.onError(g);if(!0===a.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(!this._sameTilingScheme(a.serviceInfoResponse.tileInfo,
this.map.__tileInfo))return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.",void this.onError(g)}else if(!0===a.serviceInfoResponse.singleFusedMapCache&&-1<a.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&0===this.map.getNumLevels())return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.",void this.onError(g);n=(0===this.map.layerIds.length||
0<this.map.getNumLevels())&&!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a)}else if(a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX){if(b=new D(a.serviceInfoResponse.spatialReference),!(d=this._sameSpatialReference(b,this.map.spatialReference)))return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.",void this.onError(g);if(!0===a.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&
!this._sameTilingScheme(a.serviceInfoResponse.tileInfo,this.map.__tileInfo))return g="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.",void this.onError(g);a.serviceInfoResponse.singleFusedMapCache?n=new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(n=new I,n.bandIds=a.bandIds,!a.bandIds&&a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount,10)&&(n.bandIds=
[0,1,2]),n=new H(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:n})):(n=new J,n.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(n.format="png32"),n=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:n}))}"VectorTileLayer"===a.type?f++:n&&(0===c&&this._removeBasemapLayers(),n._basemapGalleryLayerType="basemap",
this.map.addLayer(n,f),f++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];h.forEach(a,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&h.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var c;this._removeReferenceLayer();for(c=0;c<a.layers.length;c++)!0===a.layers[c].isReference&&
this._addReferenceLayer(a.layers[c])},_removeReferenceLayer:function(){var a;for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){"VectorTileLayer"===a.type?this._handleReferenceServiceInfoResponse(a):this._getServiceInfo(a.url,e.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,d){var c;(a.serviceInfoResponse=b,
"VectorTileLayer"===a.type)?c=new G(a.styleUrl,{visible:a.visibility,opacity:a.opacity}):b&&b.mapName?c=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(a.serviceInfoResponse.singleFusedMapCache?c=new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(d=new I,d.bandIds=a.bandIds,!a.bandIds&&b.bandCount&&3<parseInt(b.bandCount,10)&&(d.bandIds=[0,1,2]),c=new H(a.url,{resourceInfo:b,opacity:a.opacity,
visible:a.visibility,imageServiceParameters:d})):(b=new J,b.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(b.format="png32"),b.transparent=!0,c=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:b})));c&&(c._basemapGalleryLayerType="reference",c.attr("data-reference",!0),this.map.addLayer(c))},_getServiceInfo:function(a,b){var c={};return c.f="json",l({url:a,content:c,
callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:e.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=h.map(a.serviceInfoResponse.tileInfo.lods,function(a){return a.level}));var c=null;return a.exclusionAreas&&a.exclusionAreas.length&&(c=[],h.forEach(a.exclusionAreas,function(a){c.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new y(a.geometry)})})),
new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:c,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});return a.visibleLayers&&b.setVisibleLayers(a.visibleLayers),b},_getIntersectionPercent:function(a,b){return(a=b.intersects(a))?a.getWidth()*a.getHeight()/(b.getWidth()*b.getHeight())*100:0},_getIds:function(){var a=[];return h.forEach(this.basemaps,
function(b){a.push(b.id)},this),a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;){if(!(-1<a.indexOf(",basemap_"+b+",")))return"basemap_"+b;b++}},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+",").indexOf(","+a+",")},_isAgolService:function(a){return!!a&&(-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"))},_isHostedService:function(a){return!!a&&-1!==a.indexOf(".arcgis.com/")},_sameSpatialReference:function(a,
d){return!!(a&&d&&a.wkt==d.wkt&&(a.wkid===d.wkid||b.isDefined(a.latestWkid)&&a.latestWkid===d.wkid||b.isDefined(d.latestWkid)&&a.wkid===d.latestWkid||b.isDefined(a.latestWkid)&&a.latestWkid===d.latestWkid))||!!(a&&d&&a.isWebMercator()&&d.isWebMercator())},_sameTilingScheme:function(a,b){var c,d;c=this.map;var g=c.width>c.height?c.width:c.height,l=!1,e=!1;for(c=0;c<a.lods.length;c++){var y=a.lods[c].scale;a.dpi!==b.dpi&&(y=a.lods[c].scale/a.dpi);for(d=0;d<b.lods.length;d++){var f=b.lods[d].scale;if(a.dpi!==
b.dpi&&(f=b.lods[d].scale/b.dpi),Math.abs(f-y)/f<1/g){if(l){e=!0;break}l=!0}if(f<y)break}if(e)break}return!!e||!(!l||1!==a.lods.length&&1!==b.lods.length)}});return z("extend-esri")&&e.setObject("dijit.BasemapGallery",k,a),k})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(f,k,h,q,e,t,u,z,A,v,w,p,r,x,m){f=f(r,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(g){try{if(g=k.mixin({bingMapsKey:null,culture:"en-US"},g||{}),this.url=v.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=v.urlToObject(this.url),this.spatialReference=new w({wkid:102100}),this.tileInfo=new p({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new x(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new w({wkid:102100})),k.mixin(this,g),this.hasAttributionData=this.showAttribution,this._initLayer=k.hitch(this,this._initLayer),this._errorHandler=k.hitch(this,this._errorHandler),this._getTileInfo=k.hitch(this,this._getTileInfo),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");this._getTileInfo()}catch(a){throw this.onError(a),
a;}},_unsetMap:function(g,a){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var g=this._url.path+"/Imagery/Metadata/"+this.mapStyle,a=window.location.protocol;if(this.bingMapsKey){var b=this.resourceInfo;!this.loaded&&b?this._initLayer(b):m({url:g,content:k.mixin({},{uriScheme:"https:"===a?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},
_initLayer:function(g,a){if(200!==g.statusCode)return a=Error(),a.code=g.statusCode,a.message=g.statusDescription,a.details=g.errorDetails,a.authenticationResultCode=g.authenticationResultCode,void this.onError(a);try{this.resourceInfo=h.toJson(g);var b=g.resourceSets[0].resources[0],d=b.imageUrl.replace("{","${");if(this.tileServers=q.map(b.imageUrlSubdomains,function(a){var b=v.getProtocolForWebResource();return u.substitute(d,{subdomain:a}).replace("http:",b)}),this._tsLength=this.tileServers.length,
this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var l=this.loadCallback;l&&(delete this.loadCallback,l(this))}}catch(y){this.onError(y)}},getAttributionData:function(){var g,a=new z,b=h.fromJson(this.resourceInfo);(this.hasAttributionData&&b&&(g=k.getObject("resourceSets.0.resources.0.imageryProviders",!1,b)),g)?a.callback({contributors:g}):(g=Error("Layer does not have attribution data"),
g.log=e.isDebug,a.errback(g));return a},getTileUrl:function(g,a,b){return u.substitute(this.tileServers[a%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(g,a,b),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(g,a,b){var d,l,e="";for(l=g;0<l;l--)g="0",d=1<<l-1,0!=(b&d)&&g++,0!=(a&d)&&(g++,g++),e+=g;return e},setMapStyle:function(g){this.mapStyle=g;this._getTileInfo()},setCulture:function(g){this.culture=g;this._getTileInfo()},setBingMapsKey:function(g){this.bingMapsKey=
g},onMapStyleChange:function(){}});return k.mixin(f,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"}),t("extend-esri")&&k.setObject("virtualearth.VETiledLayer",f,A),f})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(f,
k,h,q,e,t,u,z,A,v,w,p,r,x){function m(g,a){var b,d=[];if(g&&a&&(a.customLayerParameters||a.customParameters)){b=k.clone(a.customParameters||{});k.mixin(b,a.customLayerParameters||{});g=v.urlToObject(g);for(var l in g.query)b.hasOwnProperty(l)||d.push(l+"\x3d"+g.query[l]);g=g.path+(d.length?"?"+d.join("\x26"):"")}return g}f=f(r,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(g,a){a||(a={});this.urlTemplate=g=m(g,a.wmtsInfo);var b=new p(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,
2.0037508342787E7,new w({wkid:102100})),d=new p(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new w({wkid:102100}));(this.initialExtent=a.initialExtent||b,this.fullExtent=a.fullExtent||d,a.tileInfo)?this.tileInfo=a.tileInfo:this.tileInfo=new x({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new w(this.tileInfo.spatialReference.toJson());this.copyright=a.copyright||"";var l=new q(g),b=l.scheme+"://"+l.authority+"/";if(this.urlPath=g.substring(b.length),this.tileServers=a.tileServers||[],-1===l.authority.indexOf("{subDomain}")&&
this.tileServers.push(b),a.subDomains&&0<a.subDomains.length&&1<l.authority.split(".").length){this.subDomains=a.subDomains;var f;h.forEach(a.subDomains,function(a){-1<l.authority.indexOf("${subDomain}")?f=l.scheme+"://"+t.substitute(l.authority,{subDomain:a})+"/":-1<l.authority.indexOf("{subDomain}")&&(f=l.scheme+"://"+l.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(f)},this)}this.tileServers=h.map(this.tileServers,function(a){return"/"!==a.charAt(a.length-1)&&(a+="/"),a});this._levelToLevelValue=
[];var D=0;h.forEach(this.tileInfo.lods,function(a,b){this._levelToLevelValue[a.level]=a.levelValue||a.level;0===b&&(D=this._levelToLevelValue[a.level])},this);this._wmtsInfo=a.wmtsInfo;var B=k.hitch(this,function(){this.loaded=!0;this.onLoad(this)});e("chrome")?(g=this.getTileUrl(D,0,0),a=u.defaults.io,b="with-credentials"===a.useCors?v.canUseXhr(g,!0):-1,(a=-1<b?a.corsEnabledServers[b]:null)&&a.withCredentials?A({url:g,handleAs:"arraybuffer"}).addBoth(function(){B()}):B()):B()},getTileUrl:function(g,
a,b){g=this._levelToLevelValue[g];var d=this.tileServers[a%this.tileServers.length]+t.substitute(this.urlPath,{level:g,col:b,row:a});return d=d.replace(/\{level\}/gi,g).replace(/\{row\}/gi,a).replace(/\{col\}/gi,b),d=this._appendCustomLayerParameters(d),d=this.addTimestampToURL(d),v.addProxy(d)},_appendCustomLayerParameters:function(g){var a,b;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters))for(a in b=k.clone(this._wmtsInfo.customParameters||{}),k.mixin(b,
this._wmtsInfo.customLayerParameters||{}),b)g+=(-1===g.indexOf("?")?"?":"\x26")+a+"\x3d"+encodeURIComponent(b[a]);return g}});return e("extend-esri")&&k.setObject("layers.WebTiledLayer",f,z),f})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(f,k,h,q,e,t){f=f(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,
compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(e){var f=this.bbox||this.extent;e=(f=f&&e&&f._normalize(!0))?f.spatialReference.wkid||h.toJson(f.spatialReference.toJson()):null;var k=this.imageSpatialReference,f={bbox:f?f.xmin+","+f.ymin+","+f.xmax+","+f.ymax:null,bboxSR:e,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:k?
k.wkid||h.toJson(k.toJson()):e,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?h.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?h.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?h.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,
lercVersion:this.lercVersion};e=this.timeExtent;return f.time=e?e.toJson().join(","):null,t.filter(f,function(e){if(null!==e&&void 0!==e)return!0})}});return k.mixin(f,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"}),q("extend-esri")&&k.setObject("layers.ImageServiceParameters",
f,e),f})},"widgets/BasemapGallery/utils":function(){define("dojo/_base/lang dojo/Deferred dojo/json dojo/_base/array dojo/promise/all esri/SpatialReference jimu/portalUtils jimu/shared/basePortalUrlUtils esri/request dojo/text!./esri_tileinfo.json".split(" "),function(f,k,h,q,e,t,u,z,A,v){function w(a){if(!a)return null;var b=a.indexOf("?");return 0===a.search(/http|\/\//)&&-1!==b?a.slice(0,b).replace(/\/*$/g,""):a}function p(a){return a?z.removeProtocol(w(a)):""}function r(a){var b=new k;u.getPortalSelfInfo(a).then(f.hitch(this,
function(d){var e=d.basemapGalleryGroupQuery;!0===d.useVectorBasemaps&&d.vectorBasemapGalleryGroupQuery&&(e=d.vectorBasemapGalleryGroupQuery);m.getBasemapGalleryGroup(a,e).then(f.hitch(this,function(a){a.queryItems({start:1,num:100,f:"json",q:u.webMapQueryStr}).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(){b.reject()}))}),f.hitch(this,function(){b.reject()}))}));return b}function x(a){return A({url:a,content:{f:"json"},handleAs:"text",callbackParamName:"callback"}).then(function(a){try{return h.parse(a)}catch(d){return null}},
function(){return null})}var m={},g=h.parse(v);m._loadPortalBaseMaps=function(a,b){var d=new k,g=[];r(a).then(function(a){q.forEach(a.results,function(a){var d=new k,e=p(a.thumbnailUrl);g.push(d);a.getItemData().then(function(g){m._getBasemapSpatialReference(a,g).then(f.hitch(this,function(l){var h=g.baseMap.baseMapLayers;m.isBasemapCompatibleWithMap(l,h,b).then(f.hitch(this,function(b){b?d.resolve({layers:h,title:a.title||g.baseMap.title,thumbnailUrl:e,spatialReference:l}):d.resolve({})}))}))})});
e(g).then(function(a){a=q.filter(a,function(a){return a&&a.title?!0:!1},this);d.resolve(a)})},function(a){d.reject(a)});return d};m.isBasemapCompatibleWithMap=function(a,b,d){var e=new k,f=d.spatialReference,h=d.width>d.height?d.width:d.height;if(!f||!b||0>=b.length||!a||!f.equals(new t(+a.wkid)))return e.resolve(!1),e;0===d.getNumLevels()?"OpenStreetMap"===b[0].layerType||b[0].layerType&&-1<b[0].layerType.indexOf("BingMaps")||"WebTiledLayer"===b[0].layerType||"VectorTileLayer"===b[0].layerType||
"ArcGISImageServiceVectorLayer"===b[0].layerType||"ArcGISTiledImageServiceLayer"===b[0].layerType?e.resolve(!1):e.resolve(!0):b[0].layerType&&0===b[0].layerType.indexOf("ArcGIS")&&b[0].url?x(b[0].url).then(function(a){(b[0].serviceInfoResponse=a)&&a.tileInfo?e.resolve(m.tilingSchemeCompatible(d.__tileInfo,a.tileInfo,h)):a&&a.capabilities&&(0<=a.capabilities.indexOf("Map")||0<=a.capabilities.indexOf("Image"))?e.resolve(!0):a&&a.error&&499===a.error.code?e.resolve(!0):e.resolve(!1)}):"WMS"===b[0].layerType?
e.resolve(!0):m.isNoUrlLayerMap(b)||"VectorTileLayer"===b[0].layerType?e.resolve(m.tilingSchemeCompatible(d.__tileInfo,g,h)):e.resolve(m.tilingSchemeCompatible(d.__tileInfo,b[0].tileInfo,h));return e};m.tilingSchemeCompatible=function(a,b,d){if(a&&b){var e=!1,g=!1,f,h;for(f=0;f<a.lods.length;f++){var k=a.lods[f].scale;a.dpi!==b.dpi&&(k=a.lods[f].scale/a.dpi);for(h=0;h<b.lods.length;h++){var m=b.lods[h].scale;a.dpi!==b.dpi&&(m=b.lods[h].scale/b.dpi);if(Math.abs(m-k)/m<1/d)if(e){g=!0;break}else e=!0;
if(m<k)break}if(g)break}a=g?!0:!e||1!==a.lods.length&&1!==b.lods.length?!1:!0;return a}return!0};m.isSameBasemapLayer=function(a,b){if(a.layerType&&b.layerType){if(a.layerType!==b.layerType)return!1;if("ArcGISImageServiceVectorLayer"===a.layerType||"ArcGISTiledImageServiceLayer"===a.layerType||"ArcGISTiledMapServiceLayer"===a.layerType||"ArcGISMapServiceLayer"===a.layerType||"ArcGISImageServiceLayer"===a.layerType)return a=p(a.url||""),b=p(b.url||""),a.toLowerCase()===b.toLowerCase();if("BingMapsAerial"===
a.layerType||"BingMapsRoad"===a.layerType||"BingMapsHybrid"===a.layerType||"OpenStreetMap"===a.layerType)return!0;if("VectorTileLayer"===a.layerType)return a=p(a.styleUrl||""),b=p(b.styleUrl||""),a.toLowerCase()===b.toLowerCase();if("WMS"===a.layerType)return a=p(a.mapUrl||""),b=p(b.mapUrl||""),a.toLowerCase()===b.toLowerCase();if("WebTiledLayer"===a.layerType){if(a.templateUrl&&b.templateUrl)return a=p(a.templateUrl||""),b=p(b.templateUrl||""),a.toLowerCase()===b.toLowerCase();if(a.wmtsInfo&&b.wmtsInfo)return a=
p(a.wmtsInfo.url||""),b=p(b.wmtsInfo.url||""),a.toLowerCase()===b.toLowerCase()}}else return a=p(a.url||""),b=p(b.url||""),a.toLowerCase()===b.toLowerCase();return!1};m.compareSameBasemapByOrder=function(a,b){a=a.layers;b=b.layers;if(a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(!m.isSameBasemapLayer(a[d],b[d]))return!1;return!0};m.isBingMap=function(a){if(!a||!a.layers)return!1;for(var b=0;b<a.layers.length;b++)if("BingMapsAerial"===a.layers[b].type||"BingMapsRoad"===a.layers[b].type||
"BingMapsHybrid"===a.layers[b].type)return!0;return!1};m.isNoUrlLayerMap=function(a){for(var b=0;b<a.length;b++)if("BingMapsAerial"===a[b].type||"BingMapsRoad"===a[b].type||"BingMapsHybrid"===a[b].type||"OpenStreetMap"===a[b].type)return!0;return!1};m.getToken=function(a){a=u.getPortal(a);a.updateCredential();return a.credential?"?token\x3d"+a.credential.token:""};m.removeUrlQuery=function(a){return w(a)};m.getStanderdUrl=function(a){return p(a)};m.getUniqueTitle=function(a,b){if(!b||0===b.length)return a;
b=q.filter(b,function(b){return b===a?!0:0===b.indexOf(a)?(b=b.substr(a.length+1),!isNaN(+b)):!1});if(0===b.length)return a;b=q.map(b,function(b){return b===a?0:+b.substr(a.length+1)});b=b.sort();return a+" "+(b[b.length-1]+1)};m.getBasemapInfo=function(a,b){var d,e;return u.getPortal(a).getItemById(b).then(function(a){d=a;return a.getItemData()}).then(function(a){e=a;return m._getBasemapSpatialReference(d,a)}).then(function(a){return{thumbnailUrl:d.thumbnailUrl,title:d.title||e.baseMap.title,layers:e.baseMap.baseMapLayers,
spatialReference:new t(a)}})};m.getBasemapGalleryGroup=function(a,b){var d=new k;a=u.getPortal(a);var e=b.indexOf("esri_");if(0<=e){var e=b.slice(e,e+7),g="esri_"+dojoConfig.locale.slice(0,2);b=b.replace(e,g)}a.queryGroups({f:"json",q:b}).then(f.hitch(this,function(a){0<a.results.length?d.resolve(a.results[0]):d.reject()}),f.hitch(this,function(){d.reject()}));return d};m._getBasemapSpatialReference=function(a,b){var d=null,e=!1,g=new k;if(a.owner&&0===a.owner.indexOf("esri_")||m.isNoUrlLayerMap(b.baseMap.baseMapLayers))d=
{wkid:"102100"};else if(b.spatialReference||a.spatialReference)d=b.spatialReference||a.spatialReference;else if(b.baseMap.baseMapLayers&&b.baseMap.baseMapLayers[0])if(a=b.baseMap.baseMapLayers[0],a.url&&0<a.url.indexOf("rest/services"))e=!0,x(b.baseMap.baseMapLayers[0].url).then(f.hitch(this,function(a){a&&a.spatialReference&&(d=a.spatialReference);g.resolve(d)}),function(a){console.error(a);g.resolve(null)});else if("VectorTileLayer"===a.layerType)d={wkid:"102100"};else if(b=a.fullExtent||a.initialExtent)d=
b.spatialReference;e||g.resolve(d);return g};return m})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\n  \x3c/div\x3e\n\x3c/div\x3e',"url:widgets/BasemapGallery/esri_tileinfo.json":'{\r\n  "rows": 256,\r\n  "cols": 256,\r\n  "dpi": 96,\r\n  "compressionQuality": 75,\r\n  "origin": {\r\n   "x": -2.0037508342787E7,\r\n   "y": 2.0037508342787E7\r\n  },\r\n  "spatialReference": {\r\n   "wkid": 102100,\r\n   "latestWkid": 3857\r\n  },\r\n  "lods": [\r\n   {\r\n    "level": 0,\r\n    "resolution": 156543.03392800014,\r\n    "scale": 5.91657527591555E8\r\n   },\r\n   {\r\n    "level": 1,\r\n    "resolution": 78271.51696399994,\r\n    "scale": 2.95828763795777E8\r\n   },\r\n   {\r\n    "level": 2,\r\n    "resolution": 39135.75848200009,\r\n    "scale": 1.47914381897889E8\r\n   },\r\n   {\r\n    "level": 3,\r\n    "resolution": 19567.87924099992,\r\n    "scale": 7.3957190948944E7\r\n   },\r\n   {\r\n    "level": 4,\r\n    "resolution": 9783.93962049996,\r\n    "scale": 3.6978595474472E7\r\n   },\r\n   {\r\n    "level": 5,\r\n    "resolution": 4891.96981024998,\r\n    "scale": 1.8489297737236E7\r\n   },\r\n   {\r\n    "level": 6,\r\n    "resolution": 2445.98490512499,\r\n    "scale": 9244648.868618\r\n   },\r\n   {\r\n    "level": 7,\r\n    "resolution": 1222.992452562495,\r\n    "scale": 4622324.434309\r\n   },\r\n   {\r\n    "level": 8,\r\n    "resolution": 611.4962262813797,\r\n    "scale": 2311162.217155\r\n   },\r\n   {\r\n    "level": 9,\r\n    "resolution": 305.74811314055756,\r\n    "scale": 1155581.108577\r\n   },\r\n   {\r\n    "level": 10,\r\n    "resolution": 152.87405657041106,\r\n    "scale": 577790.554289\r\n   },\r\n   {\r\n    "level": 11,\r\n    "resolution": 76.43702828507324,\r\n    "scale": 288895.277144\r\n   },\r\n   {\r\n    "level": 12,\r\n    "resolution": 38.21851414253662,\r\n    "scale": 144447.638572\r\n   },\r\n   {\r\n    "level": 13,\r\n    "resolution": 19.10925707126831,\r\n    "scale": 72223.819286\r\n   },\r\n   {\r\n    "level": 14,\r\n    "resolution": 9.554628535634155,\r\n    "scale": 36111.909643\r\n   },\r\n   {\r\n    "level": 15,\r\n    "resolution": 4.77731426794937,\r\n    "scale": 18055.954822\r\n   },\r\n   {\r\n    "level": 16,\r\n    "resolution": 2.388657133974685,\r\n    "scale": 9027.977411\r\n   },\r\n   {\r\n    "level": 17,\r\n    "resolution": 1.1943285668550503,\r\n    "scale": 4513.988705\r\n   },\r\n   {\r\n    "level": 18,\r\n    "resolution": 0.5971642835598172,\r\n    "scale": 2256.994353\r\n   },\r\n   {\r\n    "level": 19,\r\n    "resolution": 0.29858214164761665,\r\n    "scale": 1128.497176\r\n   },\r\n   {\r\n    "level": 20,\r\n    "resolution": 0.14929107082380833,\r\n    "scale": 564.248588\r\n   },\r\n   {\r\n    "level": 21,\r\n    "resolution": 0.07464553541190416,\r\n    "scale": 282.124294\r\n   },\r\n   {\r\n    "level": 22,\r\n    "resolution": 0.03732276770595208,\r\n    "scale": 141.062147\r\n   },\r\n   {\r\n    "level": 23,\r\n    "resolution": 0.01866138385297604,\r\n    "scale": 70.5310735\r\n   }\r\n  ]\r\n }',
"url:widgets/BasemapGallery/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"basemapGalleryDiv" \x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n\r\n',"url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemapgallery {height: 100%;}.jimu-widget-basemapgallery .esriBasemapGalleryNode:hover{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {border: 1px solid #fff; margin: 1px; -moz-box-shadow: 0px 0px 0px #000; -webkit-box-shadow: 0px 0px 0px #000; box-shadow: 0px 0px 7px #000;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryLabelContainer{padding-top: 2px;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail{width: 100px; height: 67px;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode .esriBasemapGalleryThumbnail{border-color: #51B1FE !important;}.jimu-widget-basemapgallery .esriBasemapGalleryNode {width: 85px; margin: 5px 10px 0 10px;}.jimu-rtl .jimu-widget-basemapgallery .esriBasemapGalleryNode {float: right;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {display: block; margin: 1px auto;}",
"url:widgets/BasemapGallery/config.json":'{\r\n  "basemapGallery": {\r\n    "mode": 1,\r\n    "basemaps": []\r\n  }\r\n}',"*now":function(f){f(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/Deferred jimu/BaseWidget jimu/portalUtils jimu/PanelManager jimu/portalUrlUtils jimu/utils esri/dijit/Basemap esri/dijit/BasemapLayer esri/dijit/BasemapGallery dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/on dojo/promise/all ./utils jimu/dijit/LoadingIndicator".split(" "),function(f,k,h,q,e,t,u,z,A,v,w,p,r,x,m,g,a,b){return f([q,k],{name:"BasemapGallery",baseClass:"jimu-widget-basemapgallery",basemapGallery:null,spatialRef:null,
startup:function(){this.inherited(arguments);this.initBasemaps()},resize:function(){this._responsive()},_responsive:function(){setTimeout(p.hitch(this,function(){var a=m("#"+this.id)[0],a=x.getStyle(a,"width"),b=parseInt(a/105,10);if(0<b){var e=parseInt(a%105/b,10);m(".esriBasemapGalleryNode",this.id).forEach(function(a){x.setStyle(a,"width",85+e+"px")})}}),100)},initBasemaps:function(){var d,f,k=p.clone(this.config.basemapGallery);this.loadingShelter.show();1===k.mode?d=b._loadPortalBaseMaps(this.appConfig.portalUrl,
this.map):(d=new h,d.resolve(k.basemaps));f=e.getPortal(this.appConfig.portalUrl).loadSelfInfo();a({portalSelf:f,basemaps:d}).then(p.hitch(this,function(a){for(var d=a.basemaps,e=[],f=0,h=this._getWebmapBasemap(),d=r.filter(d,function(d){if(!d||!d.title)return!1;var e;e=b.isBingMap(d)?a.portalSelf.bingKey?!0:!1:!0;return d.title&&e},this),f=0;f<d.length&&!b.compareSameBasemapByOrder(d[f],h);f++);f===d.length&&d.push(h);for(f=0;f<d.length;f++){for(var h=d[f].layers.length,l=[],m=0;m<h;m++)l.push(new v(d[f].layers[m]));
d[f].layers=l;d[f].thumbnailUrl?/^(https?:)?\/\//.test(d[f].thumbnailUrl)?d[f].thumbnailUrl+=b.getToken(this.appConfig.portalUrl):d[f].thumbnailUrl=z.processUrlInWidgetConfig(d[f].thumbnailUrl,this.folderUrl):d[f].thumbnailUrl=this.folderUrl+"images/default.jpg";e.push(new A(d[f]))}k.map=this.map;this.appConfig.portalUrl&&(k.portalUrl=this.appConfig.portalUrl);k.basemaps=e;k.showArcGISBasemaps=!1;k.bingMapsKey=a.portalSelf.bingKey;this.basemapGallery=new w(k,this.basemapGalleryDiv);this.basemapGallery.startup();
this.own(g(this.basemapGallery,"selection-change",p.hitch(this,this.selectionChange)));this._responsive();this.loadingShelter.hide()})).otherwise(p.hitch(this,function(){this.loadingShelter.hide()}))},_getWebmapBasemap:function(){var a;a=this.map.itemInfo.item.thumbnail?u.getItemUrl(this.appConfig.portalUrl,this.map.itemInfo.item.id)+"/info/"+this.map.itemInfo.item.thumbnail:null;return{title:this.map.itemInfo.itemData.baseMap.title,thumbnailUrl:a,layers:this.map.itemInfo.itemData.baseMap.baseMapLayers,
spatialReference:this.map.spatialReference}},selectionChange:function(){this.updateExtent();"widgetOnScreen"===this.gid&&t.getInstance().closePanel(this.id+"_panel")},updateExtent:function(){if(0<this.map.getNumLevels()){var a=this.basemapGallery.getSelected().getLayers(),b=this.map.__tileInfo.lods[this.map.getLevel()],e;if(0<a.length&&(a=a[0],(e=a.tileInfo||a.serviceInfoResponse&&a.serviceInfoResponse.tileInfo)&&b)){var f=b.scale/this.map.__tileInfo.dpi,g;r.forEach(e.lods,function(a){a=a.scale/e.dpi;
if(!g||Math.abs(a-f)<Math.abs(g-f))g=a});Math.abs(g-f)/f>1/this.map.width&&this.map.setScale(g*e.dpi)}}}})});