//>>built
define("dojo/_base/declare jimu/BaseWidget jimu/portalUtils dojo/_base/lang dojo/Deferred jimu/dijit/Message jimu/dijit/LoadingIndicator ./Print esri/request jimu/portalUrlUtils".split(" "),function(e,h,k,c,f,d,l,m,n,g){return e([h],{baseClass:"jimu-widget-print",name:"Print",className:"esri.widgets.Print",_portalPrintTaskURL:null,postCreate:function(){this.inherited(arguments);this.shelter=new l({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup()},startup:function(){this.inherited(arguments);
this.shelter.show();this._initPrinter()},_initPrinter:function(){this._getPrintTaskURL(this.appConfig.portalUrl).then(c.hitch(this,function(a){this.shelter.show();this.isAsync(a).then(c.hitch(this,function(b){this.print=new m({map:this.map,appConfig:this.appConfig,printTaskURL:a,defaultAuthor:this.config.defaultAuthor,defaultCopyright:this.config.defaultCopyright,copyrightEditable:!1!==this.config.copyrightEditable,defaultTitle:this.config.defaultTitle,defaultFormat:this.config.defaultFormat,defaultLayout:this.config.defaultLayout,
nls:this.nls,async:b});this.print.placeAt(this.printNode);this.print.startup()}),c.hitch(this,function(b){new d({message:b.message})})).always(c.hitch(this,function(){this.shelter.hide()}))}),c.hitch(this,function(a){new d({message:a});console.error(a);this.shelter.hide()}))},_getPrintTaskURL:function(a){var b=new f;if(this.config&&this.config.serviceURL)return b.resolve(this.config.serviceURL),b;k.getPortalSelfInfo(a).then(c.hitch(this,function(a){(a=a&&a.helperServices&&a.helperServices.printTask&&
a.helperServices.printTask.url)?b.resolve(a):b.reject("error")}),c.hitch(this,function(a){new d({message:this.nls.portalConnectionError});b.reject("error");console.error(a)}));return b},isAsync:function(a){var b=new f,d=g.setHttpProtocol(a),e=g.getNewPrintUrl(this.appConfig.portalUrl);d===e||/sharing\/tools\/newPrint$/.test(d)?b.resolve(!1):n({url:a,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4,load:c.hitch(this,function(a){"esriExecutionTypeAsynchronous"===a.executionType?
b.resolve(!0):b.resolve(!1)}),error:c.hitch(this,function(a){b.reject(a)})});return b},onSignIn:function(a){a=a||{};a.userId&&this.print&&this.print.updateAuthor(a.userId)}})});