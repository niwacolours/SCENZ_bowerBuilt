//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(l,d,k,t,p){return d("dijit.layout.TabContainer",k,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(d){var k=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?l.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":k,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},d)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?t:p)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(l,d,k,t,p,m,q,u){return l("dijit.layout._TabContainerBase",[p,q],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:u,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&t.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
d.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(d.add(this.domNode,"dijitTabContainerNested"),d.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),d.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),d.add(this.containerNode,"dijitTabPaneWrapperNested")):d.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(n){d.add(n.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(n){d.remove(n.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var n=this.selectedChildWidget;if(this.doLayout){var d=this.tabPosition.replace(/-h/,"");this.tablist.region=d;d=[this.tablist,{domNode:this.tablistSpacer,region:d},{domNode:this.containerNode,region:"center"}];m.layoutChildren(this.domNode,this._contentBox,d);this._containerContentBox=m.marginBox2contentBox(this.containerNode,d[2]);n&&
n.resize&&n.resize(this._containerContentBox)}else{if(this.tablist.resize){d=this.tablist.domNode.style;d.width="0";var h=k.getContentBox(this.domNode).w;d.width="";this.tablist.resize({w:h})}n&&n.resize&&n.resize()}}},destroy:function(n){this.tablist&&this.tablist.destroy(n);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){m("dijit-legacy-requires")&&n(0,function(){require(["dijit/layout/StackController"])});k=k("dijit.layout.StackContainer",c,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(u(this.domNode,"keydown",q.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var b=this.getChildren();l.forEach(b,this._setupChild,
this);this.persist?this.selectedChildWidget=g.byId(d(this.id+"_selectedChild")):l.some(b,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var a=this.selectedChildWidget;!a&&b[0]&&(a=this.selectedChildWidget=b[0],a.selected=!0);v.publish(this.id+"-startup",{children:b,selected:a,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var b=this.selectedChildWidget;b&&this._showChild(b)}this.inherited(arguments)},
_setupChild:function(b){var a=b.domNode,f=p.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",b.domNode,"replace"),c=b["aria-label"]||b.title||b.label;c&&f.setAttribute("aria-label",c);p.place(a,f);b._wrapper=f;this.inherited(arguments);"none"==a.style.display&&(a.style.display="block");b.domNode.removeAttribute("title")},addChild:function(b,a){this.inherited(arguments);this._started&&(v.publish(this.id+"-addChild",b,a),this.layout(),this.selectedChildWidget||
this.selectChild(b))},removeChild:function(b){var a=l.indexOf(this.getChildren(),b);this.inherited(arguments);p.destroy(b._wrapper);delete b._wrapper;this._started&&v.publish(this.id+"-removeChild",b);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===b&&(this.selectedChildWidget=void 0,this._started)){var f=this.getChildren();f.length&&this.selectChild(f[Math.max(a-1,0)])}this._started&&this.layout()}},selectChild:function(b,a){var f;b=g.byId(b);this.selectedChildWidget!=b&&(f=this._transition(b,
this.selectedChildWidget,a),this._set("selectedChildWidget",b),v.publish(this.id+"-selectChild",b,this._focused),this.persist&&d(this.id+"_selectedChild",this.selectedChildWidget.id));return h(f||!0)},_transition:function(b,a){a&&this._hideChild(a);a=this._showChild(b);b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize());return a},_adjacent:function(b){var a=this.getChildren(),f=l.indexOf(a,this.selectedChildWidget),f=f+(b?1:a.length-1);return a[f%a.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(b){v.publish(this.id+"-containerKeyDown",{e:b,page:this})},layout:function(){var b=this.selectedChildWidget;b&&b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize())},_showChild:function(b){var a=this.getChildren();b.isFirstChild=b==a[0];b.isLastChild=b==a[a.length-1];b._set("selected",!0);b._wrapper&&t.replace(b._wrapper,
"dijitVisible","dijitHidden");return b._onShow&&b._onShow()||!0},_hideChild:function(b){b._set("selected",!1);b._wrapper&&t.replace(b._wrapper,"dijitHidden","dijitVisible");b.onHide&&b.onHide()},closeChild:function(b){if(!b.onClose||b.onClose(this,b))this.removeChild(b),b.destroyRecursive()},destroyDescendants:function(b){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;l.forEach(this.getChildren(),function(a){b||this.removeChild(a);a.destroyRecursive(b)},this);this._descendantsBeingDestroyed=
!1}});k.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};q.extend(e,k.ChildWidgetProperties);return k})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(l,d,k,t,p,m,q,u,n){return m("dijit.layout._LayoutWidget",[d,k,t],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);
q.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var n=this.getParent&&this.getParent();n&&n.isLayoutContainer||(this.resize(),this.own(p.on("resize",l.hitch(this,"resize"))))}},resize:function(d,h){var g=this.domNode;d&&u.setMarginBox(g,d);h=h||{};l.mixin(h,d||{});"h"in h&&"w"in h||(h=l.mixin(u.getMarginBox(g),h));d=n.getComputedStyle(g);var e=u.getMarginExtents(g,d),c=u.getBorderExtents(g,d);h=this._borderBox={w:h.w-(e.w+c.w),h:h.h-(e.h+c.h)};
e=u.getPadExtents(g,d);this._contentBox={l:n.toPixelValue(g,d.paddingLeft),t:n.toPixelValue(g,d.paddingTop),w:h.w-e.w,h:h.h-e.h};this.layout()},layout:function(){},_setupChild:function(n){q.add(n.domNode,this.baseClass+"-child "+(n.baseClass?this.baseClass+"-"+n.baseClass:""))},addChild:function(n,h){this.inherited(arguments);this._started&&this._setupChild(n)},removeChild:function(n){q.remove(n.domNode,this.baseClass+"-child"+(n.baseClass?" "+this.baseClass+"-"+n.baseClass:""));this.inherited(arguments)}})})},
"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g){g=l("dijit.layout._TabButton"+(p("dojo-bidi")?"_NoBidi":""),u.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:g,_setNameAttr:"focusNode",scrollOnFocus:!1,
buildRendering:function(){this.inherited(arguments);d.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var e=this.domNode;this.defer(function(){e.className=e.className},1)},_setCloseButtonAttr:function(e){this._set("closeButton",e);t.toggle(this.domNode,"dijitClosable",e);this.closeNode.style.display=e?"":"none";e&&(e=m.getLocalization("dijit","common"),this.closeNode&&k.set(this.closeNode,"title",e.itemClose))},_setDisabledAttr:function(e){this.inherited(arguments);
if(this.closeNode)if(e)k.remove(this.closeNode,"title");else{var c=m.getLocalization("dijit","common");k.set(this.closeNode,"title",c.itemClose)}},_setLabelAttr:function(e){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=q.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});p("dojo-bidi")&&(g=l("dijit.layout._TabButton",g,{_setLabelAttr:function(e){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));l=l("dijit.layout.TabController",
u,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:g,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var e=new v({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return t.contains(a,"dijitClosable")&&!t.contains(a,"dijitTabDisabled")}});
this.own(e);var c=m.getLocalization("dijit","common"),b=this;e.addChild(new h({label:c.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(a){a=n.byNode(this.getParent().currentTarget);b.onCloseButtonClick(a.page)}}))}});l.TabButton=g;return l})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){t=d("dijit.layout._StackButton",c,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(b){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});d=d("dijit.layout.StackController",[h,g,e],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:t,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(b){return v.byId(this.id+
"_"+b)},postCreate:function(){this.inherited(arguments);this.own(u.subscribe(this.containerId+"-startup",m.hitch(this,"onStartup")),u.subscribe(this.containerId+"-addChild",m.hitch(this,"onAddChild")),u.subscribe(this.containerId+"-removeChild",m.hitch(this,"onRemoveChild")),u.subscribe(this.containerId+"-selectChild",m.hitch(this,"onSelectChild")),u.subscribe(this.containerId+"-containerKeyDown",m.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(q(this.containerNode,"click",
m.hitch(this,function(b){var a=v.getEnclosingWidget(b.target);if(a!=this.containerNode&&!a.disabled&&a.page)for(b=b.target;b!==this.containerNode;b=b.parentNode)if(k.contains(b,this.buttonWidgetCloseClass)){this.onCloseButtonClick(a.page);break}else if(b==a.domNode){this.onButtonClick(a.page);break}})))},onStartup:function(b){this.textDir=b.textDir;l.forEach(b.children,this.onAddChild,this);if(b.selected)this.onSelectChild(b.selected);var a=v.byId(this.containerId).containerNode,f=m.hitch(this,"pane2button");
b={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var c=function(b,c){return q(a,"attrmodified-"+b,function(a){var b=f(a.detail&&a.detail.widget&&a.detail.widget.id);b&&b.set(c,a.detail.newValue)})},e;for(e in b)this.own(c(e,b[e]))},destroy:function(b){this.destroyDescendants(b);this.inherited(arguments)},onAddChild:function(b,a){var f=new (m.isString(this.buttonWidget)?m.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+b.id,name:this.id+"_"+b.id,label:b.title,disabled:b.disabled,ownerDocument:this.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir||this.textDir,showLabel:b.showTitle,iconClass:b.iconClass,closeButton:b.closable,title:b.tooltip,page:b});this.addChild(f,a);b.controlButton=f;if(!this._currentChild)this.onSelectChild(b);a=b._wrapper.getAttribute("aria-labelledby")?b._wrapper.getAttribute("aria-labelledby")+" "+f.id:f.id;b._wrapper.removeAttribute("aria-label");b._wrapper.setAttribute("aria-labelledby",
a)},onRemoveChild:function(b){this._currentChild===b&&(this._currentChild=null);var a=this.pane2button(b.id);a&&(this.removeChild(a),a.destroy());delete b.controlButton},onSelectChild:function(b){if(b){if(this._currentChild){var a=this.pane2button(this._currentChild.id);a.set("checked",!1);a.focusNode.setAttribute("tabIndex","-1")}a=this.pane2button(b.id);a.set("checked",!0);this._currentChild=b;a.focusNode.setAttribute("tabIndex","0");v.byId(this.containerId)}},onButtonClick:function(b){var a=this.pane2button(b.id);
n.focus(a.focusNode);this._currentChild&&this._currentChild.id===b.id&&a.set("checked",!0);v.byId(this.containerId).selectChild(b)},onCloseButtonClick:function(b){v.byId(this.containerId).closeChild(b);this._currentChild&&(b=this.pane2button(this._currentChild.id))&&n.focus(b.focusNode||b.domNode)},adjacent:function(b){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(b=!b);var a=this.getChildren(),f=l.indexOf(a,this.pane2button(this._currentChild.id)),c=a[f],e;do f=(f+
(b?1:a.length-1))%a.length,e=a[f];while(e.disabled&&e!=c);return e},onkeydown:function(b,a){if(!this.disabled&&!b.altKey&&(a=null,b.ctrlKey||!b._djpage)){switch(b.keyCode){case p.LEFT_ARROW:case p.UP_ARROW:b._djpage||(a=!1);break;case p.PAGE_UP:b.ctrlKey&&(a=!1);break;case p.RIGHT_ARROW:case p.DOWN_ARROW:b._djpage||(a=!0);break;case p.PAGE_DOWN:b.ctrlKey&&(a=!0);break;case p.HOME:for(var f=this.getChildren(),c=0;c<f.length;c++){var e=f[c];if(!e.disabled){this.onButtonClick(e.page);break}}b.stopPropagation();
b.preventDefault();break;case p.END:f=this.getChildren();for(c=f.length-1;0<=c;c--)if(e=f[c],!e.disabled){this.onButtonClick(e.page);break}b.stopPropagation();b.preventDefault();break;case p.DELETE:case 87:this._currentChild.closable&&(b.keyCode==p.DELETE||b.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),b.stopPropagation(),b.preventDefault());break;case p.TAB:b.ctrlKey&&(this.onButtonClick(this.adjacent(!b.shiftKey).page),b.stopPropagation(),b.preventDefault())}null!==a&&(this.onButtonClick(this.adjacent(a).page),
b.stopPropagation(),b.preventDefault())}},onContainerKeyDown:function(b){b.e._djpage=b.page;this.onkeydown(b.e)}});d.StackButton=t;return d})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a){h("dijit-legacy-requires")&&a(0,function(){l(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return k("dijit.Menu",b,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):d.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return e.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=t.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var f=a;b=this._iframeContentWindow(f);b=g.body(b.document)}else b=a==g.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var c={node:a,iframe:f};p.set(a,"_dijitMenu"+this.id,
this._bindings.push(c));var e=n.hitch(this,function(a){var b=this.selector,c=b?function(a){return v.selector(b,a)}:function(a){return a},r=this;return[v(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<r._lastKeyDown+500||r._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),v(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==u.F10||r.leftClickToOpen&&a.keyCode==u.SPACE)a.stopPropagation(),a.preventDefault(),
r._scheduleOpen(this,f,null,a.target),r._lastKeyDown=(new Date).getTime()})]});c.connects=b?e(b):[];f&&(c.onloadHandler=n.hitch(this,function(){var a=this._iframeContentWindow(f),a=g.body(a.document);c.connects=e(a)}),f.addEventListener?f.addEventListener("load",c.onloadHandler,!1):f.attachEvent("onload",c.onloadHandler))},unBindDomNode:function(a){var b;try{b=t.byId(a,this.ownerDocument)}catch(H){return}a="_dijitMenu"+this.id;if(b&&p.has(b,a)){for(var f=p.get(b,a)-1,c=this._bindings[f],e;e=c.connects.pop();)e.remove();
(e=c.iframe)&&(e.removeEventListener?e.removeEventListener("load",c.onloadHandler,!1):e.detachEvent("onload",c.onloadHandler));p.remove(b,a);delete this._bindings[f]}},_scheduleOpen:function(a,b,c,e){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:e,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){k.refocus&&l&&l.focus();c.close(k)}var f=a.target,e=a.iframe,g=a.coords,n=!g;this.currentTarget=a.delegatedTarget;
if(g){if(e){a=m.position(e,!0);var f=this._iframeContentWindow(e),f=m.docScroll(f.document),d=q.getComputedStyle(e),v=q.toPixelValue,y=(h("ie")&&h("quirks")?0:v(e,d.paddingLeft))+(h("ie")&&h("quirks")?v(e,d.borderLeftWidth):0),e=(h("ie")&&h("quirks")?0:v(e,d.paddingTop))+(h("ie")&&h("quirks")?v(e,d.borderTopWidth):0);g.x+=a.x+y-f.x;g.y+=a.y+e-f.y}}else g=m.position(f,!0),g.x+=10,g.y+=10;var k=this,e=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var l=!a||t.isDescendant(a,
this.domNode)?e:a;c.open({popup:this,x:g.x,y:g.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();n||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);c.close(this)}},destroy:function(){d.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r,w,z){g=d("dijit.layout.ScrollingTabController",[c,a],{baseClass:"dijitTabController dijitScrollingTabController",templateString:g,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",k.add(a,"tabStrip-disabled"));k.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);p.set(this.domNode,"visibility","");this._postStartup=!0;this.own(u(this.containerNode,"attrmodified-label, attrmodified-iconclass",q.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,b){this.inherited(arguments);p.set(this.containerNode,"width",p.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,b){var f=this.pane2button(a.id);this._selectedTab===f.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=n("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=t.getMarginSize(a).w,!0;p.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var b=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-b.offsetLeft}return 0},_enableBtn:function(a){var b=this._getTabsWidth();a=a||p.get(this.scrollNode,"width");return 0<b&&a<b},resize:function(a){this._dim=a;this.scrollNode.style.height="auto";var f=this._contentBox=b.marginBox2contentBox(this.domNode,{h:0,w:a.w});f.h=this.scrollNode.offsetHeight;t.setContentSize(this.domNode,f);f=this._enableBtn(this._contentBox.w);
this._buttons.style("display",f?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";b.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:a.w}},_getScroll:function(){return this.isLeftToRight()||8>v("ie")||v("trident")&&v("quirks")||v("webkit")?this.scrollNode.scrollLeft:p.get(this.containerNode,"width")-p.get(this.scrollNode,"width")+(v("trident")||v("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>v("ie")||v("trident")&&v("quirks")||v("webkit"))return a;var b=p.get(this.containerNode,"width")-p.get(this.scrollNode,"width");return(v("trident")||
v("edge")?-1:1)*(a-b)},onSelectChild:function(a,b){var f=this.pane2button(a.id);if(f){var c=f.domNode;if(c!=this._selectedTab&&(this._selectedTab=c,this._postResize)){var e=this._getScroll();e>c.offsetLeft||e+p.get(this.scrollNode,"width")<c.offsetLeft+p.get(c,"width")?(c=this.createSmoothScroll(),b&&(c.onEnd=function(){f.focus()}),c.play()):b&&f.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),b=p.get(this.scrollNode,"width"),f=p.get(this.containerNode,"width")-
b,c=this._getTabsWidth();if(a.length&&c>b)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-b:f};a=this.isLeftToRight()?0:f;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,b=p.get(this.scrollNode,"width"),f=this._getScrollBounds(),a=a.offsetLeft+p.get(a,"width")/2-b/2;return a=Math.min(Math.max(a,f.min),f.max)},createSmoothScroll:function(a){if(0<arguments.length){var b=
this._getScrollBounds();a=Math.min(Math.max(a,b.min),b.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var f=this,c=this.scrollNode,e=new m.Animation({beforeBegin:function(){this.curve&&delete this.curve;var b=c.scrollLeft,r=f._convertToScrollLeft(a);e.curve=new m._Line(b,r)},onAnimate:function(a){c.scrollLeft=a}});this._anim=e;this._setButtonClass(a);return e},_getBtnNode:function(a){for(a=a.target;a&&!k.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,b){b&&k.contains(b,"dijitTabDisabled")||(a*=.75*p.get(this.scrollNode,"width"),a=this._getScroll()+a,this._setButtonClass(a),this.createSmoothScroll(a).play())},_setButtonClass:function(a){var b=this._getScrollBounds();this._leftBtn.set("disabled",a<=b.min);this._rightBtn.set("disabled",a>=b.max)}});e=d("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:e,tabIndex:"",isFocusable:function(){return!1}});d("dijit.layout._ScrollingTabControllerButton",[w,e]);d("dijit.layout._ScrollingTabControllerMenuButton",[w,z,e],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new f({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var b=h.byId(this.containerId);l.forEach(b.getChildren(),function(a){var f=
new r({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||b.textDir,onClick:function(){b.selectChild(a)}});this.dropDown.addChild(f)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return g})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(l,d,k,t,p,m,q,u,n,v){return l(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(h){this.map=h&&h.map;this.nls=h&&h.nls;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet={};this.relationshipTableSet={};this.currentRelationshipKey=
null;this.relationshipInfoMapping={}},setConfig:function(h){this.config=d.clone(h||{})},setMap:function(h){this.map=h},updateLayerInfoResources:function(h){var g=new t;n.readConfigLayerInfosFromMap(this.map,!1,!0).then(d.hitch(this,function(e){this._layerInfosFromMap=e;this._processDelayedLayerInfos();h&&(0===this.config.layerInfos.length||this.config.syncWithLayers?(e=n.getConfigInfosFromLayerInfos(e),this.config.layerInfos=k.filter(e,function(c){return c.show})):this.config.layerInfos=k.filter(d.delegate(this.config.layerInfos),
d.hitch(this,function(c){var b=this._getLayerInfoById(c.id);return c.show&&b&&(c.name=b.name||b.title)})));g.resolve()}),function(e){g.reject(e)});return g},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return d.clone(this.config.layerInfos)},addLayerInfo:function(h){0===this._layerInfosFromMap.length?this._delayedLayerInfos.push(h):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(h.id)&&this._layerInfosFromMap.push(h)},
addConfigInfo:function(h){this._getConfigInfoById(h.id)||(h=n.getConfigInfoFromLayerInfo(h),this.config.layerInfos.push({id:h.id,name:h.name,layer:{url:h.layer.url,fields:h.layer.fields}}))},removeLayerInfo:function(h){h=this._getLayerInfoById(h);h=this._layerInfosFromMap.indexOf(h);this._layerInfosFromMap.splice(h,1)},removeConfigInfo:function(h){if(d.getObject("config.layerInfos",!1,this))for(var g=this.config.layerInfos.length,e=0;e<g;e++)if(this.config.layerInfos[e].id===h){this.featureTableSet[h]&&
(this.featureTableSet[h].destroy(),delete this.featureTableSet[h]);this.config.layerInfos.splice(e,1);break}},getQueryTable:function(h,g,e,c){var b=new t;this._activeLayerInfoId=h;this.featureTableSet[h]?b.resolve({isSupportQuery:!0,table:this.featureTableSet[h]}):this._getQueryTableInfo(h).then(d.hitch(this,function(a){if(a){var f=a.layerInfo,r=a.layerObject;a=a.tableInfo;if(this.featureTableSet[h])b.resolve({isSupportQuery:a.isSupportQuery,table:this.featureTableSet[h]});else if(d.getObject("isSupportQuery",
!1,a)){var w=this._getConfigInfoById(h);w||(this.addConfigInfo(f),w=this._getConfigInfoById(h));var z=d.getObject("layer.fields",!1,w),r=r&&r.fields,r=n.arcade.appendArcadeExpressionsToFields(r,f);w.layer.fields=this._clipValidFields(z,r);f=new u({map:this.map,matchingMap:g,hideExportButton:e,allowTextSelection:c,layerInfo:f,configedInfo:w,nls:this.nls});this.featureTableSet[h]=f;b.resolve({isSupportQuery:a.isSupportQuery,table:f})}else b.resolve({isSupportQuery:!1})}else b.resolve(null)}),function(a){b.reject(a)});
return b},getRelationTable:function(h,g,e,c,b){var a=new t,f=this.relationshipsSet[g];this._activeRelationshipKey=g;if(f){var r=this._getLayerInfoById(h);h=this.getRelationShipInfo(f);this.getQueryTable(h.id,e,c,b).then(d.hitch(this,function(b){if(b&&b.table){var c=b.table;c.set("relatedOriginalInfo",r);c.set("relationship",f)}a.resolve(b)}),d.hitch(function(){a.resolve(null)}))}else a.resolve(null);return a},removeRelationTable:function(h){this.relationshipTableSet[h]&&(this.relationshipTableSet[h].destroy(),
this.relationshipTableSet[h]=null)},getCurrentTable:function(h){return this.featureTableSet[h]||this.relationshipTableSet[h]},collectRelationShips:function(h,g){this._collectRelationShips(h,h.layerObject,g)},getConfigInfoById:function(h){return this._getConfigInfoById(h)},getLayerInfoById:function(h){return this._getLayerInfoById(h)},getVisivleLayerInfoIndexById:function(h){return this._getVisivleLayerInfoIndexById(h)},getRelationshipsByInfoId:function(h){var g=[],e;for(e in this.relationshipsSet){var c=
this.relationshipsSet[e];c._layerInfoId===h&&g.push(c)}return g},getRelationShipInfo:function(h){var g;if(h)for(relKey in this.relationshipInfoMapping)h._relKey===relKey&&(g=this.relationshipInfoMapping[relKey]);return g},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var h in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[h]);this.relationshipsSet={};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=
null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(k.forEach(this._delayedLayerInfos,d.hitch(this,function(h){!this._getLayerInfoById(h&&h.id)&&this.map&&this.map.getLayer(h.id)&&this._layerInfosFromMap.push(h)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(h){for(var g=0,e=this._layerInfosFromMap.length;g<e;g++)if(this._layerInfosFromMap[g]&&this._layerInfosFromMap[g].id===h)return this._layerInfosFromMap[g]},_getVisivleLayerInfoIndexById:function(h){for(var g=
-1,e=0,c=this._layerInfosFromMap.length;e<c;e++)if(this._layerInfosFromMap[e]&&this._layerInfosFromMap[e].isShowInMap()&&(g++,this._layerInfosFromMap[e].id===h))return g},_getConfigInfoById:function(h){if(!d.getObject("layerInfos.length",!1,this.config))return null;for(var g=0,e=this.config.layerInfos.length;g<e;g++){var c=this.config.layerInfos[g];if(c&&c.id===h)return c}return null},_getQueryTableInfo:function(h){var g=new t,e=this._getLayerInfoById(h);if(e){var c=[],b=e.getUrl();c.push(e.getLayerObject());
c.push(e.getSupportTableInfo());b&&c.push(e.getRelatedTableInfoArray());p(c).then(d.hitch(this,function(a){if(this._activeLayerInfoId===h&&a){var f=a[0],c=a[1];a=b?a[2]:[];m.isDefined(a)&&m.isDefined(f)&&0<a.length&&this._collectRelationShips(e,f,a);g.resolve({layerInfo:e,layerObject:f,tableInfo:c})}else g.resolve(null)}),function(a){g.reject(a)})}else console.error("no activeLayerInfo!"),g.reject(Error());return g},_collectRelationShips:function(h,g,e){var c=g.relationships;if(c&&0<c.length&&g&&
g.url){var b=g.url.split("/");k.forEach(c,d.hitch(this,function(a){b[b.length-1]=a.relatedTableId;var f=b.join("/"),c=k.filter(e,d.hitch(this,function(a){a=a.getUrl();return m.isDefined(a)&&m.isDefined(f)&&q.removeProtocol(a.toString().toLowerCase())===q.removeProtocol(f.toString().toLowerCase())})),w=h.id+"_"+a.name+"_"+a.id;a._relKey=w;a._layerInfoId=h.id;c&&0<c.length&&this._setRelationShipInfo(a,c[0]);this.relationshipsSet[w]||(this.relationshipsSet[w]=a,this.relationshipsSet[w].objectIdField=
g.objectIdField)}))}},_setRelationShipInfo:function(h,g){h&&"_relKey"in h&&(this.relationshipInfoMapping[h._relKey]=g)},_removeRelationShipInfo:function(h){if(h&&"_relKey"in h)for(relKey in this.relationshipInfoMapping)h._relKey===relKey&&delete this.relationshipInfoMapping[relKey]},_getLayerInfoLabel:function(h){return h.name||h.title},_getLayerInfoId:function(h){return h&&h.id||""},_clipValidFields:function(h,g){if(!h||!h.length)return g||[];if(!g||!g.length)return h;for(var e=[],c=[],b=0,a=g.length;b<
a;b++){for(var f=g[b],r=0,w=h.length;r<w;r++){var z=h[r];if(z.name===f.name)break}r===w&&c.push(f)}b=0;for(a=h.length;b<a;b++)for(z=h[b],r=0,w=g.length;r<w;r++)if(f=g[r],f.name===z.name){e.push(z);break}e=e.concat(c);0===e.length&&0<h.length&&(h=d.clone(g),k.forEach(h,d.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,e.push(a))})));return e}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dijit/Menu dijit/MenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query dojo/string".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r,w,z,N,H,I,E,y,A,C,F,G,J,L,K,M,P,S,x,D,T,B,U,V,W,X,Y,Z,O,Q,R,aa){return l([k,z],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,actived:!1,showSelected:!1,
tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,constructor:function(a){a=a||{};this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",a.relatedOriginalInfo||null);this.set("relationship",a.relationship||null);this.set("syncSelection",!!a.syncSelection||!0)},postCreate:function(){this.inherited(arguments);
this._relatedQueryIds=[];this.createToolbar();this.loading=new U;this.loading.placeAt(this.domNode);this.selectionManager=Y.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;d.setAttr(this.domNode,"data-layerinfoid",x.getObject("layerInfo.id",!1,this));this.get("map")&&(this.own(D(this.map.root,N.release,x.hitch(this,function(){this._clickMap=!0}))),this.own(D(this.map,"extent-change",x.hitch(this,"_onExtentChange"))));this.own(D(window,"resize",x.hitch(this,
this._resize)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(d.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=x.clone(this._layerDefinition);return this._getFilterableFields(a.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},
setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this.loading.show():this.loading.hide()},active:function(){this.actived=!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var r=new e({},d.create("div")),w=new b;this.showSelectedRecordsMenuItem=
new g({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:x.hitch(this,this.toggleSelectedRecords)});w.addChild(this.showSelectedRecordsMenuItem);this.showRelatedRecordsMenuItem=new g({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:x.hitch(this,this.onShowRelatedRecordsClick)});w.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new g({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:x.hitch(this,
this.onFilterMenuItemClick)});w.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new g({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:x.hitch(this,this.onToggleColumnsClick)});w.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new g({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:x.hitch(this,this.onExportCSVClick)}),w.addChild(this.exportCSVMenuItem));this.selectionMenu=new f({label:this.nls.options,
iconClass:"esriAttributeTableOptionsImage",dropDown:w});r.addChild(this.selectionMenu);this.matchingCheckBox=new a({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,onChange:x.hitch(this,function(a){this.set("matchingMap",a);this._onMatchingCheckBoxChange(a)})});r.addChild(this.matchingCheckBox);this.zoomButton=new c({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:x.hitch(this,this.zoomTo)});r.addChild(this.zoomButton);this.clearSelectionButton=new c({label:this.nls.clearSelection,
iconClass:"esriAttributeTableClearImage",onClick:x.hitch(this,this.clearSelection,!0,!0)});r.addChild(this.clearSelectionButton);this.refreshButton=new c({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:x.hitch(this,this.refresh)});r.addChild(this.refreshButton);d.place(r.domNode,this.domNode);this.toolbar=r;this.own(D(this,"data-loaded,row-click,clear-selection",x.hitch(this,"changeToolbarStatus")))},startQuery:function(a){this.cancelThread();this._requestStatus=
"processing";this.loading.show();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=this._getLayerObject();this._currentDef.then(x.hitch(this,function(b){this.domNode&&(this.layer=b,(b=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&b.spatialReference&&b.spatialReference.isWebMercator()?(this._currentDef=P.normalizeCentralMeridian([b],null,x.hitch(this,function(a){return a[0]}))).then(x.hitch(this,
function(b){this._doQuery(b,a);this._normalizedExtent=b}),x.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()})):this._doQuery(b,a))}),x.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this.loading.hide()}))},queryRecordsByRelationship:function(a){var b=a&&a.layer,f=a&&a.selectedIds;a&&a.relationship&&this.set("relationship",a.relationship);a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);
var c=this.relationship;b&&c&&f&&0<f.length&&!O.isEqual(this._relatedQueryIds,f)&&x.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this.loading.show(),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(x.hitch(this,function(a){if(this.domNode){this.layer=a;var e=[],r=this.layer;B.forEach(r.fields,function(a){(!E.isDefined(a.show)||!0===a.show||"esriFieldTypeOID"===
a.type||E.isDefined(r.objectIdField)&&a.name===r.objectIdField)&&e.push(a.name)});a=new C;a.objectIds=f;a.outFields=e.length?e:["*"];a.relationshipId=c.id;a.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=b.queryRelatedFeatures(a,function(a){return a})).then(x.hitch(this,function(a){if(this.domNode){var b={displayFieldName:c.objectIdField,fields:r.fields,features:[],fieldAliases:null},e={},w=function(a){var f=a.attributes[this.layer.objectIdField];e[f]||(e[f]=!0,b.features.push(a))},
g;for(g in a){var z=a[g];B.forEach(z&&z.features,w,this)}d.destroy(this.tipNode);0<b.features.length?(this.grid||(this._removeTable(),d.place(this.loading.domNode,this.domNode)),a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,b.features.length,!1,b)):(this.tipNode=d.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),d.place(this.tipNode,this.domNode),d.place(this.loading.domNode,this.domNode));this._relatedQueryIds=f;this.emit("data-loaded");
this.loading.hide()}}),x.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);d.destroy(this.tipNode);this.tipNode=d.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();d.place(this.tipNode,this.domNode);d.place(this.loading.domNode,this.domNode);this.loading.hide();this.changeToolbarStatus()}))}}),x.hitch(this,function(a){console.error(a);this.loading.hide();this.changeToolbarStatus()}))):this.loading.hide()},getSelectedRows:function(){return this.tableCreated?
this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?
(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(){var a=this.getSelectedRows();0<a.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,
objectIds:a}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(x.hitch(this,function(a){console.log(a);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:a})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(x.hitch(this,function(a){if(this.domNode){a=x.clone(a);var b=this.getFilterableFields();a.fields=b;var f=new p({noFilterTip:this.nls.noFilterTip,style:"width:100%;",featureLayerId:this.layerInfo.id,
runtime:!0}),b=this._getFilterPopupSize();this._filterPopup=new W({titleLabel:this.nls.filter,width:b.w,height:b.h,content:f,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:x.hitch(this,function(){var a=f.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new t({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});f.startup();d.addClass(this._filterPopup.domNode,
"widget-at-filter-popup");b=this.getFilterObj();f.build({url:this.layer.url,partsObj:b,layerDefinition:this.layer||a,featureLayerId:this.layer.id})}}),x.hitch(this,function(a){this.domNode&&console.error(a)})).always(x.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var a={w:720,h:485};window.appInfo.isRunInMobile&&(a={w:window.innerWidth,h:window.innerHeight});return a},_resize:function(){if(this._filterPopup){var a=
this._getFilterPopupSize();this._filterPopup.resize(a)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=this._getRichTextFields(),b=this._getExportCSVPopupMessage(a),f=new t({"class":this.baseClass+"-popup",message:b,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:x.hitch(this,function(){var c=b._check;this.exportToCSV(null,"undefined"===typeof c||c.checked?null:a);
f.close()})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},_getExportCSVPopupMessage:function(a){var b=document.createElement("div");b.className="message-wrapper";b.appendChild(document.createTextNode(this.nls.exportMessage));if(a.length){var f=document.createElement("div");f.className="input-row";var c=new X({label:this.nls.keepRichTextLabel,checked:!0}),e=document.createElement("a");e.className="hint-button";e.href="#";e.role="button";e.appendChild(document.createTextNode(this.nls.whatsThis));
f.appendChild(c.domNode);f.appendChild(e);b.appendChild(f);b._check=c;this.own(D(e,"click",x.hitch(this,function(b){b.preventDefault();b={"class":this.baseClass+"-popup",message:this._getRichTextMessage(a)};window.appInfo.isRunInMobile||(b.width=500);new t(b)})))}return b},_getRichTextMessage:function(a){if(!a||a.hasOwnProperty("length")&&!a.length)return"";for(var b=document.createElement("div"),f="",c=0,e=a.length;c<e;c++)f+="\x3cmark\x3e"+a[c].fieldName+"\x3c/mark\x3e";a=""+("\x3cp\x3e"+aa.substitute(this.nls.richTextMessage.explanatoryText.line1,
{layerName:"\x3cstrong\x3e"+this.layer.name+"\x3c/strong\x3e"})+"\x3c/p\x3e");a=a+('\x3cdiv class\x3d"tags"\x3e'+f+"\x3c/div\x3e")+("\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line2+"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e for \x3cu\x3eArcGIS\x3c/u\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+
'\x3cpre\x3e\x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt for \x26ltu\x26gtArcGIS\x26lt/u\x26gt\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.second+"\x3cpre\x3eWeb AppBuilder for ArcGIS\x3c/pre\x3e\x3c/div\x3e");b.innerHTML=a;return b},_getRichTextFields:function(){var a=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo(),a=a&&a.fieldInfos,b=[];if(a)for(var f=0,c=a.length;f<c;f++){var e=a[f];e.stringFieldOption&&"richtext"===e.stringFieldOption&&
b.push(e)}return b},onSelectionComplete:function(){var a=this.layer&&this.layer.getSelectedFeatures();a&&(0===a.length?this.clearSelection(!1,0<this._selectionResults.length):this._selectBySelf(a)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(a)))},onSelectionClear:function(){this.clearSelection(!1,!0)},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",
this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",
!0);if(this.layerInfo&&this.isSupportQueryToServer()&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var b=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=b;b.then(x.hitch(this,function(a){this.domNode&&this.tableCreated&&a&&0<a.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",
!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",
!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",
!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=this.layer.objectIdField,b=this.getSelectedRows();0<b.length&&this.grid&&(this.grid.store instanceof H?this.grid.set("query",x.hitch(this,function(f){return"number"===typeof f&&-1<b.indexOf(f)||-1<b.indexOf(f[a])?!0:!1})):this.grid.set("query",function(){return b}))}},showAllSelectedRecords:function(){if(this.tableCreated&&
this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,b){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],a&&this.grid.set("query",{}),b&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();
this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a,b){this.layerInfo&&this.layer&&this.tableCreated&&this.getSelectedRowsData().then(x.hitch(this,function(f){var c=this.layer.objectIdField,e=[],r=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),w=this._hasArcadeExpressionFields();if(r){var g=B.map(this._getTableSelectedIds(),x.hitch(this,function(a){for(var b=0,e=f.length;b<e;b++)if(f[b]&&f[b][c]===a)return f[b];
return{}}))||[];0===g.length&&this.isSelectionMode()&&g.push({});e=g;0===g.length&&this.grid.store instanceof H&&(e=x.clone(this.grid.store.data));e.length&&this._appendXY(e)}var g={},z=this.getOutFields(!!e.length);g.datas=e;g.fromClient=!1;g.withGeometry="esriGeometryPoint"===this.layer.geometryType;g.outFields=z;g.formatNumber=!1;g.formatDate=!0;g.formatCodedValue=!0;g.popupInfo=this.layerInfo.getPopupInfo();g.objectIds=!r&&this._getExportObjectIds();g.outSpatialReference=!r&&x.clone(this.layer.fullExtent.spatialReference);
g.richTextFieldsToClear=b;w&&(g.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:O.getFeatureLayerDefinition(this.layer)});return Z.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,g)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&d.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=
this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!b},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||b},destroy:function(){this._destroyed||(this.layer=this.configedInfo=
this.layerInfo=null,this._selectionHandles&&B.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),
this.inherited(arguments))},_selectBySelf:function(a){a=a||[];if(a.length!==this._selectionResults.length)return!1;var b=this.layer.objectIdField;return B.every(this._selectionResults,function(f){return a.some(function(a){return f.attributes[b]===a.attributes[b]})})},_updateSelectRowsByFeatures:function(a){var b=B.map(a,x.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(b);this._selectionResults=a},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&
(this.selectionRows=a,B.forEach(a,x.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(d.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&
this.tableCreated&&this._relatedQuery)if(a)this.queryByStoreObjectIds=B.map(this.grid.store.data,x.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var b=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:b})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),b=a&&this._dblClickResult&&a===this._dblClickResult,
a=a&&a._layer===this.layer;this.domNode&&(b||a)&&(this.map.infoWindow.hide(),this._dblClickResult=null)},_getLayerObject:function(){function a(a){this._selectionHandles&&B.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(D(a,"selection-complete",x.hitch(this,"onSelectionComplete")));this._selectionHandles.push(D(a,"selection-clear",x.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(x.hitch(this,
function(b){var f=new r;"esri.layers.ArcGISImageServiceLayer"===b.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?(b=new F(b.url),this.own(D(b,"load",x.hitch(this,function(b){x.hitch(this,a)(b.layer);f.resolve(b.layer)})))):(x.hitch(this,a)(b),f.resolve(b));return f}))},_getLayerDifinition:function(){return this._layerDefinition?w(x.clone(this._layerDefinition)):y({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(x.hitch(this,function(a){this.setLayerDefinition(a);
return this.getLayerDefinition()}))},_getFilterableFields:function(a,b){return B.filter(a,function(a){return B.some(b,function(b){return a.name===b.name&&(b.show||!E.isDefined(b.show))&&x.mixin(a,b)})})},_getExportObjectIds:function(){var a=this._getTableSelectedIds()||[];if(0===a.length&&this.grid.store instanceof H){var b=this.layer.objectIdField;this.grid.store.query(function(f){a.push(f[b])})}return a},_doQuery:function(a,b){if(this.layer){var f=this.layer.objectIdField;this.isSupportQueryToServer()?
this._queryToServer(a,f,b):this.isSupportQueryOnClient()&&this._queryOnClient(a,f,b)}},_queryOnClient:function(a,b,f){var c={};c.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():B.filter(this.layer.graphics,x.hitch(this,function(a){return!a.wabIsTemp}));f&&0<f.length&&(c.features=B.filter(c.features,function(a){return-1<f.indexOf(a.attributes[this.layer.objectIdField])},this));var e=this.layer.fields,r=this.configedInfo.layer.fields;c.fields=r?B.filter(r,
x.hitch(this,function(a){E.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var f=0,c=e.length;f<c;f++)e[f].name!==a.name||a.type||(a.type=e[f].type);return a.show||a._pk})):B.filter(e,x.hitch(this,function(a){E.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var r=[],w=c.features.length,g=0;g<w;g++)c&&c.features&&c.features[g]&&c.features[g].geometry&&
r.push(c.features[g].geometry);a&&I.defaults.geometryService&&0<r.length?a.spatialReference.equals(r[0].spatialReference)?(c.features=B.filter(c.features,x.hitch(this,function(b){if(b&&b.geometry)return M.intersects(a,b.geometry)})),this.queryExecute(c.fields,c.features.length,!1,c,a)):(w=new A,w.geometries1=r,w.geometries2=[a],w.relation=A.SPATIAL_REL_INTERSECTION,(this._currentDef=I.defaults.geometryService.relation(w,x.hitch(this,function(a){return a}))).then(x.hitch(this,function(b,f){for(var c=
f.length,e=[],r=0;r<c;r++)e.push(b.features[f[r].geometry1Index]);b.features=e;this.queryExecute(b.fields,b.features.length,!1,b,a)},c),x.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))):this.queryExecute(c.fields,c.features.length,!1,c,a)},_queryToServer:function(a,b,f){this._getFeatureCount(a,f).then(x.hitch(this,function(c){if(this.domNode)if(f)this._queryFeatureLayer(a,b,c,!1,f);else{var e=this.layer,r=E.isDefined(e.maxRecordCount)?
e.maxRecordCount:1E3;this._batchCount=Math.min(r,this._defaultBatchCount);if(c<=r||!this.layer.objectIdField)this._queryFeatureLayer(a,b,c,!1);else{var w=this._getOutFieldsFromLayerInfos(b),g={fields:this.layer.fields};this.layer._recordCounts=c;e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsPagination?this.queryExecute(w,c,!0,g,a):this._getFeatureIds(b,a).then(x.hitch(this,function(b){this.domNode&&(this.layer._objectIds=b,this.queryExecute(w,c,!0,g,a))}),x.hitch(this,function(a){console.error(a);
this.changeToolbarStatus()}))}}}),x.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))},_getFeatureCount:function(a,b){var f=new r,c=new G(this.configedInfo.layer.url),e=new J;e.returnGeometry=!1;e.where=this._getLayerFilterExpression();b&&(e.where+=" AND "+this.layer.objectIdField+" IN ("+b.join()+")");a&&(e.geometry=a);(this._currentDef=c.executeForCount(e,x.hitch(this,function(a){return a}))).then(x.hitch(this,function(a){f.resolve(a)}),x.hitch(this,function(a){a&&"Request canceled"!==
a.message&&(console.error(a),console.log("Could not get feature count."));this.loading.hide();f.reject(a)}));return f},_queryFeatureLayer:function(a,b,f,c,e){var r=new G(this.configedInfo.layer.url),w=new J;w.where=this._getLayerFilterExpression();e&&b&&(w.where+=" AND "+b+" IN ("+e.join()+")");var g=this._getOutFieldsFromLayerInfos(b);e=this._hasArcadeExpressionFields();if(0<g.length&&!e){var z=[];B.forEach(g,function(a){z.push(a.name)});w.outFields=z}else w.outFields=["*"];a&&(w.geometry=a,w.spatialRelationship=
J.SPATIAL_REL_INTERSECTS);w.outSpatialReference=x.clone(this.map.spatialReference);w.returnGeometry="esriGeometryPoint"===this.layer.geometryType;b&&(w.orderByFields=[b+" ASC"]);(this._currentDef=r.execute(w,x.hitch(this,function(a){return a}))).then(x.hitch(this,function(b){this.queryExecute(g,f,c,b,a)}),x.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))},_getFeatureIds:function(a,b){var f=new r,c=new G(this.configedInfo.layer.url),
e=new J;e.returnGeometry=!1;e.returnIdsOnly=!0;e.where=this._getLayerFilterExpression();if(this.layer._orderByFields||a)e.orderByFields=this.layer._orderByFields||[a+" ASC"];b&&(e.geometry=b);(this._currentDef=c.executeForIds(e,x.hitch(this,function(a){return a}))).then(x.hitch(this,function(a){f.resolve(a)}),x.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));f.resolve([])}));return f},queryExecute:function(a,b,f,c,e){var r=[],r=
null,w={};if(this.domNode){c.fields=this._processExecuteFields(this.layer.fields,a);f?r=Q.generateCacheStore(this.layer,b,this._batchCount,this._getLayerFilterExpression(),e):(r=B.map(c.features,x.hitch(this,function(a){var b=x.clone(a.attributes);return x.mixin(b,{geometry:a.geometry})})),r=Q.generateMemoryStore(r,this.layer.objectIdField));a=this.layer.typeIdField;var w=this.layer.types,g=x.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),z=x.getObject("advancedQueryCapabilities.supportsPagination",
!1,this.layer),h=x.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),w=Q.generateColumnsFromFields(this.grid&&this.grid.columns,this.layerInfo,c.fields,a,w,g&&z||!f,h,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(w.attachmentsColumn=this.formatAttachmentsColumn());f=20+100*c.fields.length<d.getMarginBox(this.domNode).w;this.createTable(w,r,b,f);this._currentExtent=e;b=this.layer.getSelectedFeatures();this.selectionRows&&
0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):b&&0<b.length?this._updateSelectRowsByFeatures(b):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=x.hitch(this,function(a,b,f){var c=a[this.layer.objectIdField];this.layer.queryAttachmentInfos(c,
x.hitch(this,function(a){var b=B.map(a,x.hitch(this,function(a){var b=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",f=S.findCredential(this.layer.url);return'\x3cli class\x3d"'+b+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+c+"/attachments/"+a.id+(f?"?token\x3d"+f.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),e="";0<a.length&&(e=" "+this.nls.files);e='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
a.length+e+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+b.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+b.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";e=d.toDom(e);0<a.length&&(a=R(".show-attachments-div",e)[0],d.addClass(a,"has-attachments"));f.appendChild(e);this.own(D(f,"click",x.hitch(this,
function(a){a=a&&a.target;if(d.hasClass(a,"show-attachments-div")||d.hasClass(a,"show-attachments")||d.hasClass(a,"close")){a=this._visibleAttachmentPopup;var c=R(".attachment-popup",f)[0];c&&0<b.length&&d.toggleClass(c,"show");d.hasClass(c,"show")?this._visibleAttachmentPopup=c:this._visibleAttachmentPopup=null;a&&a!==c&&d.toggleClass(a,"show")}})))}),x.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,b,f,c){if(this.grid)this.grid.set("store",b),this.grid.set("columns",
a),this.grid.refresh();else{var e={};e.columns=a;e.store=b;e.keepScrollPosition=!0;e.pagingDelay=1E3;e.allowTextSelection=this.allowTextSelection;e.deselectOnRefresh=!1;this.layer.objectIdField||(e.minRowsPerPage=this.layer.maxRecordCount||1E3,e.maxRowsPerPage=this.layer.maxRecordCount||1E3,e.selectionMode="none");this.grid=new (l([m,q,u,n,v]))(e,d.create("div"));d.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&d.destroy(this.tipNode);this.own(D(this.ownerDocument,"keydown",
x.hitch(this,function(a){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(D(this.ownerDocument,"keyup",x.hitch(this,function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.layer.objectIdField&&(this.own(D(this.grid,".dgrid-header .dgrid-cell:click",x.hitch(this,this._onHeaderClick))),this.own(D(this.grid,"dgrid-columnstatechange",x.hitch(this,this._onColumnStateChange))),
this.own(D(this.grid,".selection-handle-column:click",x.hitch(this,this._onSelectionHandleClick))),this.own(D(this.grid,".dgrid-row:dblclick",x.hitch(this,this._onDblclickRow))),this.own(D(this.grid,"dgrid-sort",x.hitch(this,function(a){this.emit("sort",a)}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(D(a,"click",x.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,
this.configedInfo.isDescending):this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(a=R(".dgrid-scroller",this.grid.domNode)[0],e=R(".dgrid-header",this.grid.domNode)[0],b=d.getComputedStyle(a),e=d.getMarginBox(e),b=parseInt(b.marginTop,10),isFinite(b)&&e&&b<e.h&&d.setStyle(a,"marginTop",e.h+"px"));c?d.addClass(this.domNode,"auto-width"):d.removeClass(this.domNode,"auto-width");this.footer?d.empty(this.footer):this.footer=d.create("div",{"class":"jimu-widget-attributetable-feature-table-footer"},
this.domNode);f=d.create("div",{"class":"dgrid-status self-footer",innerHTML:f+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=d.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},f,"after");f=d.getStyle(this.domNode,"height");this.changeHeight(f);this._requestStatus="fulfilled";this.tableCreated=!0;d.place(this.loading.domNode,
this.grid.domNode);this.loading.hide()},getSelectedRowsData:function(){var a=new r,b=this._getTableSelectedIds()||[];if(!this.grid||!b.length)return a.resolve(null),a;this.grid.store instanceof H?(b=x.clone(this.grid.store.data),a.resolve(b)):this.grid.store.query(b,{_export_count:b.length}).then(x.hitch(this,function(b){b=b&&x.clone(this.grid.store._entityData||this.grid.store.data);a.resolve(b)}));return a},_appendXY:function(a){a&&"esriGeometryPoint"===this.layer.geometryType&&B.forEach(a,function(a){var b=
a.geometry;b&&"point"===b.type&&("x"in a?a._x=b.x:a.x=b.x,"y"in a?a._y=b.y:a.y=b.y);delete a.geometry})},getOutFields:function(a){var b=null,b=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),b=this._processExecuteFields(this.layer.fields,b),b=x.clone(b);a&&(a="",a=-1!==b.indexOf("x")?"_x":"x",b.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),a=-1!==b.indexOf("y")?"_y":"y",b.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));
return b},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var a=this.getSelectedRows(),b=0;if(this.grid.store instanceof H){var f=B.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);B.forEach(a,function(a){-1<f.indexOf(a)&&b++})}else b=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+b+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},
_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(x.hitch(this,function(a){if(a&&this.domNode){var b=null;if("point"===a.type){var f=this.map.getNumLevels(),c=this.map.getLevel(),b=this.map.getMaxZoom();0<f?(c===b?f=c:(f=c+4,f>b&&(f=b)),b=this.map.centerAndZoom(a,f)):b=this.map.centerAndZoom(a,1/Math.pow(2,4)*2)}else b=this.map.setExtent(a.expand(2));return b.then(function(){return a})}}))},_showMapInfoWindowByFeatures:function(a,b){if(b&&0!==b.length&&this.domNode){var f=this.map.infoWindow,
c=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(f&&f.setFeatures&&1===b.length&&c){B.forEach(b,x.hitch(this,function(a){a._layer=this.layerInfo.layerObject;a.setInfoTemplate(c)}));f.setFeatures(b);var e=null,e="point"===a.type?b[0].geometry:a.getCenter();f.show(e,{closetFirst:!0});this._dblClickResult=b[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,b){if(b&&0<b.length){if("rowclick"===a||"selectall"===a)this._setSelection(b);else if("zoom"===
a||"row-dblclick"===a){var f=O.graphicsExtent(b),c=O.toFeatureSet(b),e=D(this.map,"zoom-end, pan-end",x.hitch(this,function(){e.remove();"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(f,b)}));O.zoomToFeatureSet(this.map,c).then(null,function(a){a&&(console.error(a.message),e&&e.remove())})}this.setSelectedNumber()}else this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var b=this.map.infoWindow,f=x.isArray(a)?a:[a];D.once(b,"hide",x.hitch(this,function(){c&&
c.remove&&(c.remove(),c=null)}));var c=T.after(b,"show",x.hitch(this,function(){var a=b.getSelectedFeature(),a=a&&f[0]===a,e=-1;b.features&&(e=b.features.indexOf(f[0]));!a&&-1<e?b.select(e):this.domNode&&!a&&c&&c.remove&&(c.remove(),c=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var b=[],f,c,e=a.length,r=this.layer.graphics.length,w=this.layer.objectIdField,g=0;g<e;g++)for(var z=0;z<r;z++)if(f=this.layer.graphics[z].attributes[w]+"",c=a[g]+"",f===c){b.push(this.layer.graphics[z]);break}return b},
getExtent:function(a){var b=new r,f,c,e=a.length;if(1===e&&a[0].geometry&&"point"===a[0].geometry.type)f=a[0].geometry;else if(1!==e||a[0].geometry)for(var w=0;w<e;w++)a[w].geometry?"point"===a[w].geometry.type?(c||(c=new K(a[w].geometry.spatialReference)),c.addPoint(a[w].geometry),w===e-1&&(f=c.getExtent())):f=f?f.union(a[w].geometry.getExtent()):a[w].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[w]);else return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),
b;if(!f||!f.spatialReference)return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;a=this.map.spatialReference;f.spatialReference.equals(a)?b.resolve(f):(c=new L,c.geometries=[f],c.outSR=a,I.defaults.geometryService.project(c,x.hitch(this,function(a){this.domNode&&(a&&a.length?b.resolve(a[0]):b.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),x.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));b.reject(a)})));
return b},_onFeaturelayerClick:function(a,b){if(this.actived){var f=x.getObject("graphic",!1,a),c=x.getObject("graphic.attributes",!1,a);c&&f&&f._layer===this.layer&&((f=this.map.infoWindow.getSelectedFeature())&&f._layer===this.layer&&!b&&this.map.infoWindow.hide(),b=c[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(b).then(x.hitch(this,function(b){-1!==b&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*b}),this.map.infoWindow.features&&(b=this.map.infoWindow.features.indexOf(a.graphic),
this.map.infoWindow.select(b)),D.once(this.map.infoWindow,"selection-change",x.hitch(this,function(){var b=this.map.infoWindow.getSelectedFeature(),f=x.getObject("_layer",!1,b);b!==a.graphic&&f===this.layer&&this._onFeaturelayerClick({graphic:b},!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var b=new r,f=-1,c=x.getObject("store.objectIds",!1,this.grid),f=null,f=this.grid.get("sort")[0];if(this._relatedQuery)return b.resolve(-1),b;if(this.grid.store instanceof
H)a=this.grid.store.get(a),c=this.grid.store.data,a?f&&f.attribute&&E.isDefined(f.descending)?(c=x.clone(c),f=function(a,b){return function(f,c){return f[a]===c[a]?0:f[a]<c[a]?b?1:-1:b?-1:1}}(f.attribute,f.descending),c.sort(f),c=B.map(c,function(a){return a[this.layer.objectIdField]},this),f=c.indexOf(a[this.layer.objectIdField])):f=c.indexOf(a):f=-1,b.resolve(f);else if(c&&0<c.length)f=c.indexOf(a),b.resolve(f);else{c=new J;c.returnGeometry=!1;c.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+
" \x3c "+a;if(f&&(f.attribute!==this.layer.objectIdField||f.descending))return b.resolve(-1),b;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(c.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(c)).then(x.hitch(this,function(a){b.resolve(a)}),x.hitch(this,function(a){b.reject(a)}))}return b},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,b){if(0!==a.length){var f=
this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==f.length?this._queryFeaturesByIds(a,b):this.selectFeatures(b,f)}},_onDblclickRow:function(a){this.layerInfo&&this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},_queryFeaturesByIds:function(a,b){var f=new J;f.objectIds=a;f.returnGeometry=!0;f.outSpatialReference=x.clone(this.map.spatialReference);f.outFields=["*"];a=this.layer;var c="esri.layers.CSVLayer"===a.declaredClass;
a.url&&!c?(new G(a.url)).execute(f,x.hitch(this,function(a){this.selectFeatures(b,a.features)}),x.hitch(this,this._errorSelectFeatures)):a.selectFeatures(f,F.SELECTION_NEW,x.hitch(this,this.selectFeatures,b),x.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var b=this.grid.cell(a);this._showColumnMenu(b.column,b,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(a,b,f,c){var e=x.getObject("_cache",!1,a);if(e&&(e.sortable||e.statistics)){var r=new h({});d.addClass(r.domNode,
"jimu-widget-attributetable-feature-menu");var w=this;if(e.sortable){var z=["iconSortAscending","iconSortDescending"];B.forEach([this.nls.sortAsc,this.nls.sortDes],function(b,f){b=new g({label:b,iconClass:z[f],baseClass:"menuItemClass",onClick:function(){0===f?w.grid.set("sort",a.field,!1):1===f&&w.grid.set("sort",a.field,!0)}});r.addChild(b)})}e.statistics&&(e=new g({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:x.hitch(this,function(){var b={layer:this.layer,
filterExpression:this._getLayerFilterExpression(),fieldNames:[a.field]};this.matchingMap&&(b.geometry=this._currentExtent);if(this.showSelected){var f=this._getSelectedIds();b.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+f.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(b.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new V;this.fieldStatistics.showContentAsPopup(b)})}),r.addChild(e));
e=r.getChildren();r.startup();r._openMyself({target:f,delegatedTarget:b,iframe:null,coords:c});this.own(D(r,"Close",x.hitch(this,function(){var a=this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",r);1>e.length&&D.emit(r,"Close")}},_onColumnStateChange:function(a){if(a&&a.grid&&a.grid.columns){var b=0,f;for(f in a.grid.columns)a.grid.columns[f].hidden||b++;20+100*b-1<d.getMarginBox(this.domNode).w?d.addClass(this.domNode,"auto-width"):d.removeClass(this.domNode,
"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));this.setSelectedNumber();this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var b=x.getObject("delta.x",!1,a),f=x.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(b)&&isFinite(f)&&(0<Math.abs(b)||0<Math.abs(f)):!0;this._clickMap=!1;a&&this.matchingMap&&
this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var b=this.configedInfo.layer.fields,f=this.layerInfo.getPopupInfo(),c=f&&f.fieldInfos,e=[];b&&B.forEach(b,x.hitch(this,function(b){if(!E.isDefined(b.show)&&(b.show=!0,c))for(var f=0,r=c.length;f<r;f++){var w=c[f];w.fieldName===b.name&&(b.show=w.visible)}b.name!==a||"esriFieldTypeOID"!==
b.type&&"esriFieldTypeInteger"!==b.type&&b.type||(b._pk=!0);(b.show||b._pk)&&e.push(b)}));return e},_processExecuteFields:function(a,b){if(a&&0<a.length){var f=[];if(!b.length)return a;for(var c=0,e=b.length;c<e;c++)for(var r=0;r<a.length;r++)b[c].name!==a[r].name||b[c].type!==a[r].type&&b[c].type||(a[r]=x.mixin(a[r],b[c]),f.push(a[r]));return f}return b},_getSelectedIds:function(){var a=[],b=this.grid.selection,f;for(f in b)b[f]&&(isFinite(f)?a.push(parseInt(f,10)):a.push(f));return a},_getTableSelectedIds:function(){var a=
[],b=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof H){var f=B.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);B.forEach(b,function(b){-1<f.indexOf(b)&&a.push(parseInt(b,10))})}else a=b;return a},isSelectionMode:function(){var a=this.getSelectedRows();return this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?!0:!1},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var b=new t({message:a,buttons:[{label:this.nls.ok,
onClick:x.hitch(this,function(){b.close()})}]});this.loading.hide()},_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&B.some(this.configedInfo.layer.fields,function(a){return Q.arcade.isArcadeExpressionField(a)})}})})},"jimu/dijit/Filter":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet ./LoadingIndicator".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r,w,z){return k([t,p,m,u,d],{templateString:q,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;this.nls.apply=
window.jimuNls.common.apply;this.layerInfosObj=v.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip)},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():
this._setMobileMode())},setMode:function(a){"desktop"===a?this._setDesktopMode():"mobile"===a&&this._setMobileMode()},_setMode:function(a){this.mode=a;this._setModeClass(this.mode)},_setModeClass:function(a){c.removeClass(this.domNode,"desktop-mode");c.removeClass(this.domNode,"mobile-mode");c.addClass(this.desktopAddSection,"hidden");c.addClass(this.mobileAddSection,"hidden");a&&c.addClass(this.domNode,a+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");
c.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");c.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new f;this.isBuilding()?b.reject("Filter is already building."):
(this._def=null,this.reset(),this.url=a.url,this.isHosted=n.isHostedService(this.url),this._layerDefinition=a.layerDefinition,this.featureLayerId=a.featureLayerId,a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr")),b=this._def);return b},buildByExpr:function(a,b,f){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:a,expr:b,layerDefinition:f,
featureLayerId:this.featureLayerId})},buildByFilterObj:function(a,b,f){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:a,partsObj:b,layerDefinition:f,featureLayerId:this.featureLayerId})},_updatePartsObj:function(a){b.forEach(a,e.hitch(this,function(a){a.parts?b.forEach(a.parts,e.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade=
"none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(a,b){var c=new f;b?c.resolve(b):(this.loading.show(),r({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(a){this.domNode?(this.loading.hide(),c.resolve(a)):c.reject()}),e.hitch(this,function(a){console.error(a);
c.reject();this.domNode&&this.loading.hide()})));return c},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(a){var w=new f;if(!this._isString(this.url))return w.reject(),w;var g=e.hitch(this,function(){setTimeout(e.hitch(this,function(){this.emit("change");w.resolve()}),1500)}),z=e.hitch(this,function(){c.addClass(this.errorSection,"hidden");this.removeAllFilters();var f;this.featureLayerId&&(this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition),f=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo());
var r=this._layerDefinition.fields;r&&0<r.length?(this._popupFieldsInfo=f?n.completePopupFieldFromLayerField(r,f.fieldInfos):r,(r=b.filter(r,e.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<r.length?(this._validOptions=!0,c.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),c.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),c.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),c.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),
this.valueProviderFactory=new h({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===a?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?g():w.reject()):w.reject():"partsObj"===a?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),g()):w.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),g()):this._isString(this.expr)?this._parseExpr(this.expr)?
g():w.reject():(this.removeAllFilters(),g())):(this._showErrorOptions(this.nls.error.noFilterFields),w.reject())):(f&&(this._popupFieldsInfo=f.fieldInfos),w.reject())});this._validateLayerDefinition(this._layerDefinition)?z():(this.loading.show(),r({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,z()):w.reject()}),e.hitch(this,function(a){console.error(a);w.reject();this.domNode&&
this.loading.hide()})));return w},_tryOverrideFieldAliases:function(a,f){if(a=this.layerInfosObj.getLayerOrTableInfoById(a))if(a=a.getPopupInfo())if(a=a.fieldInfos,f=f.fields,a&&0<a.length&&f&&0<f.length){var c={};b.forEach(a,e.hitch(this,function(a){a.fieldName&&(c[a.fieldName]=a)}));b.forEach(f,e.hitch(this,function(a){var b=c[a.name];b&&b.label&&(a.alias=b.label)}))}},toJson:function(){var a={logicalOperator:this.allAnySelect.value,parts:[]},f=this._getAllSingleFiltersAndFilterSets();if(0===f.length)return a.expr=
"1\x3d1",a;b.forEach(f,e.hitch(this,function(b){b=b.toJson();a.parts.push(b)}));return b.every(a.parts,e.hitch(this,function(a){return!!a}))&&0<a.parts.length?(a.expr=this.getExprByFilterObj(a),a):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var a=e.clone(this._layerDefinition.fields);0===this.setFieldsStoreByFieldInfos(a)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},
_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(I){b=null,console.error(I)}b?this._buildEditUIByPartsObj(b):
this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(a){a&&(this._destroyAllFilters(),b.forEach(a.parts,e.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})),this.allAnySelect.value=a.logicalOperator,this._setFilterMsgUI(a.parts.length))},_addSingleFilter:function(b){b={url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,
numberFieldTypes:this._numberFieldTypes,part:b,OPERATORS:e.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};b=new w(b);b.placeAt(this.allExpsBox);b.startup();this.own(a.after(b,"_destroySelf",e.hitch(this,function(){this._checkFilterNumbers();this.emit("change")})));this.own(l(b,"change",e.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_addFilterSet:function(b){b=
{url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:b,OPERATORS:e.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};b=new z(b);b.placeAt(this.allExpsBox);b.startup();this.own(a.after(b,"_destroySelf",e.hitch(this,function(){this._checkFilterNumbers();
this.emit("change")})));this.own(l(b,"change",e.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var a=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&b.forEach(this.allExpsBox.childNodes,e.hitch(this,function(b){(c.hasClass(b,"jimu-single-filter")||
c.hasClass(b,"jimu-filter-set"))&&a.push(b)}));return a},_getAllSingleFiltersAndFilterSets:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();return b.map(a,e.hitch(this,function(a){return g.byNode(a)}))},_setFilterMsgUI:function(a){2>a?(this.allAnySelect.value="AND",c.setStyle(this.allAnySelect,"display","none"),c.setStyle(this.oneOrZeroMsg,"display","block")):(c.setStyle(this.oneOrZeroMsg,"display","none"),c.setStyle(this.allAnySelect,"display","block"))},_checkFilterNumbers:function(){var a=
this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(a.length);0<a.length?c.addClass(this.noFilterTipSection,"hidden"):c.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);c.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},
_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){var b={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,
supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},
stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},
dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},
a=k([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(a){l.mixin(this,a);this.nls=window.jimuNls.filterBuilder;a=c.getInstanceSync();this.featureLayerId&&(this.layerInfo=a.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(a,c){var f=[];if(c=b[c])c.value&&f.push("value"),c.field&&0<this._getSameShortTypeFieldNames(a).length&&f.push("field"),c.unique&&this.url&&
(this._isStreamServer(this.url)||f.push("unique")),c.multiple&&this.url&&(this._isStreamServer(this.url)||f.push("multiple")),c.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||f.push("uniquePredefined")),c.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||f.push("multiplePredefined"));return f},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(b){var f=[],c=this._getFieldInfo(this.layerDefinition,
b),e=a.getShortTypeByEsriType(c.type);d.forEach(this.layerDefinition.fields,l.hitch(this,function(c){c.name!==b&&a.getShortTypeByEsriType(c.type)===e&&f.push(c.name)}));return f},_getSameShortTypeFieldNameLabels:function(b){var f=[],c=this._getFieldInfo(this.layerDefinition,b),e=a.getShortTypeByEsriType(c.type);d.forEach(this.layerDefinition.fields,l.hitch(this,function(c){c.name!==b&&a.getShortTypeByEsriType(c.type)===e&&f.push({value:c.name,label:c.alias})}));return f},getValueProvider:function(a,
c){var f=null,r=l.clone(b[a.operator]);if(r){var d=a.valueObj.type,k=a.fieldObj.name,I=this._getFieldInfo(this.layerDefinition,k),E=r[d],y=E.normalProviderType,A=null,C=e.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,k);"field"===d?(k=this._getSameShortTypeFieldNameLabels(k),0<k.length&&(A=k)):C&&0<C.length&&E.codedValueProviderType&&(y=E.codedValueProviderType);a={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:a,fieldInfo:I,codedValues:C,staticValues:A,layerInfo:this.layerInfo,
popupInfo:this.popupInfo,operatorInfo:r,filterCodedValueIfPossible:!!E.filterCodedValueIfPossible,runtime:c};if("BLANK_VALUE_PROVIDER"===y)f=new t(a);else if("SIMPLE_VALUE_PROVIDER"===y)f=new p(a);else if("TWO_NUMBERS_VALUE_PROVIDER"===y)f=new m(a);else if("TWO_DATES_VALUE_PROVIDER"===y)f=new q(a);else if("LIST_VALUE_PROVIDER"===y)a.showNullValues=!1,"value"===d||"field"===d?f=new u(a):(a.providerType=y,a.selectUI="dropdown",f=new n(a));else if("NUMBER_LIST_VALUE_PROVIDER"===y)f=new h(a);else if("DATE_IS_IN_VALUE_PROVIDER"===
y)f=new g(a);else if("ADVANCED_LIST_VALUE_PROVIDER"===y)a.providerType=y,a.selectUI="dropdown",f=new n(a);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===y||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===y)a.providerType=y,a.selectUI=a.partObj.valueObj?a.partObj.valueObj.selectUI:null,f=c?new n(a):new v(a)}return f},_getFieldInfo:function(a,b){a=a.fields;for(var f=0;f<a.length;f++){var c=a[f];if(b===c.name)return c}return null}});a.getOperatorInfo=function(a){return l.clone(b[a])};a.getOperatorsByShortType=
function(a,b){var f=[];"string"===a?f="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===a?f="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===a&&(f="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),b&&f.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return f};a.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return a})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(l,d,k){return d([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);l.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),function(l,d,k,t,p,m,q,u,n,v){return m([q,u,d],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,
cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&
this.filterCodedValueIfPossible&&n.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&p.some(this.popupInfo.fieldInfos,k.hitch(this,function(h){return h.fieldName===this.fieldName?(this.fieldPopupInfo=h,!0):!1}))},getDijits:function(){return[]},bindChangeEvents:function(){var h=this.getDijits();p.forEach(h,k.hitch(this,function(g){g.declaredClass&&
0===g.declaredClass.indexOf("dijit.")&&t.addClass(g.domNode,g.declaredClass.replace(/\./g,"-"));this.own(l(g,"change",k.hitch(this,this._onChanged)));this.own(l(g,"enter",k.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(k.hitch(this,function(){this._onEnterTriggered=!1}),100)},tryLocaleNumber:function(h){var g=n.localizeNumber(h);
if(null===g||void 0===g)g=h;return g},getPartObject:function(){var h=this.getValueObject();if(!h)return null;var g=k.clone(this.partObj);g.valueObj=h;return g},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var h=1,g=this.getDijits();0<g.length&&(h=p.map(g,k.hitch(this,function(e){return"function"===typeof e.getStatus?e.getStatus():this.getStatusForDijit(e)})),h=Math.min.apply(h,h));return h},
getStatusForDijit:function(h){return h.validate()?h.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var h="1\x3d1",h=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var g=this.getCascadeFilterExpr(),h="("+h+") AND ("+g+")";return h},getLayerFilterExpr:function(){var h=
"1\x3d1";this.layerInfo&&(h=this.layerInfo.getFilter());h||(h="1\x3d1");return h},_getWebMapFilterExpr:function(){var h="";this.layerInfo&&(h=this.layerInfo.getFilterOfWebmap());h||(h="1\x3d1");return h},getDropdownFilterExpr:function(){var h="1\x3d1",h=this._getWebMapFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var g=this.getCascadeFilterExpr(),h="("+h+") AND ("+g+")";return h},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var h={parts:[]};
if("all"===this.cascade||"previous"===this.cascade)h=this.getCascadeFilterPartsObj();return h},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(h,g,e,c){var b=n.getFieldInfoByFieldName(h.fields,g),a=h.typeIdField,f=null;e=e.parts;for(var r in e){var w=e[r];if(w.fieldObj.name===a){a=w.valueObj.value;f=n._getCodedValueBySubTypeId(h,g,a,b);break}}var z;f||(f=c?c:n._getAllCodedValue(h,b));f&&0<f.length&&(z=f[0].value);return{selectedValue:z,valueLabels:f}},isDefined:function(h){return v.isDefined(h)},
disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/keys ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),function(l,d,k,t,p,m,q){return d([t],{templateString:'\x3cdiv tabindex\x3d"0"\x3e\x3c/div\x3e',_dijit:null,postCreate:function(){this.inherited(arguments);
l.addClass(this.domNode,"jimu-filter-simple-value-provider");"string"===this.shortType?(this._dijit=new p({required:!1,trim:!0,intermediateChanges:!1}),this._dijit.startup(),this._dijit.on("keydown",function(d){(d.keyCode||d.which)===k.ENTER&&(this._dijit.textbox.blur(),this._dijit.emit("enter"),this.domNode.focus())}.bind(this))):"number"===this.shortType?(this._dijit=new m({required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}}),this._dijit.startup(),this._dijit.on("keydown",
function(d){(d.keyCode||d.which)===k.ENTER&&(this._dijit.textbox.blur(),this._dijit.emit("enter"),this.domNode.focus())}.bind(this))):this._dijit=new q({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo});l.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},getDijits:function(){return[this._dijit]},setValueObject:function(d){this.isDefined(d.value)&&("date"===this.shortType?this._dijit.setValueObject(d):this._dijit.set("value",d.value))},getValueObject:function(){if(this.isValidValue())if("date"===
this.shortType){var d=this._dijit.getValueObject();if(d&&d.value)return d.isValid=!0,d.type=this.partObj.valueObj.type,d}else return d=this._dijit.get("value"),"number"===this.shortType&&(d=parseFloat(d)),{isValid:!0,type:this.partObj.valueObj.type,value:d};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(d){this._dijit.set("required",d)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./DateValueSelector.html jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e){return q([u,n,v,d],{templateString:h,virtualDates:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);t.addClass(this.domNode,"jimu-date-value-selector");this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[g.VIRTUAL_DATE_TODAY,g.VIRTUAL_DATE_YESTERDAY,g.VIRTUAL_DATE_TOMORROW]);this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});this.dateTypeSelect.addOption({value:"custom",
label:this.nls.custom});m.map(this.virtualDates,p.hitch(this,function(c){var b={value:c,label:c};switch(c){case g.VIRTUAL_DATE_TODAY:b.label=this.nls.today;break;case g.VIRTUAL_DATE_YESTERDAY:b.label=this.nls.yesterday;break;case g.VIRTUAL_DATE_TOMORROW:b.label=this.nls.tomorrow}this.dateTypeSelect.addOption(b)}));this._showDateTypeSelect();this.own(k(t.byId("main-page"),"click",p.hitch(this,function(){this.dateTextBox&&this.dateTextBox.closeDropDown()})));this.own(l.before(this.dateTypeSelect,"openDropDown",
p.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(l.after(this.dateTypeSelect,"closeDropDown",p.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(l.after(this.dateTypeSelect.dropDown,"onItemClick",p.hitch(this,
function(c,b){c&&"custom"===c.option.value&&this._showDateTextBox()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(p.hitch(this,function(c){return c.fieldName===this._fieldInfo.name}))[0])},getDijits:function(){return[]},setValueObject:function(c){c.virtualDate&&"custom"!==c.virtualDate?this.dateTypeSelect.set("value",c.virtualDate,!1):(this.dateTypeSelect.set("value","custom",!1),c.value&&(this.dateTextBox.set("value",new Date(c.value),!1),this.dateTypeSelect.textDirNode.innerText=
this._formatDate(new Date(c.value))))},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var c={value:null,virtualDate:""},b=this.dateTypeSelect.get("value"),a=null;"custom"===b?(a=this.dateTextBox.get("value"),c.value=a?a.toDateString():null,c.virtualDate=""):(a=g.getRealDateByVirtualDate(b),c.virtualDate=b,a?c.value=a.toDateString():c=null);return c},setRequired:function(c){this.dateTextBox.set("required",
c)},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this._getStatusForDijit(this.dateTextBox):""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_showDateTypeSelect:function(){this.dateTextBox.closeDropDown()},_showDateTextBox:function(){this.dateTextBox.openDropDown();
this.dateTextBoxClickBinded=!0},_onDateTypeSelectChanged:function(){"custom"===this.dateTypeSelect.get("value")&&this._showDateTextBox();this.emit("change")},_onDateTextBoxChanged:function(c){this.dateTypeSelect.textDirNode.innerText=this._formatDate(c);this.emit("change")},_formatDate:function(c){return this.fieldInfo?e.localizeDateByFieldInfo(c,this.fieldInfo):c.toDateString()}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(l,d,
k){return l("dijit.form.DateTextBox",k,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:d,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(l,d,k,t,p,m,q,u,n,v,
h,g,e,c,b,a,f){var r=t("dijit.Calendar",[e,c,b],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){u.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new r._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:v.hitch(this,
"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"keydown",v.hitch(this,"_onKeyDown")),h(this.dateRowsNode,"mouseover",v.hitch(this,"_onDayMouseOver")),h(this.dateRowsNode,"mouseout",v.hitch(this,"_onDayMouseOut")),h(this.dateRowsNode,"mousedown",v.hitch(this,"_onDayMouseDown")),h(this.dateRowsNode,"mouseup",v.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=new this.dateClassObj(this.currentFocus);
b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var f=this.currentFocus.getDate();b.setDate(Math.min(f,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=m.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!m.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(m.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||a.relatedTarget&&
a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",m.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),m.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!m.contains(a,"dijitCalendarDisabledDate")&&(m.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&m.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,f,c=this.currentFocus;switch(a.keyCode){case n.RIGHT_ARROW:b=1;case n.LEFT_ARROW:f="day";this.isLeftToRight()||(b*=-1);break;case n.DOWN_ARROW:b=1;case n.UP_ARROW:f="week";break;case n.PAGE_DOWN:b=1;case n.PAGE_UP:f=a.ctrlKey||a.altKey?"year":"month";break;case n.END:c=this.dateModule.add(c,"month",1),f="day";case n.HOME:c=new this.dateClassObj(c);c.setDate(1);break;default:return!0}f&&(c=this.dateModule.add(c,f,b));this._setCurrentFocusAttr(c);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});r._MonthDropDownButton=t("dijit.Calendar._MonthDropDownButton",f,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new r._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
b);this.containerNode.innerHTML=(6==g("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});r._MonthDropDown=t("dijit.Calendar._MonthDropDown",[c,a,b],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";l.forEach(a,function(a,b){q.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(p.get(a.target,"month"))},onChange:function(){}});return r})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a){var f=d("dijit.CalendarLite",[c,b],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=m.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),f=this.dateModule.getDaysInMonth(a),c=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),e=new this.dateClassObj,g=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);g>
b&&(g-=7);if(!this.summary){var h=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",h[a.getMonth()])}this._date2cell={};l.forEach(this.dateCells,function(r,h){var z=h+g,w=new this.dateClassObj(a),d="dijitCalendar",y=0;z<b?(z=c-b+z+1,y=-1,d+="Previous"):z>=b+f?(z=z-b-f+1,y=1,d+="Next"):(z=z-b+1,d+="Current");y&&(w=this.dateModule.add(w,"month",y));w.setDate(z);this.dateModule.compare(w,e,"date")||(d="dijitCalendarCurrentDate "+d);this.isDisabledDate(w,
this.lang)?(d="dijitCalendarDisabledDate "+d,r.setAttribute("aria-disabled","true")):(d="dijitCalendarEnabledDate "+d,r.removeAttribute("aria-disabled"),r.setAttribute("aria-selected","false"));(y=this.getClassForDate(w,this.lang))&&(d=y+" "+d);r.className=d+"Month dijitCalendarDateTemplate";d=w.valueOf();this._date2cell[d]=r;r.dijitDateValue=d;d=w.getDateLocalized?w.getDateLocalized(this.lang):w.getDate();this._setText(this.dateLabels[h],d);n.set(r,"aria-label",p.format(w,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,f=new this.dateClassObj;l.forEach(["previous","current","next"],function(a){f.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(f,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?v.getObject(a.datePackage,
!1):t;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?v.getObject(a.datePackage+".locale",!1):p},_createMonthWidget:function(){return f._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,b=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),f=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);this.dayCellsHtml=e.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return b[f++%7]});a=e.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);q.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=v.hitch(this,function(a,
b,f){this[a].dojoClick=!0;return h(this[a],"click",v.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,f))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,b){var f=this.currentFocus,c=this._getNodeByDate(f);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(f,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));a=this._getNodeByDate(a);a.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&a.focus();c&&c!=a&&(g("webkit")?c.setAttribute("tabIndex","-1"):c.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!u.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){u.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}l.forEach(this._selectedCells||[],v.partial(b,!1));this._selectedCells=l.filter(l.map(a,this._getNodeByDate,this),function(a){return a});l.forEach(this._selectedCells,v.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
f._MonthWidget=d("dijit.CalendarLite._MonthWidget",c,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),f=6==g("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+l.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=f+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});return f})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(l,d,k,t,p,m,q,u){new Date("X");return t("dijit.form._DateTimeTextBox",[m,q],{templateString:u,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:d.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(d,v){var h=this._isInvalidDate(d),g=this._isInvalidDate(v);if(h||g)return h&&g?0:h?-1:1;d=this.format(d,this._unboundedConstraints);v=this.format(v,this._unboundedConstraints);
h=this.parse(d,this._unboundedConstraints);g=this.parse(v,this._unboundedConstraints);return d==v?0:l.compare(h,g,this._selector)},autoWidth:!0,format:function(d,v){return d?this.dateLocaleModule.format(d,v):""},parse:function(d,v){return this.dateLocaleModule.parse(d,v)||(this._isEmpty(d)?null:void 0)},serialize:function(d,v){d.toGregorian&&(d=d.toGregorian());return k.toISOString(d,v)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(n){n=
n||{};this.dateModule=n.datePackage?p.getObject(n.datePackage,!1):l;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=n.datePackage?p.getObject(n.datePackage+".locale",!1):d;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(d){d.selector=this._selector;d.fullYear=!0;var n=k.fromISOString;"string"==typeof d.min&&(d.min=n(d.min),this.dateClassObj instanceof Date||(d.min=new this.dateClassObj(d.min)));"string"==typeof d.max&&(d.max=n(d.max),this.dateClassObj instanceof Date||(d.max=new this.dateClassObj(d.max)));this.inherited(arguments);this._unboundedConstraints=p.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(d){return!d||
isNaN(d)||"object"!=typeof d||d.toString()==this._invalidDate},_setValueAttr:function(d,v,h){void 0!==d&&("string"==typeof d&&(d=k.fromISOString(d)),this._isInvalidDate(d)&&(d=null),d instanceof Date&&!(this.dateClassObj instanceof Date)&&(d=new this.dateClassObj(d)));this.inherited(arguments,[d,v,h]);this.value instanceof Date&&(this.filterString="");!1!==v&&this.dropDown&&this.dropDown.set("value",d,!1)},_set:function(d,v){if("value"==d){v instanceof Date&&!(this.dateClassObj instanceof Date)&&
(v=new this.dateClassObj(v));var h=this._get("value");if(h instanceof this.dateClassObj&&0==this.compare(v,h))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(d){this._isInvalidDate(d)&&(d=new this.dateClassObj);this._set("dropDownDefaultValue",d)},openDropDown:function(d){this.dropDown&&this.dropDown.destroy();var n=p.isString(this.popupClass)?p.getObject(this.popupClass,!1):this.popupClass,h=this,g=this.get("value");this.dropDown=new n({onChange:function(e){h.set("value",
e,!0)},id:this.id+"_popup",dir:h.dir,lang:h.lang,value:g,textDir:h.textDir,currentFocus:this._isInvalidDate(g)?this.dropDownDefaultValue:g,constraints:h.constraints,filterString:h.filterString,datePackage:h.datePackage,isDisabledDate:function(e){return!h.rangeCheck(e,h.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(d,v){this._setValueAttr(this.parse(d,this.constraints),v,d)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox".split(" "),
function(l,d,k,t,p,m){return d([k,t,p],{templateString:m,postCreate:function(){this.inherited(arguments);l.addClass(this.domNode,"jimu-two-numbers-filter-value-provider")},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var d=parseFloat(this._dijit1.get("value")),k=parseFloat(this._dijit2.get("value"));d>k&&(this._dijit1.set("value",k),this._dijit2.set("value",d))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(d){this.isDefined(d.value1)&&
this._dijit1.set("value",d.value1);this.isDefined(d.value2)&&this._dijit2.set("value",d.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var d={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(d.value1)&&(d.value1=null);isNaN(d.value2)&&(d.value2=null);return d}return null},setRequired:function(d){this._dijit1.set("required",d);this._dijit2.set("required",d)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html".split(" "),function(l,d,k,t,p,m,q){return k([t,p,l],{templateString:q,postCreate:function(){this.inherited(arguments);
d.addClass(this.domNode,"jimu-two-dates-filter-value-provider");this._dijit1=new m({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv1);this._dijit2=new m({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv2)},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(d){this._setValueObject(this._dijit1,d,"value1",
"virtualDate1");this._setValueObject(this._dijit2,d,"value2","virtualDate2")},_setValueObject:function(d,n,v,h){if(this.isDefined(n[v])){var g={value:null,virtualDate:""};g.value=n[v];g.virtualDate=n[h];d.setValueObject(g)}},getValueObject:function(){if(this.isValidValue()){var d=this._dijit1.getValueObject(),n=this._dijit2.getValueObject();if(d.value&&n.value)return{isValid:!0,type:this.partObj.valueObj.type,value1:d.value,value2:n.value,virtualDate1:d.virtualDate,virtualDate2:n.virtualDate}}return null},
tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(d){this._dijit1.set("required",d);this._dijit2.set("required",d)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListValueProvider.html dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e){return q([u,n,v],{templateString:h,codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,postCreate:function(){this.inherited(arguments);t.addClass(this.domNode,"jimu-filter-list-value-provider");this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+this.nls.noFilterValueTip+
"\x3c/span\x3e\x3c/div\x3e";var c=new g({idProperty:"id",data:[]});this.valuesSelect.set("store",c);this.isNumberField=e.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(l.before(this.valuesSelect,"_onDropDownMouseDown",k.hitch(this,this._onBeforeDropDownMouseDown))),this.own(m(document.body,"click",k.hitch(this,this._onBodyClick))),this.layerInfo&&this.layerInfo.getLayerObject().then(k.hitch(this,
function(b){b.on("edits-complete",k.hitch(this,function(){this.layerDataChanged=!0}))})))},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var c=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,c,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(c){c=c.target||c.srcElement;c===this.domNode||
t.isDescendant(c,this.domNode)||this.msgDiv&&t.setStyle(this.msgDiv,"display","none")},getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var c=this.valuesSelect.get("item");if(c&&void 0!==c.value){if(this.isNumberField&&!e.isValidNumber(c.value)&&"value"===this.partObj.valueObj.type){var b=parseFloat(c.value);return e.isValidNumber(b)?(c.value=b,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},
_getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},setValueObject:function(c){return this.staticValues?this._setValueForStaticValues(c.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(c.value,!1):this._setValueForStaticValues(c.value,this.codedValues):this._tryUpdatingUniqueValues(c.value,!1)},getValueObject:function(){if(this.isValidValue()){var c=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,
value:c}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(c){this.valuesSelect.set("required",c)},_setValueForStaticValues:function(c,b){var a=null,f=-1,a=null;b&&(a=p.map(b,k.hitch(this,function(a,b){a={id:b,value:a.value,label:a.label};a.value+""===c+""&&(f=b);return a})),this.valuesSelect.store.setData(a),0<=f&&(a=this.valuesSelect.store.get(f))&&
this.valuesSelect.set("item",a),this._checkIfNoData())},_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(c,b){var a=new d;if(this.valuesSelect._opened)this._checkIfNoData(),a.resolve();else{var f=this.getDropdownFilterExpr();f!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=
f,this._uniqueValueLoadingDef=this._getUniqueValues(f),this._uniqueValueLoadingDef.then(k.hitch(this,function(f){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(c,f),this._hideLoadingIcon(),b&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),a.resolve())}),k.hitch(this,function(b){console.error(b);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),a.reject(b))}))):
(this._checkIfNoData(),a.resolve())}return a},_setValueForUniqueValues:function(c,b){b.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(b=p.filter(b,k.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===c){var a=this.getValueObject();a&&(c=a.value)}var f=-1,a=null;b=p.map(b,k.hitch(this,function(a,b){var e={id:b,value:a.value,label:a.label};a.value+""===c+""&&(f=b);return e}));this.valuesSelect.store.setData(b);0<=f&&(a=this.valuesSelect.store.get(f));
this.valuesSelect.set("item",a)},_checkIfNoData:function(){this.runtime&&this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?t.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),t.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){t.addClass(this.valuesSelect.domNode,"loading")},
_hideLoadingIcon:function(){t.removeClass(this.valuesSelect.domNode,"loading")},_getUniqueValues:function(c){var b=new d;this._uniqueValueCache[c]&&!this.layerDataChanged?b.resolve(this._uniqueValueCache[c]):(this._showLoadingIcon(),e.getUniqueValues(this.url,this.fieldName,c,this.layerDefinition,this.fieldPopupInfo).then(k.hitch(this,function(a){this.domNode&&(this._uniqueValueCache[c]=a,b.resolve(a),this._hideLoadingIcon())}),k.hitch(this,function(a){this.domNode&&(b.reject(a),this._hideLoadingIcon())})));
this.layerDataChanged=!1;return b}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/on dojo/keys dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f){return u([v,
g,e,p],{templateString:c,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";m.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.isNumberField=b.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new a({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",d.hitch(this,
this._resetPageControlNewExpr)));this.listSelect||(this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new h({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),d.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):
(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",d.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",d.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",d.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",d.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",
d.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemsConfirmed",d.hitch(this,function(){"block"===m.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide());this.domNode.focus()})),m.setAttr(this.domNode,"role","application"),this.own(k(this.domNode,"keydown",d.hitch(this,function(a){m.hasClass(a.target||a.srcElement,"jimu-filter-mutcheck-list-value-provider")&&a.keyCode===t.ENTER&&this._checkedBtnEvent()}))),this.staticValues||
"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(d.hitch(this,function(a){a.on("edits-complete",d.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(m.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=d.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0})):
this.listSelect.placeAt(this.listContent)},filterExpr:null,_resetPageControlNewExpr:function(){var a=this.getDropdownFilterExpr();return this.filterExpr!==a?(this.pageControlForQuery.reset(),this.filterExpr=this.pageControlForQuery.cascadeFilterExprs=a,!0):!1},_multipleSelectProviderEvent:function(a){a=a.target||a.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(m.isDescendant(a,this.cbxPopup.domNode)||m.isDescendant(a,this.checkedBtn))return;"block"===m.getStyle(this.cbxPopup.domNode,"display")&&
(this._resetListSelectState(this),this.cbxPopup.hide())}else!m.isDescendant(a,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=!0);this.msgDiv&&m.setStyle(this.msgDiv,"display","none")},_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(a){"block"===m.getStyle(a.listSelect.searchKeyInput,"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),
a.listSelect.listContainer.scrollTop=0,a.listSelect.queryState=!0,a.listSelect.valueInput.set("value",""),this._isRestSelectList=!0)},_createTarget:function(a){this._checkedChanged(1,a);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(a){this._checkedChanged(-1,a)},_checkedChanged:function(a,b){if("multipleDynamic"===this.controlType||"multiplePredefined"===
this.controlType&&this.runtime&&"dropdown"===this.selectUI)b&&(a=parseInt(this.checkedNum.innerText,10)+a,this.checkedNum.innerText=0<a?a:0);else if("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(b===this.emptyStr?m.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):m.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),a=b?b:this._getCheckedNameDivText(),this._setCheckedNameDivText(a);this.listSelect.set("displayedValue",
"12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:"uniqueDynamic"!==this.controlType&&"uniquePredefined"!==this.controlType||this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),
"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue","12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(d.hitch(this,function(a){this.listSelect.isCacheFinish=
this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(a)||(this.listSelect.setCBXData(a,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),d.hitch(this,function(a){console.log(a);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(a).then(d.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._resetPopupStyles(!a.length);
this._hideLoadingIcon()}),d.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a,b){if(this.listSelect){"uniqueDynamic"===this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var f=this.pageControlForQuery._searchKeyLocal(a);""===a&&0===f.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):this.listSelect.setCBXContentBySearch(f,
b);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(d.hitch(this,function(b){a.resolve(b)}),d.hitch(this,function(b){console.log(b);a.reject(b)}))},getCheckedList:function(a){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];q.forEach(a,d.hitch(this,function(a){var b;d.isObject(a)?a.isChecked&&(b=a.value):b=a;if(b||0===b)b=this.isNumberField?parseFloat(b):b,this.listSelect.checkedList.push(b)}))},
getCheckedStrsList:function(a){var b=[];q.forEach(a,d.hitch(this,function(a){var f;d.isObject(a)?a.isChecked&&(f=a[this.disPlayLabel]):f=a;(f||0===f)&&b.push(f)}));return b},showContent:function(a){var b=new l;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";var f;if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)return this.runtime&&(this.listSelect.disPlayLabel="alias"),(f=this._checkIfNoData(this.valueList))||
this.listSelect.setCBXData(this.valueList,!0,a),this._hideLoadingIcon(),b.resolve(f),b;if(this.staticValues)return f=this._setValueForStaticValues(this.staticValues),b.resolve(f),b;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return f=this._setValueForStaticValues(this.codedValues),b.resolve(f),b;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(a).then(d.hitch(this,
function(c){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;c=this._handleCodedValue(c);(f=this._checkIfNoData(c))||this.listSelect.setCBXData(c,!0,a);this._hideLoadingIcon();b.resolve(f)}),d.hitch(this,function(a){console.log(a);this._hideLoadingIcon();b.reject(a)}));return b},_handleCodedValue:function(a){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),a;this.pageControlForQuery._codedvalueCache=
a;"uniqueDynamic"===this.controlType&&this._setCheckedName(this.listSelect.checkedList?this.listSelect.checkedList[0]:"",a);this.listSelect._updateCheckedLabelList(this.codedValues);return a},_showDropdown:function(a){var b=m.position(a.target),f;f=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var c=m.position(f);if("none"!==m.getStyle(this.listContentPopup,"display"))m.setStyle(this.listContentPopup,"display","none");else{q.forEach(n(".value-type-popup",
f),function(a){m.setStyle(a,"display","none")},this);m.place(this.listContentPopup,f);var e;e=m.hasClass(n(".desktop-add-section",f.parentNode)[0],"hidden")?-5:30;e=b.y-c.y-f.parentNode.scrollTop+e;e+170>f.parentNode.scrollHeight&&(e=f.parentNode.scrollHeight-170-40);window.isRTL?b=b.x-c.x+20:(b=b.x-c.x-100-90,b+150>f.clientWidth&&(b=f.clientWidth-150));m.setStyle(this.listContentPopup,{display:"block",left:b+"px",top:e+"px"});a.stopPropagation()}},_calculatePopup:function(){var a=m.position(this.domNode.parentNode),
b=m.position(document.body).h,f=a.y+30;b-f<this._cbxHeight&&(f=a.y-this._cbxHeight);return{left:a.x,top:f}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===m.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var a=this._resetPageControlNewExpr();a&&this.cbxPopup&&(this.cbxPopup.close(),this._clearCheckedTxt());var b=
this._calculatePopup();this._cbxWidth=m.getStyle(this.checkedBtn,"width");if(!a&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&"block"===m.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();
var c=this.showContent(!0);c.then(d.hitch(this,function(a){this.isPopupLoading=!1;this._hideDataQueryingIcon();this.popupIsNoData=a;a||(this.cbxPopup=new f({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:b.left,top:b.top},hiddenAfterInit:this.isLoadDataAdvanced,useFocusLogic:!1,onClose:d.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,
border:"1px solid #999"}),this.cbxPopup.on("popupHasInitedSuccessfully",d.hitch(this,function(a){this._resetPopupStyles(!1,!0);a||(this.listSelect.valueInput&&"block"===m.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus())})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),d.hitch(this,function(a){this.isPopupLoading=!1;console.log(a);c.reject(a)}))}}},_itemContainerH:300,_resetPopupStyles:function(a,b){var f=this._itemContainerH,
c=m.getStyle(this.listSelect.listContent,"height");0===c&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===m.getStyle(this.cbxPopup.domNode,"display")&&(c=this.popupInitHeight);b&&(this.popupInitHeight=c);!a||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(c+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===m.getStyle(this.listSelect.noDataTips,"display")&&(c+=30);f=c<f?c:f;m.setStyle(this.listSelect.listContainer,"height",f+"px");m.setStyle(this.listSelect.selectedContainer,
"height",f+30+"px");"multipleDynamic"===this.controlType?f=f+30+30:"uniqueDynamic"===this.controlType&&(f+=30);this._cbxHeight=f+10;a=this._calculatePopup();this._cbxWidth=m.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(a.left,a.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var a=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===
this.controlType||"uniquePredefined"===this.controlType)||(a=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&"multiplePredefined"!==this.controlType?a-30:a-15);window.isRTL&&(a-=3);this.listSelect._itemLabelW=a;n(".item .label",this.listSelect.listContent).style({"max-width":a+"px"})},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);if(a){this.pageControlForQuery._codedvalueCache=a;var b=
this._checkIfNoData(a);b||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(a,!0,!0));return b}return!1},_checkIfNoData:function(a){if(this.runtime&&"dropdown"===this.selectUI){if(a&&0<a.length)return!1;this.msgDiv?m.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),m.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.checkedBtn.parentNode.appendChild(this.msgDiv));return!0}return!1},getDijits:function(){return[this.listSelect]},
_setCheckedName:function(a,b){var f=a;if(b=b?b:this.codedValues){for(var c=!1,e=0;e<b.length;e++){var g=b[e];if(g.value===a){f=g.label;c=!0;break}}c||(f=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===a?(f=this.emptyStr,m.addClass(this.checkedNameDiv,"checkedEmptyNameDiv")):m.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(f)},setValueObject:function(a){a.value=a.value||0===a.value?
a.value:[];this.valueList=a.value;this.enableEmpty=a.enableEmpty;this.listSelect.enableEmpty=a.enableEmpty;if("multipleDynamic"===this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType)a=this.valueList,d.isArray(a)&&0===a.length&&(a=void 0),this._setCheckedName(a),this.valueList=[this.valueList],this.isLoadDataAdvanced&&this._checkedBtnEvent();else{this.emptyStr=a.emptyLabel?a.emptyLabel:this.emptyStr;
this.listSelect.emptyStr=this.emptyStr;if(this.runtime&&"dropdown"===this.selectUI){var b=[];"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),b=this.listSelect.checkedList):b=this.getCheckedStrsList(this.valueList);"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(b[0]):this._setCheckedNameDivText(a.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=b.length}this.showContent(!0);setTimeout(d.hitch(this,function(){this._cbxWidth=
m.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)}},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(a){this.isNumberField&&"number"===typeof a&&(a=b._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[a])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=a:this.checkedNameDiv.innerText=a},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var a=null,a="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},getValueObject:function(){if(this.isValidValue()){var a;a="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(a=d.isArray(a)?a[0]:a);!this.runtime&&
this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=d.hitch(this,function(){return!0}),this.cbxPopup.close());return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},setRequired:function(a){this.listSelect.set("required",a)},_showDataQueryingIcon:function(){this._validatingNode||(this._validatingNode=m.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));m.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&m.setStyle(this._validatingNode,
"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&m.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&m.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.inherited(arguments)},destroyProvider:function(){this.listSelect&&
this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/keys dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g){return t([p,n,v,d],{templateString:h,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,
queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)k.addClass(this.listContainer,"items-setting-dropdown-content"),
this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&k.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(k.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(k.addClass(this.listContainer,"items-widget-expaned-content"),k.addClass(this.listContent,"jimu-multiple-items-expanded-list"))):(k.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==
this.controlType||(k.addClass(this.listContainer,"items-setting-dropdown-content"),k.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display="block");this._addCBXClickEvent();("dropdown"===this.selectUI||"predefined"===this.controlType&&!this.runtime)&&this._addCBXHoverEvent();this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&
(this.selectedToggleDiv.style.display="block",this.selectedToggle=u(".showAllIcon",this.selectedToggleDiv)[0],this.own(m(this.selectedToggleDiv,"click",l.hitch(this,"_toggleFilter"))),this.own(m(this.selectedToggleDiv,"keydown",l.hitch(this,function(e){e.keyCode===q.ENTER&&this._toggleFilter(e)}))),this._addSelectedContainerEvent());this._addKeyDownEvent()},_addKeyDownEvent:function(){this.own(m(this.multipleSelect,"keydown",l.hitch(this,function(e){var c=e.which||e.keyCode,b=e.target;if(c===q.ESCAPE||
"INPUT"===b.tagName&&e.shiftKey&&c===q.TAB||("multipleDynamic"===this.controlType&&k.hasClass(b,"clearAllSelectedIcon")||"multipleDynamic"!==this.controlType&&k.hasClass(b,"item"))&&!e.shiftKey&&c===q.TAB)e.preventDefault(),this.currentHoverItem&&(k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed")})));this.own(m(this.listContent,"focus",l.hitch(this,function(){g.isInNavMode()&&(this.currentItem=(this.currentItem=this.getCurrentItem())?
this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=this.currentItem.parentNode,this.currentHoverItem.focus(),k.addClass(this.currentHoverItem,"active"),setTimeout(l.hitch(this,function(){k.addClass(this.currentHoverItem,"active")}),50))})));this.own(m(this.listContent,"blur",l.hitch(this,function(){g.isInNavMode()&&this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active")})));this.own(m(this.showAllIconBtn,"keydown",l.hitch(this,function(e){e.shiftKey&&e.keyCode===q.TAB&&
(e.preventDefault(),"block"===k.getStyle(this.selectedContainer,"display")?this.selectedListContent.focus():this.listContent.focus())})));this.own(m(this.listContent,"keydown",l.hitch(this,function(e){if(g.isInNavMode()){var c=e.which||e.keyCode;-1<[q.SPACE,q.UP_ARROW,q.DOWN_ARROW].indexOf(c)&&e.preventDefault();if(c===q.TAB&&k.hasClass(e.target,"item"))e.preventDefault(),this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active"),e.shiftKey?"block"===this.searchKeyInput.style.display?this.valueInput.focus():
this.emit("advancedListValueSelect_itemsConfirmed"):"multipleDynamic"===this.controlType&&this.showAllIconBtn.focus();else if(c===q.SPACE||c===q.ENTER)e=u(".checkInput",this.currentHoverItem)[0],c=u(".label",this.currentHoverItem)[0],this._setCBXChecked(e,this._getNodeText(c)),"radio"===this.inputType&&(k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null,this.emit("advancedListValueSelect_itemsConfirmed"));else if(c===q.UP_ARROW||c===q.DOWN_ARROW){e=(e=c===q.UP_ARROW?this.currentHoverItem.previousSibling:
this.currentHoverItem.nextSibling)?e:this.currentHoverItem;if(this.listContainer.scrollHeight>this.listContainer.clientHeight){var c=this.listContainer.clientHeight+this.listContainer.scrollTop,b=e.offsetTop+e.offsetHeight,b=b-30;b>c?this.listContainer.scrollTop=b-this.listContainer.clientHeight:e.offsetTop<this.listContainer.scrollTop+30&&(this.listContainer.scrollTop=e.offsetTop-30)}k.removeClass(this.currentHoverItem,"active");this.currentHoverItem=e;k.addClass(this.currentHoverItem,"active");
this.currentHoverItem.focus()}}})));this.own(m(this.selectedListContent,"focus",l.hitch(this,function(){if(g.isInNavMode()){var e=u(".item",this.selectedListContent);e.length&&(this.currentHoverItem=e[0],this.currentHoverItem.focus(),k.addClass(this.currentHoverItem,"active"),setTimeout(l.hitch(this,function(){k.addClass(this.currentHoverItem,"active")}),50))}})));this.own(m(this.selectedListContent,"blur",l.hitch(this,function(){g.isInNavMode()&&this.currentHoverItem&&k.removeClass(this.currentHoverItem,
"active")})));this.own(m(this.selectedContainer,"keydown",l.hitch(this,function(e){if(g.isInNavMode()){var c=e.which||e.keyCode;if(c===q.TAB)e.preventDefault(),this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active"),this.showAllIconBtn.focus();else if(0!==u(".item",this.selectedListContent).length)if(-1<[q.SPACE,q.UP_ARROW,q.DOWN_ARROW].indexOf(c)&&e.preventDefault(),c===q.SPACE||c===q.ENTER)e=u(".checkInput",this.currentHoverItem)[0],c=u(".label",this.currentHoverItem)[0],this._setCBXSelectedChecked(e,
this._getNodeText(c));else if(c===q.UP_ARROW||c===q.DOWN_ARROW)e=(e=c===q.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?e:this.currentHoverItem,this.selectedContainer.scrollHeight>this.selectedContainer.clientHeight&&(c=e.offsetTop+e.offsetHeight,c>this.selectedContainer.clientHeight+this.selectedContainer.scrollTop?this.selectedContainer.scrollTop=c-this.selectedContainer.clientHeight:e.offsetTop<this.selectedContainer.scrollTop&&(this.selectedContainer.scrollTop=
e.offsetTop)),k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=e,k.addClass(this.currentHoverItem,"active"),this.currentHoverItem.focus()}})))},_toggleFilter:function(e){var c=e.target;k.hasClass(c,"clearAllSelectedIcon")?(this._clearAllSelected(),this.currentHoverItem=this.currentItem=null):k.hasClass(c,"iconHover")||k.hasClass(c,"selectedToggleDiv")||(k.hasClass(c,"showAllIcon")?(this.selectedContainer.style.display="none",this.listContent.focus()):(this._initSelectedContainerItems(),
this.selectedContainer.style.display="block",this.selectedListContent.focus()),k.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=c,k.addClass(this.selectedToggle,"iconHover"),e.stopPropagation())},showAllList:function(){k.hasClass(this.selectedToggle,"showSelectedIcon")&&k.hasClass(this.selectedToggle,"iconHover")&&(k.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=u(".showAllIcon",this.selectedToggleDiv)[0],k.addClass(this.selectedToggle,"iconHover"),k.setStyle(this.selectedContainer,
"display","none"))},_clearAllSelected:function(){var e;e=k.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;e=u(".item .checkInput.checked",e);for(var c=0;c<e.length;c++)e[c].click()},_initSelectedContainerItems:function(){for(var e=this.selectedListContent.innerHTML="",c=this.runtime?" labelRuntime":"",b=0;b<this.checkedList.length;b++)var a=this.checkedList[b],f="value"===this.disPlayLabel?a:this.checkedLabelList[b],a='data\x3d"'+(this.isNumberField?a:encodeURIComponent(a))+
'"',e=e+('\x3cdiv class\x3d"item" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+a+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+c+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+f+"\x3c/div\x3e\x3c/div\x3e");this.selectedListContent.innerHTML=e},_addSelectedContainerEvent:function(){this.own(m(this.selectedListContent,"click",l.hitch(this,function(e){var c=e.target,b;if(k.hasClass(c,"item"))b=c.firstElementChild,c=c.firstElementChild.nextSibling;
else if(k.hasClass(c,"checkInput"))b=c,c=c.nextSibling;else if(k.hasClass(c,"label"))b=c.previousSibling;else{e.stopPropagation();return}this._setCBXSelectedChecked(b,this._getNodeText(c));e.stopPropagation()})))},_setCBXSelectedChecked:function(e,c){var b=c;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)b=decodeURIComponent(k.getAttr(e,"data"));k.hasClass(e,"checked")?"radio"!==this.inputType&&(k.removeClass(e,"checked"),this._updateCheckedList("remove",b,c),this.checkCBXItems(),this.emit("advancedListValueSelect_itemUnChecked",
c)):("radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),k.removeClass(this.currentItem,"checked")),k.addClass(e,"checked"),this._updateCheckedList("add",b,c),this.checkCBXItems(),this.emit("advancedListValueSelect_itemChecked",c))},_getNodeText:function(e){return e.textContent||e.innerText||""},_updateCheckedList:function(e,c,b){c!==this.emptyStr&&(c=this.isNumberField?parseFloat(c):c);if("remove"===e)for(var a in this.checkedList){if(this.checkedList[a]===
c||this.isNumberField&&isNaN(this.checkedList[a])&&isNaN(c)){this.checkedList.splice(a,1);this.checkedLabelList.splice(a,1);break}}else"radio"===this.inputType?(this.checkedList=[c],this.checkedLabelList=[b]):(this.checkedList.push(c),this.checkedLabelList.push(b))},_updateCheckedLabelList:function(e){this.checkedLabelList=[];for(var c=0;c<this.checkedList.length;c++)for(var b=0;b<e.length;b++)this.checkedList[c]===e[b].value&&this.checkedLabelList.push(e[b].label)},_updateCheckedLabelListFromCheckedList:function(){for(var e=
0;e<this.checkedList.length;e++)this.checkedLabelList.push(this.checkedList[e]+"")},_createTarget:function(e){e=this._getNodeText(e.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",e)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return u(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var e=[],c=this._getCheckInputItems(),b=0;b<c.length;b++){var a=c[b],f=this._getNodeText(a.nextSibling);k.hasClass(a,"checked")&&e.push(f)}return e},
getListCheckedValues:function(){for(var e=[],c=l.clone(this.checkedList),b=0;b<c.length;b++){var a=c[b],a=this.isNumberField?parseFloat(a):a;e.push(a)}return e},getListValues:function(){var e=[],c=this._getCheckInputItems();if(0===c.length)return this.dataList;for(var b=0;b<c.length;b++){var a=c[b],f=this._getNodeText(a.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)f=decodeURIComponent(k.getAttr(a,"data"));f=this.isNumberField?parseFloat(f):f;f={value:f,isChecked:!1};k.hasClass(a,
"checked")&&(f.isChecked=!0);e.push(f)}return e},getIfValueExist:function(e){for(var c=this._getCheckInputItems(),b=0;b<c.length;b++){var a=this._getNodeText(c[b].nextSibling);if(e===a)return!0}return!1},getCurrentItem:function(){for(var e=this._getCheckInputItems(),c=0;c<e.length;c++){var b=e[c];if(k.hasClass(b,"checked"))return b}return null},checkCBXItems:function(e){e=e?"":this.valueInput.get("value");this.valueInput.set("value",e);e=u(".item .label",this.listContent);for(var c=0;c<e.length;c++){var b=
e[c],a="value"===this.disPlayLabel?this._getNodeText(b):decodeURIComponent(k.getAttr(b.previousSibling,"data")),a=this.isNumberField?parseFloat(a):a;0<=this.checkedList.indexOf(a)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(a))?k.addClass(b.previousSibling,"checked"):k.removeClass(b.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(e,c,b,a){a||(this.queryState=!1);e=e?e:[];if(this.listContent){k.setStyle(this.noDataTips,"display","none");
var f=0,g="radio"===this.inputType?" labelBig":"",h=this.runtime?" labelRuntime":"";a=this.listContent.innerHTML;if(b){a=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)b=a="",this.checkedList[0]===this.emptyStr&&(a=" checked",b=" active",f=1),0===this.checkedList.length&&(a=" checked",this.currentItem=!0,f=1),a='\x3cdiv class\x3d"item emptyItem'+b+'" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"checkInput '+
this.inputType+a+'" '+("data\x3d'"+this.emptyStr+"'")+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+g+" jimu-ellipsis-Blanks"+h+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===e.length)return e=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==e||this.cacheQueryMode&&!this.isCacheFinish||k.setStyle(this.noDataTips,"display","block"),""===e&&(this.listContent.innerHTML=a),this.listContent;b="";for(var d=0;d<e.length;d++){var n=
e[d],v="";if(c)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))n.isChecked&&(v=" checked",this.currentItem=!0,f++);else if(0<=this.checkedList.indexOf(n.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(n.value)))v=" checked",this.currentItem=!0,f++;var l='data\x3d"'+(this.isNumberField?n.value:encodeURIComponent(n.value))+'"';b+='\x3cdiv class\x3d"item" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+v+'" '+l+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+
g+" jimu-ellipsis-Blanks"+h+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+n[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}e=this.checkedList.length-f;if(this.runtime&&0<e)for(c=0;c<e;c++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=a+b;u(".emptyItem",this.listContent)[0]?this.currentHoverItem=(e=u(".checked",this.listContent)[0])?e.parentNode:!0:(this.currentItem=(this.currentItem=this.getCurrentItem())?this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=
this.currentItem.parentNode);k.addClass(this.currentHoverItem,"active");return this.listContent}},setCBXContentBySearch:function(e,c){0===e.length?this.setCBXData([],!1,!0,c):this.setCBXData(e,!0,!0,c)},_onSearchKeyChange:function(){var e=this.valueInput.get("value");this.searchName=e;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",e);this.codedValues||(this.isCacheFinish||k.setStyle(this.loadMoreDataBtn,
"display","block"),0===e.length&&(this.queryState=this.cacheQueryMode=this.keyQueryMode=!1,k.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=!1;this.queryState=!0;k.setStyle(this.loadMoreDataBtn,"display","none");var e=this.valueInput.get("value");this.searchName=e;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",
e):this.runtime||this.emit("advancedListValueSelect_searchKey",e)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(m(this.listContent,"mouseover",l.hitch(this,function(e){e=e.target||e.srcElement;e=k.hasClass(e,"item")?e:g.getAncestorDom(e,function(c){return k.hasClass(c,"item")},3);this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active");k.addClass(e,"active");this.currentHoverItem=e})));this.own(m(this.listContent,"mouseout",l.hitch(this,function(){this.currentHoverItem&&
k.removeClass(this.currentHoverItem,"active");this.currentHoverItem=null})))},_addCBXClickEvent:function(){this.own(m(this.valueInput,"change",l.hitch(this,function(){this._onSearchKeyChange()})));this.own(m(this.loadMoreDataBtn,"click",l.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(m(this.listContainer,"scroll",l.hitch(this,this.dropDownScroll)));this.own(m(this.searchKeyInput,"click",l.hitch(this,function(e){e.stopPropagation()})));this.own(m(this.listContainer,"click",l.hitch(this,
function(e){var c=e.target,b;if(k.hasClass(c,"item"))b=c.firstElementChild,c=c.firstElementChild.nextSibling;else if(k.hasClass(c,"checkInput"))b=c,c=c.nextSibling;else if(k.hasClass(c,"label"))b=c.previousSibling;else{e.stopPropagation();return}this._setCBXChecked(b,this._getNodeText(c));e.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(e){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?
this.listContainer.scrollTop=this.containerScrollTop:(e=e.target,e.scrollHeight-e.clientHeight-e.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(e,c){var b=c;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)b=decodeURIComponent(k.getAttr(e,"data"));k.hasClass(e,"checked")?"radio"===this.inputType?this.runtime||"predefined"!==
this.controlType?this.emit("advancedListValueSelect_itemChecked",c):this.emit("advancedListValueSelect_itemCheckedForPredefined",b,c):(k.removeClass(e,"checked"),this._updateCheckedList("remove",b,c),this.emit("advancedListValueSelect_itemUnChecked",c)):("radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&k.removeClass(this.currentItem,"checked")),k.addClass(e,"checked"),this.currentItem=e,this._updateCheckedList("add",b,c),
this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",c):this.emit("advancedListValueSelect_itemCheckedForPredefined",b,c))},initDoms:function(e,c){this.setCBXData(e,c)},getData:function(){},refreshData:function(){this.checkCBXItems()},validate:function(){var e=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(e=null);if(this.isNumberField)for(var c=0;c<this.checkedList.length;c++){var b=this.checkedList[c];
if(b!==this.emptyStr&&isNaN(b)){e=null;break}}this.set("DisplayedValue",e);return!0},setRequired:function(e){this.mutiValuesSelect.set("required",e)},destroy:function(){k.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/utils".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g){return p([u,n,v],{templateString:h,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=q.getInstance().map.spatialReference;this.reset();this.queryType=m.getQueryType(this.layerDefinition);this.isNumberField&&(this.fieldLength=this.numbericFieldLength[this.fieldInfo.type])},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(e){var c=new l,b=new d,a="",a=this.isNumberField?"CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+
")) LIKE '%"+e+"%'":this.fieldInfo.name+" LIKE '%"+e+"%'";b.where="(("+this.cascadeFilterExprs+") AND ("+a+"))";b.geometry=null;b.outSpatialReference=this.spatialReference;b.outFields=[this.fieldInfo.name];b.returnDistinctValues=!0;b.returnGeometry=!1;b.orderByFields=b.outFields;this.layerLoaderForKey=new m({url:this.layerUrl,query:b,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(t.hitch(this,function(a){c.resolve(a)}),t.hitch(this,
function(a){c.reject("reject:"+a)}));return c},_searchKeyLocal:function(e){e=e.toUpperCase();this.isKeyQueryLoader=!1;var c=[],b=this._codedvalueCache,a;if(0<b.length)for(var f=0;f<b.length;f++)a=b[f],a.label&&0<=a.label.toString().toUpperCase().indexOf(e)&&c.push(a);else for(f in b=this._uniqueValueCache,b)for(var g=b[f],h=0;h<g.length;h++){a=g[h];var d=a.label;d&&0<=d.toString().toUpperCase().indexOf(e)&&c.push(a)}return c},queryByPage:function(e){var c=new l;this.layerLoader&&this.layerLoader.query.where!==
this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var b=new d;b.where=this.cascadeFilterExprs;b.geometry=null;b.outSpatialReference=this.spatialReference;b.outFields=[this.fieldInfo.name];b.returnDistinctValues=!0;b.returnGeometry=!1;b.orderByFields=b.outFields;this.layerLoader=new m({url:this.layerUrl,query:b,pageSize:this.pageSize})}e&&(this.pageIndex=1);e=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return e=
this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),c.resolve(e),c;e=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return e=this._resolveValueLabelsFromCache(this._uniqueValueCache),c.resolve(e),c;e=this.layerLoader}1===this.queryType?e.queryByPage(this.pageIndex).then(t.hitch(this,function(a){if(a){var b=a.features||[];a=b.length;this.showNullValues||(b=this._getNotNullValues(b));b=this._getValueLabelsFromFeatures(b);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-
1]=b,a<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=b,a<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=!0));0===b.length&&this.pageIndex--;c.resolve(b)}else c.reject("Can't get features from current layer")}),t.hitch(this,function(a){c.reject(a)})):e.getAllFeatures().then(t.hitch(this,function(a){if(a){var b=a.features||[];this.showNullValues||(b=this._getNotNullValues(b));a=0<b.length?
!0:!1;b=this._getDistinctValues(b);b=this._getValueLabelsFromFeatures(b);b=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(b,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(b,this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;c.resolve(a?b:[])}else c.reject("Can't get features from current layer")}),t.hitch(this,function(a){c.reject(a)}));this.pageIndex++;return c},_resolveValueLabelsFromCache:function(e){e=e[this.pageIndex];0!==e.length&&this.pageIndex++;
return e},_getAndStoreValueLabelsForOtherTypes:function(e,c){for(var b=0;b<e.length;b+=this.pageSize)c[parseInt(b/this.pageSize,10)+1]=e.slice(b,b+this.pageSize);for(var a in c)e=parseInt(a,10)+1,c[e]||(c[e]=[]);return c[1]},_getDistinctValues:function(e){var c={},b=[],a;for(a in e){var f=e[a],g=f.attributes[this.fieldInfo.name];c[g]||(c[g]=!0,b.push(f))}return b},_getNotNullValues:function(e){return e=k.filter(e,t.hitch(this,function(c){c=c.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==
c&&null!==c}))},_getValueLabelsFromFeatures:function(e){var c=this.fieldInfo.name;e=k.map(e,function(b){return b.attributes[c]});return g._getValues(this.layerDefinition,this.fieldPopupInfo,c,e)}})})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),function(l,d,k,t,p,m){var q=l([p],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(d){this._layerInfos=
d;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},
getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(d){var n=null;if(d=this._layerInfos.addTable(d))n=d._adaptor;return n},removeTable:function(d){(d=this.getNodeById(d))&&this._layerInfos.removeTable(d._layerInfo)},_traversal:function(d,v){for(var h=0;h<v.length;h++)if(v[h].traversal(d))return!0;return!1},traversal:function(d){return this._traversal(d,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},
traversalWithNodes:function(d,v){return this._traversal(d,v)},getNodeById:function(d){var n=null;this.traversal(function(h){if(h.id===d)return n=h,!0});return n},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(d){this._layerInfos.restoreState(d)},destroy:function(){d.forEach(this._eventHandles,function(d){d.remove()});this.inherited(arguments)},_getNodesArrayFromInfosArray:function(n){var k=[];d.forEach(n,function(h){k.push(h._adaptor)},this);return k},
_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(n){console.warn(n)}},_bindEvents:function(){var d;d=t(this._layerInfos,"layerInfosChanged",k.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(d);d=t(this._layerInfos,"basemapLayerInfosChanged",k.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(d);d=t(this._layerInfos,"tableInfosChanged",k.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosReorder",
k.hitch(this,this._onLayerReordered));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosIsShowInMapChanged",k.hitch(this,this._onVisibilityChanged));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosIsVisibleChanged",k.hitch(this,this._onToggleChanged));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosFilterChanged",k.hitch(this,this._onFilterChanged));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosRendererChanged",k.hitch(this,this._onRendererChanged));this._eventHandles.push(d);
d=t(this._layerInfos,"layerInfosOpacityChanged",k.hitch(this,this._onOpacityChanged));this._eventHandles.push(d);d=t(this._layerInfos,"layerInfosTimeExtentChanged",k.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(d)},_onLayerNodesStructureChanged:function(d,k,h){this._emitEvent(q.EVENT_STRUCTURE_CHANGE,{type:k,layerNodes:[h._adaptor],rootLayerNodes:[d._adaptor]})},_onTableNdoesStructureChanged:function(d,k){d=this._getNodesArrayFromInfosArray(d);this._emitEvent(q.EVENT_STRUCTURE_CHANGE,
{type:k,layerNodes:d,rootLayerNodes:d})},_onLayerReordered:function(d,k){d=[d._adaptor];this._emitEvent(q.EVENT_STRUCTURE_CHANGE,{type:k,layerNodes:d,rootLayerNodes:d})},_onVisibilityChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(q.EVENT_VISIBILITY_CHANGE,d)},_onToggleChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(q.EVENT_TOOGLE_CHANGE,d)},_onFilterChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};
this._emitEvent(q.EVENT_FILTER_CHANGE,d)},_onRendererChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(q.EVENT_RENDERER_CHANGE,d)},_onOpacityChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(q.EVENT_OPACITY_CHANGE,d)},_onTimeExtentChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(q.EVENT_TIME_EXTENT_CHANGE,d)}}),u=null;q.getInstance=function(){u&&u._layerInfos._objectId===m.getInstanceSync()._objectId||
(u&&u.destroy(),u=new q(m.getInstanceSync()));return u};q.createInstance=function(d){return new q(m.createInstance(d))};k.mixin(q,{STRUCTURE_CHANGE_ADD:m.ADDED,STRUCTURE_CHANGE_REMOVE:m.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:m.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:m.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:m.UPDATED,STRUCTURE_CHANGE_REORDER:m.REORDERED,EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return q})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),function(l,d,k,t,p,m,q,u){return d([u],{templateString:k,nls:null,url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,
staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;l.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");l.addClass(this.valueProviderPopupNode,"value-type-popup");l.setStyle(this.valueProviderPopupNode,"display","none");var d="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?d=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===
this.providerType&&(d=this.nls.predefinedMultipleTips);this.indexBtnTips.title=d;this.indexBtnTips.innerText=d+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var d={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,staticValues:this.staticValues,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,
runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new q(d);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",t.hitch(this,function(d){this.popup&&(d?this.popup.enableButton(0):this.popup.disableButton(0))}))},_bindEvent:function(){this.own(p(this.indexBtn,"click",t.hitch(this,function(){this.valueProvider&&this.destroyProvider();
this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new m({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,useFocusLogic:!1,onClose:t.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:t.hitch(this,function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],
onClick:t.hitch(this,function(){this.popup.close()})}]});l.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(t.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&(this.valueProvider.cbxPopup.onClose=t.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},_saveData:function(){this.valueProvider.saveData()},
reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(d){d&&(this.valueObjEnd=d);this.valueProvider.setValueObject(d,!0)},valueObj:null,getValueObject:function(d){if(d)return this.valueObjEnd=d=this.valueProvider.getValueObject(),d.value.length;delete this.valueObjEnd.valueList;return 0===this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();this.valueProvider=null}})})},
"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r){return p([u,h,g,m],
{templateString:e,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";k.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");this.controlType="unique";
"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=b.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new n({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",l.hitch(this,this._showListSelectByTable)),
this.editTable.on("editTable_itemChanged",l.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",l.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new f({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}));this.listSelect||(this.listSelect=
new v({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",l.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",l.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",l.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",
l.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",l.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",l.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new r({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=l.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);
var a=new c({idProperty:"id",data:[]});this.listSelect.set("store",a)},_multipleSelectProviderEvent:function(a){var b=a.target||a.srcElement,f=k.isDescendant(b,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(f?"block"===k.getStyle(this.cbxPopup.domNode,"display")?k.setStyle(this.cbxPopup.domNode,"display","none"):k.setStyle(this.cbxPopup.domNode,"display","block"):k.isDescendant(b,this.cbxPopup.domNode)||this._createTargetForPredefined(),a.stopPropagation()):this._isInSelectPopup(b)||
this.runtime?a.stopPropagation():k.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new v({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",
l.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",l.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",l.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",l.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",l.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",l.hitch(this,this._createTargetForPredefined))},
_isInSelectPopup:function(a){for(var b="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),f=!1,c=0;c<=b.length;c++)if(k.hasClass(a,b[c])){f=!0;break}return f},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(a,b){this.editTable._setNewLabel(a,b);this.cbxPopup.close();this._editTableItemChanged()},
_destoryTarget:function(a){this.editTable._destroyTarget(a);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var a=this.getValueObject();this._setApplyState(a.value.length)}},_setApplyState:function(a){this.emit("predefinedValuePopup_setApplyBtnState",a)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(b){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=[b];this.getCheckedList(this.valueList);b=k.position(this.editTable.searchBtn);
var f=b.x-226,c=b.y+30;window.isRTL&&(f=b.x);this.cbxPopup=new a({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:f,top:c},useFocusLogic:!1,buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",l.hitch(this,function(){var a=k.position(this.editTable.searchBtn),b=a.x-226,f=a.y+30;window.isRTL&&
(b=a.x);this.cbxPopup.setCustomPosition(b,f)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(l.hitch(this,function(a){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==a){var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)}}))}},_valueLabels:function(){var a=new d;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),
a.resolve(!0),a;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),a.resolve(!0),a;this.pageControlForQuery.queryByPage(!0).then(l.hitch(this,function(b){a.resolve(b)}),l.hitch(this,function(b){console.log(b);this._hideLoadingIcon();a.reject(b)}));return a},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;a&&(this.pageControlForQuery._codedvalueCache=a,a=0<a.length?a:[],this.listSelect.setCBXData(a,
!0,!0))},_changeDisplayType:function(a){a=a.target||a.srcElement;a=k.hasClass(a,"option")?a:b.getAncestorDom(a,function(a){return k.hasClass(a,"option")},2);k.hasClass(a,"checked")||(k.addClass(a,"checked"),a=q("."+this.selectUI+"Option ",this.displayTypes)[0],k.removeClass(a,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var a=q(".title",this.displayTypes)[0],b=q(".label",this.displayTypes),a=(k.getStyle(this.displayTypes,"width")-k.getStyle(a,
"width")-80)/2,f=k.getStyle(b[0],"width"),f=f<a?f:a,c=k.getStyle(b[1],"width"),c=c<a?c:a;k.setStyle(b[0],"width",f+"px");k.setStyle(b[1],"width",c+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(l.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(a,!0);this._hideLoadingIcon()}),l.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},
_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(a).then(l.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._hideLoadingIcon()}),l.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a){this.listSelect&&(this._showLoadingIcon(),a=this.pageControlForQuery._searchKeyLocal(a),this.listSelect.setCBXContentBySearch(a),this._hideLoadingIcon())},_handlerPageValues:function(){},getCheckedList:function(a){this.listSelect.checkedList=
[];this.isNumberField?t.forEach(a,l.hitch(this,function(a){this.listSelect.checkedList.push(parseFloat(a))})):this.listSelect.checkedList=a},_showPopup:function(){var b=this.getValueObject().valueList;this.valueList=null===b?void 0:b;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new a({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+"("+this.fieldName+")",isResize:!1,useFocusLogic:!1,
onClose:l.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(l.hitch(this,function(a){this._hideLoadingIcon();var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(a){a.value=a.value?a.value:[];var b=q("."+(a.selectUI?a.selectUI:this.selectUI)+"Option ",this.displayTypes)[0];k.addClass(b,"checked");
b=null;if(this.isNumberField){for(var b=[],f=0;f<a.value.length;f++)b.push(a.value[f].value);b=this._getValLabelsArrayForNumber(!1,b)}this.editTable.emptyLabel=a.emptyLabel;this.editTable.enableEmpty=a.enableEmpty;this.editTable.setListValues(a.value,b)},_getValLabelsArrayForNumber:function(a,f){f=b._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,f);a&&(this.editTable.currentValLabel=f[0].label);return f},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():
this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var a=this.editTable.getListValues(),b={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:a.list,valueList:a.valueList};"unique"===this.controlType&&(b.emptyLabel=a.emptyLabel,b.enableEmpty=a.enableEmpty);return b}return null},setRequired:function(a){this.mutiValuesSelect.set("required",a)},queryByPage:function(){var a=
this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(l.hitch(this,function(b){a.resolve(b)}),l.hitch(this,function(b){console.log(b);a.reject(b)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&k.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&k.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&
document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();k.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/keys dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b){return q([u,g,e,k],{templateString:c,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"unique"===this.tableType?(this.inputType="radio",d.addClass(this.listContent,"radio-items-list-content")):
this.inputType="checkbox"},_onListContentDblClicked:function(a){this.isSearch=!1;var f=a.target||a.srcElement,c=b.getAncestorDom(f,function(a){return d.hasClass(a,"item")},3);if(c&&(d.hasClass(f,"name")||d.hasClass(f,"alias"))&&(!d.hasClass(c,"empty")||!d.hasClass(f,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(f);var e=decodeURIComponent(d.getAttr(f,"data")),c=d.hasClass(c,"custom");
this.placeHolder=d.hasClass(f,"name")&&!this.codedValues?e:a;c?d.hasClass(f,"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&d.hasClass(f,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;m.set(f,"innerHTML","");a="";d.hasClass(f,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=d.create("div",{"class":"updateInputDiv",
innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},f);a=n(".inputDiv",this.updateInputDiv)[0];this.searchBtn=n(".searchBtn",this.updateInputDiv)[0];this.own(t(this.updateInputDiv,"dblclick",l.hitch(this,function(a){a.stopPropagation();a.preventDefault()})));e={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&d.hasClass(f,"name")&&(e.disabled=!0);this.isNumberField&&d.hasClass(f,"name")?(e.constraints={pattern:"#####0.##########"},this._dijit=new h(e)):(e.trim=
!0,this._dijit=new v(e));this._dijit.startup();this._dijit.on("keydown",function(a){(a.keyCode||a.which)===p.ENTER&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",l.hitch(this,function(){if(this._dijit){var a="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&d.hasClass(f,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(a));var a=b.sanitizeHTML(a),c=this._dijit.get("value");""!==c&&c?d.hasClass(f,"name")&&(this.placeHolder===
this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&(c=b.getAncestorDom(this._dijit.domNode,function(a){return d.hasClass(a,"item")},4),d.removeClass(c,"custom"),this.emit("editTable_itemChanged")):a=this.placeHolder;this.newLabel=a;setTimeout(l.hitch(this,function(){var a,b;if(this.isSearch||"active"===this.editState)"active"===this.editState&&(f=this.updateInputDivPre.parentNode,b=decodeURIComponent(d.getAttr(f,"data")),d.hasClass(f,"name")?this.currentValLabel=""===this._dijitPre.displayedValue?
b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value:this.currentValLabel=""===this._dijitPre.displayedValue?b===this.customLabel?this.customLabel:b:this._dijitPre.displayedValue,!d.hasClass(f,"name")||"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(f.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(d.isDescendant(this.updateInputDiv,f.nextSibling)?
this._dijit.set("value",this.currentValLabel):(a=this.isNumberField?this.currentValLabel:this.newLabel,d.setAttr(f.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(f.nextSibling,a),d.setAttr(f.nextSibling,"title",a))),a=d.hasClass(f,"name")?""===this._dijitPre.displayedValue?b===this.customValue?this.customValue:b:this._dijitPre.value:this.newLabel,d.setAttr(f,"data",encodeURIComponent(a)),a=d.hasClass(f,"name")?this.currentValLabel:this.newLabel,this._setNodeText(f,a),d.setAttr(f,"title",
a),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{var f=this.updateInputDiv.parentNode;b=decodeURIComponent(d.getAttr(f,"data"));d.hasClass(f,"name")?this.currentValLabel=""===this._dijit.displayedValue?b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value:this.currentValLabel=""===this._dijit.displayedValue?b===this.customLabel?this.customLabel:b:this._dijit.displayedValue;
d.hasClass(f,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(f.nextSibling)===this.customLabel&&(a=this.isNumberField?this.currentValLabel:this.newLabel,d.setAttr(f.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(f.nextSibling,a),d.setAttr(f.nextSibling,"title",a));a=d.hasClass(f,"name")?""===this._dijit.displayedValue?b===this.customValue?this.customValue:b:this._dijit.value:this.newLabel;d.setAttr(f,"data",encodeURIComponent(a));a=d.hasClass(f,"name")?
this.currentValLabel:this.newLabel;this._setNodeText(f,a);d.setAttr(f,"title",a);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));d.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);n("input",this._dijit.domNode)[1].focus();this.searchBtn&&(this.own(t(this.searchBtn,"click",l.hitch(this,function(a){this.isSearch||(this.isSearch=!0,this.searchTarget=a.target||a.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),a.stopPropagation(),a.preventDefault())}))),
this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,b){var f;void 0===a&&void 0===b&&(""!==this._dijit.displayedValue?this.codedValues?(b=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(b)):(b=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(b=this._getLocalNumber(a))):(a=b=this.customValue,this.updateInputDiv&&
this.updateInputDiv.parentNode&&(f=this.updateInputDiv.parentNode,f=decodeURIComponent(d.getAttr(f,"data")),f!==this.customValue&&(a=this.isNumberField?parseFloat(f):f,b=this.codedValues?this._getLabelFromCodevalue(a):this.isNumberField?this._getLocalNumber(a):a))));this.updateInputDiv&&this.updateInputDiv.parentNode&&(f=this.updateInputDiv.parentNode,b!==this.customValue&&this._getNodeText(f.nextSibling)===this.customLabel&&(d.setAttr(f.nextSibling,"data",encodeURIComponent(b)),this._setNodeText(f.nextSibling,
b),d.setAttr(f.nextSibling,"title",b)),this.codedValues||(a=a?a:decodeURIComponent(d.getAttr(f,"data"))),d.setAttr(f,"data",encodeURIComponent(a)),a=f.parentNode,b!==this.customValue&&d.removeClass(a,"custom"),this._setNodeText(f,b),d.setAttr(f,"title",b));this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var f=b.getAncestorDom(a,function(a){return d.hasClass(a,"item")},3);f&&(d.hasClass(a,"checkboxEmpty")?d.hasClass(a,"checked")?d.removeClass(a,"checked"):
d.addClass(a,"checked"):d.hasClass(a,this.inputType)?("radio"===this.inputType&&!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),d.hasClass(a,"checked")?"radio"!==this.inputType?d.removeClass(a,"checked"):d.hasClass(this.currentItem,"checked")||d.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&d.removeClass(this.currentItem,"checked"),d.addClass(a,"checked"),this.currentItem=a)):d.hasClass(a,"action")&&(d.hasClass(a,"up")?f.previousElementSibling&&d.place(f,f.previousElementSibling,
"before"):d.hasClass(a,"down")?f.nextElementSibling&&d.place(f,f.nextElementSibling,"after"):d.hasClass(a,"delete")&&(d.destroy(f),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var e=this.codedValues[c];if(e.value===a){b=e.label;break}}return b},_getCodeFromCodevalueLabel:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var e=this.codedValues[c];if(e.label===a){b=e.value;break}}return b},_createEmptyTarget:function(a){for(var b=
this.emptyStr,c=this.emptyLabel?this.emptyLabel:b,e=" checked",g=0;g<a.length;g++)if(a[g].isChecked){e="";break}" checked"===e&&(this.currentItem=!0);var g='data\x3d"'+encodeURIComponent(b)+'"',h="",k=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)h=" checked";return d.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+g+"\x3e"+b+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+
this.inputType+e+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+h+' jimu-ellipsis jimu-flipx" title\x3d"'+k+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,b,c,e,g){var f="item";g&&(a=b=this.customValue,c=this.customLabel,f="item custom");a=a||0===a?a:"";b=b||"";c=c?c:a;e=e?e:"";var h=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(h=this.codedValues?this._getLabelFromCodevalue(a):b);b=this.isNumberField?a:encodeURIComponent(a);
e=d.create("div",{"class":f,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" '+('data\x3d"'+b+'"')+"\x3e"+h+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+e+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent);g&&(g=n(".name",e)[0],d.setAttr(g,"title",a),d.setAttr(g.nextSibling,"title",c));return e},_destroyTarget:function(a){for(var b=n(".item .name",this.listContent),c=0;c<b.length;c++){var e=b[c];if(m.get(this._dijit.domNode.parentNode,"innerHTML")===a){d.destroy(e.parentNode);break}}},getCurrentItem:function(){for(var a=n(".item .radio",this.listContent),b=0;b<a.length;b++){var c=a[b];if(d.hasClass(c,"checked"))return c}return null},_getEmptyLabel:function(){var a=n(".label.alias",
this.listContent.firstChild)[0],f=this._getNodeText(a);a.children.length&&(f="Error"===this._dijit.state?decodeURIComponent(d.getAttr(a,"data")):this._dijit.value);return f=b.sanitizeHTML(f)},_getEmptyStatus:function(){var a=n(".checkboxEmpty",this.listContent.firstChild)[0];return d.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,b){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=b:a.innerText=b},getListValues:function(){this.listItemsArray=
[];this.listValuesArray=[];for(var a=n(".item .name",this.listContent),f="radio"===this.inputType?1:0;f<a.length;f++){var c=a[f],e=b.getAncestorDom(c,function(a){return d.hasClass(a,"item")},3);if(!d.hasClass(e,"custom")){var e=this._getNodeText(c),g=decodeURIComponent(d.getAttr(c,"data"));if(this.isNumberField||this.codedValues)e=g;c.children.length&&(e="Error"===this._dijit.state?g:this._dijit.value,this.codedValues&&(e=this._getCodeFromCodevalueLabel(e),e=void 0!==e?e:g));e=this.isNumberField?
parseFloat(e):b.sanitizeHTML(e);g=this._getNodeText(c.nextSibling);g===this.customLabel&&(g=e.toString(),this.isNumberField&&(g=this._getLocalNumber(g)));c.nextSibling.children.length&&(g="Error"===this._dijit.state?decodeURIComponent(d.getAttr(c.nextSibling,"data")):this._dijit.value);g=b.sanitizeHTML(g);g={value:e,alias:g,isChecked:!1};this.listItemsArray.push(g);this.listValuesArray.push(e);d.hasClass(c.nextSibling.nextSibling,"checked")&&(g.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};
"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());return a},setListValues:function(a,b){m.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var f=0;f<a.length;f++){var c=a[f],e="";c.isChecked&&(e=" checked",this.currentItem=!0);this._createTarget(c.value,b?b[f].label:c.value,c.alias,e)}a=n(".name",this.listContent);for(b=0;b<a.length;b++)f=a[b],d.setAttr(f,"title",this._getNodeText(f)),f=f.nextSibling,d.setAttr(f,
"title",this._getNodeText(f))},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r,w,z,N){var H=l("dojox.form._CheckedMultiSelectItem",[n,v,h],{templateString:w,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(a){this.get("disabled")||this.get("readOnly")?t.stop(a):this.checkBox._onClick(a)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(a){this.disabled=a||this.option.disabled;this.checkBox.set("disabled",this.disabled);m.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(a){this.checkBox.set("readOnly",a);this.readOnly=a}}),I=l("dojox.form._CheckedMultiSelectMenu",e,{multiple:!1,buildRendering:function(){this.inherited(arguments);var a=this.menuTableNode=this.domNode,b=this.domNode=q.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
a.parentNode&&a.parentNode.replaceChild(b,a);m.remove(a,"dijitMenuTable");b.className=a.className+" dojoxCheckedMultiSelectMenu";a.className="dijitReset dijitMenuTable";a.setAttribute("role","listbox");b.setAttribute("role","presentation");b.appendChild(a)},resize:function(a){a&&(p.setMarginBox(this.domNode,a),"w"in a&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(a,b){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled||a.readOnly)return!1;if(!this.multiple)this.onExecute();a.onClick(b)}}),E=l("dojox.form._CheckedMultiSelectMenuItem",c,{templateString:r,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(a){},_updateBox:function(){m.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||m.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(a){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(k.forEach(this.parent.getChildren(),function(a){a.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return l("dojox.form.CheckedMultiSelect",a,{templateString:z,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=u.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=a?a:0].value}this.dropDown&&(m.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new I({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:d.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new f({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(a){a.preventDefault()},validator:function(){return this.required?k.some(this.getOptions(),function(a){return a.selected&&null!=a.value&&0!=a.value.toString().length}):!0},validate:function(a){b.hide(this.domNode);
(a=this.isValid(a))||this.displayMessage(this.invalidMessage);return a},isValid:function(a){return this.validator()},getErrorMessage:function(a){return this.invalidMessage},displayMessage:function(a){b.hide(this.domNode);a&&b.show(a,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(a,b){},_addOptionItem:function(a){var b;this.dropDown?(b=new E({option:a,parent:this.dropDownMenu}),this.dropDownMenu.addChild(b)):(b=new H({option:a,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(b.domNode));this.onAfterAddOptionItem(b,a)},_refreshState:function(){this.validate(this.focused)},onChange:function(a){this._refreshState()},reset:function(){this.inherited(arguments);b.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);k.forEach(this._getChildren(),function(a){a._updateBox()});q.empty(this.containerNode);var a=this;k.forEach(this.value,function(b){b=q.create("option",{value:b,label:b,selected:"selected"});
q.place(b,a.containerNode)});if(this.dropDown&&this.dropDownButton){var b=0,f="";k.forEach(this.options,function(a){a.selected&&(b++,f=a.label)});this.dropDownButton.set("label",this.multiple?d.replace(this._nlsResources.multiSelectLabelText,{num:b}):f)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():k.map(this.wrapperDiv.childNodes,function(a){return g.byNode(a)})},invertSelection:function(a){this.multiple&&(k.forEach(this.options,function(a){a.selected=!a.selected}),
this._updateSelection())},_setDisabledAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",a);k.forEach(this._getChildren(),function(b){b&&b.set&&b.set("disabled",a)})},_setReadOnlyAttr:function(a){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",a);this.readOnly=a;k.forEach(this._getChildren(),function(b){b&&b.set&&b.set("readOnly",a)})},uninitialize:function(){b.hide(this.domNode);k.forEach(this._getChildren(),
function(a){a.destroyRecursive()});this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(l,d,k,t,p,m,q,u,n){t("dijit-legacy-requires")&&m(0,function(){l(["dijit/form/RadioButton"])});return d("dijit.form.CheckBox",[q,u],{templateString:n,baseClass:"dijitCheckBox",_setValueAttr:function(d,h){"string"==
typeof d&&(this.inherited(arguments),d=!0);this._created&&this.set("checked",d,h)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&p("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&p("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(l,d){return l("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(k){this._set("readOnly",k);d.set(this.focusNode,"readOnly",k)},_setLabelAttr:void 0,_getSubmitValue:function(d){return null==d||""===d?"on":d},_setValueAttr:function(k){k=this._getSubmitValue(k);this._set("value",k);d.set(this.focusNode,
"value",k)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));d.set(this.focusNode,"value",this.value)},_onClick:function(d){return this.readOnly?(d.stopPropagation(),d.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(l,d,k,t,p,m,q,u){return t([p,m,q],{templateString:u,postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());k.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),l.hitch(this,function(d){this.rangeSelect.addOption({value:d,label:this.nls[d]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(d){this.isDefined(d.value)&&this._dijit1.set("value",d.value);this.isDefined(d.range)&&this.rangeSelect.set("value",d.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var d=this.rangeSelect.get("value");"none"===d&&(d=null);return d},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var d={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(d.value)&&(d.value=null);return d}return null},setRequired:function(d){this._dijit1.set("required",d);this.rangeSelect.set("required",d)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(l,d,k,t,p,m,q,u){return t([q,p,l],{templateString:m,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(k.hitch(this,function(d){this.dateTypeSelect.addOption({value:d,label:this.nls[d]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(d,k,h,g){if(this.isDefined(k[h])){var e={value:null,virtualDate:""};e.value=k[h];e.virtualDate=k[g];d.setValueObject(e)}},setValueObject:function(d){this.dateTypeSelect.set("value",d.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var d={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},k=this.dateTypeSelect.get("value"),
h=u.getRealDateByVirtualDate(k);d.virtualDate=k;h&&(d.value1=h[0].toDateString(),d.value2=h[1].toDateString());return d},setRequired:function(d){this.dateTypeSelect.set("required",d)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b){return d([k,t,p,l],{templateString:m,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,runtime:!1,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);
this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(v(document,"click",q.hitch(this,function(a){a=a.target;u.isDescendant(a,this.valueTypePopupNode)&&!u.hasClass(a,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(v(window,"resize",q.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",
interactiveObj:"",caseSensitive:!1},b=this._getFieldObjByUI();if(!b)return null;a.fieldObj=b;b=this._getOperatorByUI();if(!b)return null;a.operator=b;a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();var b=this._getValueTypeByUI(),c=this._isUseAskForValues();if(c){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;a.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};if("unique"===b||"multiple"===
b)a.interactiveObj.cascade=this.cascadeSelect.get("value")}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;c.type=b;a.valueObj=c;return a},_getFieldObjByUI:function(){var a=this._getSelectedFilteringItem(this.fieldsSelect);if(!a)return null;var b="";0!==this.popupFieldsInfo.length&&(b=e.getDateFieldFormatByFieldName(this.popupFieldsInfo,a.name));return{name:a.name,label:a.name,dateFormat:b,shortType:a.shortType,type:a.type}},
_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){u.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){u.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){u.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){u.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);
this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(v(this.fieldsSelect,"MouseEnter",q.hitch(this,this._updateFieldsSelectTitle)));this.own(v(this.operatorsSelect,"MouseEnter",q.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?
(u.setStyle(this.cbxAskValues.domNode,"display","inline-block"),u.setStyle(this.promptSection,"display","block"),this.own(v(this.cbxAskValues,"status-change",q.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=q.hitch(this,this._onCbxAskValuesClicked)):(u.setStyle(this.cbxAskValues.domNode,"display","none"),u.setStyle(this.promptSection,"display","none"));var a=this.layerInfo.fields;a&&0<a.length&&(a=n.filter(a,q.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),
0<a.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(a),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(q.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=v(this.fieldsSelect,"change",q.hitch(this,this._onFieldsSelectChange));this._handle2=v(this.operatorsSelect,"change",
q.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,b){if(this._isStreamServer(a))return!1;a=b.currentVersion?b:b.toJson().layerDefinition;return 10.1<=parseFloat(a.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title=
"";var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var a=this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label)},_showValidationErrorTip:function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(f){console.error(f)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=
a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(a){a=n.map(a,q.hitch(this,function(a,b){var f=q.mixin({},a);f.id=b;f.shortType=this._getShortTypeByFieldType(a.type);f.alias||(f.alias=f.name);a="";"string"===f.shortType?a=this.nls.string:"number"===f.shortType?a=this.nls.number:"date"===f.shortType&&
(a=this.nls.date);f.displayName=f.alias+" ("+a+")";return f}));if(0<a.length){var b=new g({data:a});this.fieldsSelect.set("store",b);this.fieldsSelect.set("value",a[0].id)}this._updateOperatorsByFieldsSelect()},_showPart:function(a){if((this.part=a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});
0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();
this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",label:this.nls.none});var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.operatorsSelect.shortType=a.shortType,a=c.getOperatorsByShortType(a.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),n.forEach(a,q.hitch(this,function(a){this.operatorsSelect.addOption({value:a,
label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){u.removeClass(this.domNode,"value-type");u.removeClass(this.domNode,"field-type");u.removeClass(this.domNode,"unique-type");u.removeClass(this.domNode,"support-cascade");var a=this._getValueTypeByUI();"value"===a?(u.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===a?(u.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value",
"none")):(u.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),a=!0,a=this._getSelectedFilteringItem(this.fieldsSelect),a=e.getCodedValuesOrTypesCount(a,this.layerInfo),(a=0<a?e.isCodedValuesSupportFilter(this.layerInfo,a):!0)?(this.cascadeSelect.set("value","previous"),u.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(a,b){a=h("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];b?u.removeClass(a,
"disabled"):u.addClass(a,"disabled")},_setVisibleValueTypeSelectOption:function(a,b){a=h("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];b?u.setStyle(a,"display","block"):u.setStyle(a,"display","none")},_calcValueTypePosition:function(a){var b,c;a=u.position(a.target);b=u.position(document.body).w;c=u.position(document.body).h;var e=u.getStyle(this.valueTypePopupNode,"width"),d=u.getStyle(this.valueTypePopupNode,"height");c=c-a.y-16-10>=d?a.y+16+10:a.y-d-10;b=b-a.x>=e?a.x:a.x+16-e;window.isRTL&&
(b=a.x+16>=e?a.x+16-e:a.x);return{left:b,top:c}},_onValueTypeSetClick:function(a){b.open({popup:this.customDijit,around:a.target});var c=this._calcValueTypePosition(a);b.open({x:c.left,y:c.top,popup:this.customDijit});a.stopPropagation()},_onValueTypeClick:function(a){var b=u.getAttr(a.currentTarget,"data-type");u.hasClass(a.currentTarget,"disabled")?a.stopPropagation():(h("li",this.valueTypePopupNode).forEach(function(a){u.removeClass(a,"selected")}),u.addClass(a.currentTarget,"selected"),this._resetByFieldAndOperator(null,
b),this._closeEsriPopup())},_enableValueTypeOption:function(a){this._enableValueTypeSelectOption("value",a)},_enableFieldTypeOption:function(a){this._enableValueTypeSelectOption("field",a)},_enableUniqueTypeOption:function(a){this._enableValueTypeSelectOption("unique",a)},_enableUniquePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",!1):this._enableValueTypeSelectOption("uniquePredefined",a)},_enableValuesTypeOption:function(a){this._enableValueTypeSelectOption("values",
a)},_enableMultipleTypeOption:function(a){this._enableValueTypeSelectOption("multiple",a)},_enableMultiplePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",a)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},
_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(a,b){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();a||(a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",
caseSensitive:!1},a.fieldObj=this._getFieldObjByUI(),a.operator=this._getOperatorByUI());var f=[],e=null;a.fieldObj&&a.operator&&(f=this.valueProviderFactory.getSupportedValueTypes(a.fieldObj.name,a.operator),a.valueObj?e=a.valueObj.type:(e=b&&0<=f.indexOf(b)?b:f[0],a.valueObj={type:e}),0<=f.indexOf("value")&&this._enableValueTypeOption(!0),0<=f.indexOf("field")&&this._enableFieldTypeOption(!0),0<=f.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=f.indexOf("values")&&this._enableValuesTypeOption(!0),
0<=f.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),0<=f.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=f.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===e?this._enableValueTypeOption(!0):"field"===e?this._enableFieldTypeOption(!0):"unique"===e?this._enableUniqueTypeOption(!0):"values"===e?this._enableValuesTypeOption(!0):"uniquePredefined"===e?this._enableUniquePredefinedTypeOption(!0):"multiple"===e?this._enableMultipleTypeOption(!0):
"multiplePredefined"===e&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(e));0<f.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(a,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(a.valueObj),this.own(v(this.valueProvider,"change",q.hitch(this,function(){this.emit("change")}))),this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(u.addClass(this.valueProvider.domNode,"hidden"),
u.addClass(this.attributeValueContainer,"hidden")):u.removeClass(this.attributeValueContainer,"hidden"),(b=c.getOperatorInfo(a.operator))&&e&&(b[e]&&b[e].supportCaseSensitive&&this._showCaseSensitive(),a&&this.cbxCaseSensitive.setValue(a.caseSensitive))):u.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();
this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){var a=this._getValueTypeByUI();return"uniquePredefined"===a||"multiplePredefined"===a?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},_getValueTypeByUI:function(){var a=h("li.selected",this.valueTypePopupNode)[0];
return a?u.getAttr(a,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&b.close(this.customDijit)},_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),b.close(this.customDijit))},_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");u.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+
this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul\x3e\x3cli data-type\x3d"value" title\x3d"'+this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"field" title\x3d"'+this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"unique" title\x3d"'+this.nls.unique+
'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"uniquePredefined" title\x3d"'+this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"multiple" title\x3d"'+this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"multiplePredefined" title\x3d"'+this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+
this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";this.customDijit=new k({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});var a=h(".value-type-popup-icon",this.valueTypePopupNode)[0];this.own(v(a,"click",q.hitch(this,function(a){this._closeEsriPopup();a.stopPropagation()})));a=h("li",this.valueTypePopupNode);this.own(v(a,"click",q.hitch(this,function(a){this._onValueTypeClick(a)})))}},_updateValueTypeUI:function(a){h("li",this.valueTypePopupNode).forEach(function(a){u.removeClass(a,
"selected")});if(a=h("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0])return u.addClass(a,"selected")},_updatePrompt:function(a,b){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!a&&b&&this.cbxAskValues.uncheck(!0);u.setStyle(this.promptTable,"display","table");b=this.operatorsSelect.get("value");var f=this.nls[b],e=!1,d=this._getValueTypeByUI(),g=c.getOperatorInfo(b);g&&d&&(g=g[d])&&g.supportAskForValue&&(e=!0);e||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));
g=this.cbxAskValues.getValue();(d=0<=["uniquePredefined","multiplePredefined"].indexOf(d)?!0:!1)?this.cbxAskValues.check(!0):a?g?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):e?this.cbxAskValues.status||this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(u.setStyle(this.promptTable,"display","table"),(a=this._getSelectedFilteringItem(this.fieldsSelect))&&"none"!==b&&this.promptTB.set("value",(a.alias||a.name)+" "+f)):u.setStyle(this.promptTable,
"display","none");d?(this.cbxAskValues.setStatus(!1),this.cascadeSelect.setDisabled(!0)):this.cascadeSelect.setDisabled(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){return d([k,t,p,l],{templateString:m,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var b=e(".jimu-single-filter",
this.allExpsBox),b=v.map(b,u.hitch(this,function(a){return q.byNode(a).toJson()}));return v.every(b,u.hitch(this,function(a){return!!a}))&&0<b.length?{logicalOperator:this.allAnySelect.value,parts:b}:null},showDelteIcon:function(){n.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){n.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(h(this.btnAdd,"click",u.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=
this.partsObj.logicalOperator;var b=this.partsObj.parts||[];0===b.length?(this._addSingleFilter(),this._addSingleFilter()):1===b.length?(this._addSingleFilter(b[0]),this._addSingleFilter()):v.forEach(b,u.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter()},_addSingleFilter:function(b){b=new c({url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,
part:b,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});b.placeAt(this.allExpsBox);b.startup();this.own(g.after(b,"_destroySelf",u.hitch(this,this._checkFilterNumbers)));this.own(h(b,"change",u.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_checkFilterNumbers:function(){var b=e(".jimu-single-filter",this.allExpsBox),a=2<b.length;v.forEach(b,
u.hitch(this,function(b){b=q.byNode(b);a?b.showDelteIcon():b.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(l,d,k){return l("dgrid.OnDemandGrid",[d,k],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(l,d,k,t,p,m,q){function u(d,g){g&&g.nodeType&&d.appendChild(g)}function n(d,
g,e,c){if(this.formatter){c=this.formatter;var b=this.grid.formatterScope;e.innerHTML="string"===typeof c&&b?b[c](g,d):this.formatter(g,d)}else null!=g&&e.appendChild(document.createTextNode(g))}var v=8>t("ie")&&!t("quirks");d=d("dgrid.Grid",m,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(d){return"object"!=typeof d?this.columns[d]:this.cell(d).column},listType:"grid",cell:function(d,g){if(d.column&&d.element)return d;d.target&&d.target.nodeType&&(d=d.target);var e;
if(d.nodeType){do{if(this._rowIdToObject[d.id])break;var c=d.columnId;if(c){g=c;e=d;break}d=d.parentNode}while(d&&d!=this.domNode)}if(!e&&"undefined"!=typeof g){var b=this.row(d);if(c=b&&b.element)for(var c=c.getElementsByTagName("td"),a=0;a<c.length;a++)if(c[a].columnId==g){e=c[a];break}}if(null!=d)return{row:b||this.row(d),column:g&&this.column(g),element:e}},createRowCells:function(d,g,e,c){var b=p("table.dgrid-row-table[role\x3dpresentation]"),a=9>t("ie")||t("quirks")?p(b,"tbody"):b,f,h,k,z,n,
l,m,u,y,A;e=e||this.subRows;h=0;for(k=e.length;h<k;h++)for(l=e[h],f=p(a,"tr"),l.className&&p(f,"."+l.className),z=0,n=l.length;z<n;z++){m=l[z];u=m.id;y=m.field?".field-"+q.escapeCssIdentifier(m.field,"-"):"";(A="function"===typeof m.className?m.className(c):m.className)&&(y+="."+A);y=p(d+(".dgrid-cell.dgrid-cell-padding"+(u?".dgrid-column-"+q.escapeCssIdentifier(u,"-"):"")+y.replace(/ +/g,"."))+"[role\x3d"+("th"===d?"columnheader":"gridcell")+"]");y.columnId=u;v?(u=p(y,"!dgrid-cell-padding div.dgrid-cell-padding"),
y.contents=u):u=y;if(A=m.colSpan)y.colSpan=A;if(A=m.rowSpan)y.rowSpan=A;g(u,m);f.appendChild(y)}return b},left:function(d,g){d.element||(d=this.cell(d));return this.cell(this._move(d,-(g||1),"dgrid-cell"))},right:function(d,g){d.element||(d=this.cell(d));return this.cell(this._move(d,g||1,"dgrid-cell"))},renderRow:function(d,g){var e=this.createRowCells("td",function(c,b){var a=d;b.get?a=b.get(d):"field"in b&&"_item"!=b.field&&(a=a[b.field]);b.renderCell?u(c,b.renderCell(d,a,c,g)):n.call(b,d,a,c,
g)},g&&g.subRows,d);return p("div[role\x3drow]\x3e",e)},renderHeader:function(){var d=this,g=this.headerNode,e=g.childNodes.length;for(g.setAttribute("role","row");e--;)p(g.childNodes[e],"!");e=this.createRowCells("th",function(c,b){var a=b.headerNode=c;v&&(c=c.parentNode);var f=b.field;f&&(c.field=f);b.renderHeaderCell?u(a,b.renderHeaderCell(a)):("label"in b||b.field)&&a.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&f&&"_item"!=f&&(c.sortable=!0,c.className+=
" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[e.id=this.id+"-header"]=this.columns;g.appendChild(e);this._sortListener&&this._sortListener.remove();this._sortListener=k(e,"click,keydown",function(c){if("click"==c.type||32==c.keyCode||!t("opera")&&13==c.keyCode){var b=c.target,a,f,e;do if(b.sortable){e=[{attribute:a=b.field||b.columnId,descending:(f=d._sort[0])&&f.attribute==a&&!f.descending}];a={bubbles:!0,cancelable:!0,grid:d,parentType:c.type,sort:e};k.emit(c.target,
"dgrid-sort",a)&&(d._sortNode=b,d.set("sort",e));break}while((b=b.parentNode)&&b!=g)}})},resize:function(){var d=this.headerNode.firstChild,g=this.contentNode,e;this.inherited(arguments);if(!t("ie")||7<t("ie")&&!t("quirks"))g.style.width="",g&&d&&(e=d.offsetWidth)!=g.offsetWidth&&(g.style.width=e+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(d,g){this.inherited(arguments);this.updateSortArrow(this._sort)},
_findSortArrowParent:function(d){var g=this.columns,e;for(e in g){var c=g[e];if(c.field==d)return c.headerNode}},updateSortArrow:function(d,g){this._lastSortedArrow&&(p(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),p(this._lastSortedArrow,"!"),delete this._lastSortedArrow);g&&(this._sort=d);if(d[0]){g=d[0].attribute;d=d[0].descending;g=this._sortNode||this._findSortArrowParent(g);var e;delete this._sortNode;g&&(g=g.contents||g,e=this._lastSortedArrow=p("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),
e.innerHTML="\x26nbsp;",g.insertBefore(e,g.firstChild),p(g,d?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(d,g){return this.addCssRule("#"+q.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+q.escapeCssIdentifier(d,"-"),g)},_configColumns:function(d,g){var e=[],c=g instanceof Array;q.each(g,function(b,a){"string"==typeof b&&(g[a]=b={label:b});c||b.field||(b.field=a);a=b.id=b.id||(isNaN(a)?a:d+a);this._configColumn&&(this._configColumn(b,a,g,d),a=b.id);c&&(this.columns[a]=
b);b.grid=this;"function"===typeof b.init&&b.init();e.push(b)},this);return c?g:e},_destroyColumns:function(){var d=this.subRows,g=d&&d.length,e,c,b,a;this.cleanup();for(e=0;e<g;e++)for(c=0,a=d[e].length;c<a;c++)b=d[e][c],"function"===typeof b.destroy&&b.destroy()},configStructure:function(){var d=this.subRows,g=this._columns=this.columns;this.columns=!g||g instanceof Array?{}:g;if(d)for(g=0;g<d.length;g++)d[g]=this._configColumns(g+"-",d[g]);else this.subRows=[this._configColumns("",g)]},_getColumns:function(){return this._columns||
this.columns},_setColumns:function(d){this._destroyColumns();this.subRows=null;this.columns=d;this._updateColumns()},_setSubRows:function(d){this._destroyColumns();this.subRows=d;this._updateColumns()},setColumns:function(d){l.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",d)},setSubRows:function(d){l.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",d)},_updateColumns:function(){this.configStructure();this.renderHeader();
this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});d.appendIfNode=u;d.defaultRenderCell=n;return d})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(l,d,k,t,p,m,q,u,n){function v(a,b){n(document.body,
a,".dgrid-scrollbar-measure");b=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return b}function h(a){var b=a?"."+a.replace(r,"."):"";this._class&&(b="!"+this._class.replace(r,"!")+b);n(this.domNode,b);this._class=a}function g(){return this._class}function e(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function c(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}u("mozilla","opera","webkit",
"ie","ie-6","ie-6-7","quirks","no-quirks","touch");var b,a;p.add("dom-scrollbar-width",function(a,b,c){return v(c,"Width")});p.add("dom-scrollbar-height",function(a,b,c){return v(c,"Height")});p.add("dom-rtl-scrollbar-left",function(a,b,c){a=n("div");n(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");n(c,a);b=!!p("ie")||!!p("trident")||a.offsetLeft>=p("dom-scrollbar-width");c.className="";document.body.removeChild(c);n(a,"!");c.removeAttribute("dir");return b});var f=0,r=/ +/g,w=7>p("ie")&&
!p("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};return d("dgrid.List",p("touch")?q:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=
function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||n("div");var c;a?(this.params=a,d.safeMixin(this,a),c=a["class"]||a.className||b.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();
this.id=b.id=b.id||this.id||"dgrid_"+f++;null===this.useTouchScroll&&(this.useTouchScroll=!p("dom-scrollbar-width"));this.buildRendering();c&&h.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,f,e,d,g;g=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";n(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?
".ui-widget":""));f=this.headerNode=n(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(p("quirks")||8>p("ie"))&&n(a,"div.dgrid-spacer");e=this.bodyNode=n(a,"div.dgrid-scroller");p("ff")&&(e.tabIndex=-1);this.headerScrollNode=n(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));d=this.footerNode=n("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));n(a,d);g&&(a.className+=" dgrid-rtl"+
(p("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));t(e,"scroll",function(b){c.showHeader&&(f.scrollLeft=b.scrollLeft||e.scrollLeft);b.stopPropagation();t.emit(a,"scroll",{scrollTarget:e})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=n(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=t(window,"resize",m.throttleDelayed(w,this)))},postCreate:p("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},
startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var c=this.bodyNode,f=this.headerNode,e=this.footerNode,d=f.offsetHeight,g=this.showFooter?e.offsetHeight:0,h=p("quirks")||7>p("ie");this.headerScrollNode.style.height=c.style.marginTop=d+"px";c.style.marginBottom=g+"px";h&&(c.style.height="",c.style.height=Math.max(this.domNode.offsetHeight-d-g,0)+"px",g&&(e.style.bottom="1px",setTimeout(function(){e.style.bottom=
""},0)));b||(b=p("dom-scrollbar-width"),a=p("dom-scrollbar-height"),p("ie")&&(b++,a++),m.addCssRule(".dgrid-scrollbar-width","width: "+b+"px"),m.addCssRule(".dgrid-scrollbar-height","height: "+a+"px"),17==b||h||(m.addCssRule(".dgrid-header-row","right: "+b+"px"),m.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+b+"px")));h&&(f.style.width=c.clientWidth+"px",setTimeout(function(){f.scrollLeft=c.scrollLeft},0))},addCssRule:function(a,b){a=m.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);
return a},on:function(a,b){a=t(this.domNode,a,b);p("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=
!1;this.cleanup();n(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,c,f,e){if(b){var d=this.insertRow(a,b,c,f,e);n(d,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){n(d,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return d}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<
b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&n(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function f(){var b=arguments;if(-1<m)for(var f=0;f<b.length;f++){var d=b[f],g=v[d?0:v.length-1];if(g=g&&e(g)){var r=g[d?"previousSibling":"nextSibling"];r&&(r=h.row(r));r&&r.element!=g&&(d=d?"unshift":"push",a[d](r.data),v[d](r.element),
c.count++)}}}function e(a){return!k.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function d(a){q=h.insertRow(a,z,null,r++,c);q.observerIndex=m;return q}function g(a){p=a.slice(0);(l=b?b.parentNode:h.contentNode)&&l.parentNode&&(l!==h.contentNode||a.length)?(l.insertBefore(z,b||null),(q=a[a.length-1])&&h.adjustRowIndices(q)):w[m]&&h.cleanEmptyObservers&&"undefined"!==typeof m&&(w[m].cancel(),w[m]=0,h._numObservers--);v=a;n&&(n.rows=v)}c=c||{};
var h=this,r=c.start||0,w=this.observers,v,l,m;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var n=a.observe(function(d,g,r){var k,w,y;-1<g&&v[g]&&(k=v.splice(g,1)[0],k.parentNode==l&&((w=k.nextSibling)&&g!=r&&w.rowIndex--,h.removeRow(k)),c.count--,h._processScroll&&h._processScroll());if(-1<r){if(v.length)if(0===r)y=(y=v[r])&&e(y);else{if(y=v[r-1])y=e(y),y=(y.connected||y).nextSibling}else y=h._getFirstRowSibling&&h._getFirstRowSibling(l);k&&y&&k.id===y.id&&
(y=(y.connected||y).nextSibling);y&&!y.parentNode&&(y=document.getElementById(y.id));k=b&&b.parentNode||y&&y.parentNode||h.contentNode;if(k=h.newRow(d,k,y,c.start+r,c))if(k.observerIndex=m,v.splice(r,0,k),!w||r<g)w=(w=k.previousSibling)&&w.rowIndex+1!=k.rowIndex&&0!=k.rowIndex?w:k;c.count++}0===g?f(1,1):g===a.length-(-1===r?0:1)&&f(0,0);g!=r&&w&&h.adjustRowIndices(w);h._onNotification(v,d,g,r)},!0);m=w.push(n)-1}var z=document.createDocumentFragment(),q,p;if(a.map){if(v=a.map(d,console.error),v.then)return a.then(function(b){a=
b;return v.then(function(a){g(a);f(1,1,0,0);return p})})}else{v=[];for(var u=0,t=a.length;u<t;u++)v[u]=d(a[u])}g(v);f(1,1,0,0);return p},_onNotification:function(a,b,c,f){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,f,e){var d=e.parentId,d=this.id+"-row-"+(d?d+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(d),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);
g.className=(g.className||"")+" dgrid-row "+(1==f%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=d]=a;b.insertBefore(g,c||null);h&&this.adjustRowIndices(h);g.rowIndex=f;return g},renderRow:function(a,b){return n("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||n(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+
5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,f){var e,d;d=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){d=e;b+=0>b?1:-1;break}while(a=(!f||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,
!e||e===this.bodyNode||e===this.headerNode)break;while(b);return d},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:p("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):c.call(this,a)}:c,getScrollPosition:p("touch")?function(){return this.useTouchScroll?this.inherited(arguments):e.call(this)}:e,get:function(a){var b=
"_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:g,_setClass:h,_getClassName:g,_setClassName:h,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();
this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,f){c=c[a];f=f[a];void 0===c&&(c="");void 0===f&&(f="");return c==f?0:c>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){l.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;n(b,(a?"!":".")+"dgrid-header-hidden");
this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){l.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;n(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(l,d){l.add("dom-contains",function(d,k,h){return!!h.contains});var k=[],t,p,m,q=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,
u={defaultDelay:15,throttle:function(d,k,h){var g=!1;h=h||u.defaultDelay;return function(){g||(g=!0,d.apply(k,arguments),setTimeout(function(){g=!1},h))}},throttleDelayed:function(d,k,h){var g=!1;h=h||u.defaultDelay;return function(){if(!g){g=!0;var e=arguments;setTimeout(function(){g=!1;d.apply(k,e)},h)}}},debounce:function(d,k,h){var g;h=h||u.defaultDelay;return function(){g&&(clearTimeout(g),g=null);var e=arguments;g=setTimeout(function(){d.apply(k,e)},h)}},each:function(d,k,h){var g,e;if(d)if("number"===
typeof d.length)for(g=0,e=d.length;g<e;g++)k.call(h,d[g],g,d);else for(g in d)k.call(h,d[g],g,d)},contains:function(d,k){return l("dom-contains")?d.contains(k):d.compareDocumentPosition(k)&8},addCssRule:function(l,v){t||(t=d(document.getElementsByTagName("head")[0],"style"),t=t.sheet||t.styleSheet,p=t.deleteRule?"deleteRule":"removeRule",m=t.cssRules?"cssRules":"rules");var h=k.length;k[h]=(t.cssRules||t.rules).length;t.addRule?t.addRule(l,v):t.insertRule(l+"{"+v+"}",k[h]);return{get:function(d){return t[m][k[h]].style[d]},
set:function(d,e){"undefined"!==typeof k[h]&&(t[m][k[h]].style[d]=e)},remove:function(){var d=k[h],e,c;if(void 0!==d)for(t[p](d),k[h]=void 0,e=h+1,c=k.length;e<c;e++)k[e]>d&&k[e]--}}},escapeCssIdentifier:function(d,k){return"string"===typeof d?d.replace(q,k||"\\$1"):d}};return u})},"xstyle/has-class":function(){define(["dojo/has"],function(l){var d={};return function(){for(var k,t=arguments,p=0;p<t.length;p++)if(k=t[p],!d[k]){d[k]=!0;var m=k.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),q=l(m[2]),
u=-m[4];(0<u?u<=q&&(-m[5]||u)>=q:!!q)==!m[1]&&(document.documentElement.className+=" has-"+k)}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(l,d,k,t,p,m,q,u,n){return k("dgrid.OnDemandList",[l,d],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:u.defaultDelay,keepScrollPosition:!1,
rowHeight:22,postCreate:function(){this.inherited(arguments);var d=this;q(this.bodyNode,"scroll",u[this.pagingMethod](function(h){d._processScroll(h)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(d,h){function g(a){n(v,"!");if(a)throw e._refreshDeferred&&(e._refreshDeferred.reject(a),delete e._refreshDeferred),a;}var e=this,c=h&&h.container||this.contentNode,b={query:d,count:0,options:h},a,f=this.preload,
r,k={node:n(c,"div.dgrid-preload",{rowIndex:0}),count:0,query:d,next:b,options:h};k.node.style.height="0";b.node=a=n(c,"div.dgrid-preload");b.previous=k;a.rowIndex=this.minRowsPerPage;f?((b.next=f.next)&&a.offsetTop>=f.node.offsetTop?b.previous=f:(b.next=f,b.previous=f.previous),b.previous.next=b,b.next.previous=b):this.preload=b;var v=n(a,"-div.dgrid-loading");n(v,"div.dgrid-below").innerHTML=this.loadingMessage;h=t.mixin(this.get("queryOptions"),h,{start:0,count:this.minRowsPerPage},"level"in d?
{queryLevel:d.level}:null);this._trackError(function(){return r=d(h)});if("undefined"===typeof r)g();else return p.when(e.renderArray(r,a,h),function(c){return p.when("undefined"===typeof r.total?r.length:r.total,function(f){var d=c.length,g=a.parentNode,k=e.noDataNode;n(v,"!");"queryLevel"in h||(e._total=f);0===f&&g&&(k&&(n(k,"!"),delete e.noDataNode),e.noDataNode=k=n("div.dgrid-no-data"),g.insertBefore(k,e._getFirstRowSibling(g)),k.innerHTML=e.noDataMessage);for(k=g=0;k<d;k++)g+=e._calcRowHeight(c[k]);
d&&g&&(e.rowHeight=g/d);g=e.rowHeight*e.bufferRows;g>e.farOffRemoval&&(e.farOffRemoval=g);f-=d;b.count=f;a.rowIndex=d;f?a.style.height=Math.min(f*e.rowHeight,e.maxEmptySpace)+"px":(a.style.display="none",h.count++);e._previousScrollPosition&&(e.scrollTo(e._previousScrollPosition),delete e._previousScrollPosition);e._processScroll();e._refreshDeferred&&(e._refreshDeferred.resolve(r),delete e._refreshDeferred);return c},g)},g),r},refresh:function(d){var h=this,g=d&&d.keepScrollPosition,e;"undefined"===
typeof g&&(g=this.keepScrollPosition);g&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return g=this._refreshDeferred=new p,e=h.renderQuery(function(c){return h.store.query(h.query,c)}),"undefined"===typeof e&&g.reject(),g.then(function(c){h._refreshTimeout=setTimeout(function(){q.emit(h.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:h,results:c});h._refreshTimeout=null},0);delete h._refreshDeferred;return c},function(c){delete h._refreshDeferred;
throw c;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(d){return d.lastChild},_calcRowHeight:function(d){var h=d.nextSibling;return h&&!/\bdgrid-preload\b/.test(h.className)?h.offsetTop-d.offsetTop:d.offsetHeight},lastScrollTop:0,_processScroll:function(d){function h(a,b,f,e){var d=c.farOffRemoval,h=a.node;if(b>2*d){for(var r,k=h[f],w=0,l=0,m=[];r=k;){var y=c._calcRowHeight(r);if(w+y+d>b||0>k.className.indexOf("dgrid-row")&&0>k.className.indexOf("dgrid-loading"))break;
k=r[f];w+=y;l+=r.count||1;c.removeRow(r,!0);m.push(r)}a.count+=l;e?(h.rowIndex-=l,g(a)):h.style.height=h.offsetHeight+w+"px";var v=n("div",m);setTimeout(function(){n(v,"!")},1)}}function g(a,b){a.node.style.height=Math.min(a.count*c.rowHeight,b?Infinity:c.maxEmptySpace)+"px"}function e(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var c=this,b=c.bodyNode;d=d&&d.scrollTop||this.getScrollPosition().y;var b=b.offsetHeight+d,a,f,r=c.preload,k=c.lastScrollTop,l=c.bufferRows*c.rowHeight,
m=l-c.rowHeight,v,q,u,y=!0;for(c.lastScrollTop=d;r&&!r.node.offsetWidth;)r=r.previous;for(;r&&r!=a;){a=c.preload;c.preload=r;f=r.node;var A=f.offsetTop;if(b+1+m<A)r=e(r,y=!1);else if(d-1-m>A+f.offsetHeight)r=e(r,y=!0);else{var C=((f.rowIndex?d-l:b)-A)/c.rowHeight,A=(b-d+2*l)/c.rowHeight,A=A+Math.min(Math.abs(Math.max(Math.min((d-k)*c.rowHeight,c.maxRowsPerPage/2),c.maxRowsPerPage/-2)),10);0==f.rowIndex&&(C-=A);C=Math.max(C,0);10>C&&0<C&&A+C<c.maxRowsPerPage&&(A+=Math.max(0,C),C=0);A=Math.min(Math.max(A,
c.minRowsPerPage),c.maxRowsPerPage,r.count);if(0==A)r=e(r,y);else{var A=Math.ceil(A),C=Math.min(Math.floor(C),r.count-A),F=t.mixin(c.get("queryOptions"),r.options);r.count-=A;var G=f,J,L=c.queryRowsOverlap,K=(0<f.rowIndex||f.offsetTop>d)&&r;if(K){var M=r.previous;M&&(h(M,d-(M.node.offsetTop+M.node.offsetHeight),"nextSibling"),0<C&&M.node==f.previousSibling?(C=Math.min(r.count,C),r.previous.count+=C,g(r.previous,!0),f.rowIndex+=C,L=0):A+=C,r.count-=C);F.start=f.rowIndex-L;F.count=Math.min(A+L,c.maxRowsPerPage);
f.rowIndex=F.start+F.count}else r.next&&(h(r.next,r.next.node.offsetTop-b,"previousSibling",!0),G=f.nextSibling,G==r.next.node?(r.next.count+=r.count-C,r.next.node.rowIndex=C+A,g(r.next),r.count=C,L=0):J=!0),F.start=r.count,F.count=Math.min(A+L,c.maxRowsPerPage);J&&G&&G.offsetWidth&&(J=G.offsetTop);g(r);"level"in r.query&&(F.queryLevel=r.query.level);if("queryLevel"in F||!(F.start>c._total||0>F.count)){f=n(G,"-div.dgrid-loading[style\x3dheight:"+A*c.rowHeight+"px]");n(f,"div.dgrid-"+(K?"below":"above")).innerHTML=
c.loadingMessage;f.count=A;var P=r.query(F);if(void 0===c._trackError(function(){return P})){n(f,"!");return}(function(a,b,f,e){u=p.when(c.renderArray(e,a,F),function(d){q=e;G=a.nextSibling;n(a,"!");if(f&&G&&G.offsetWidth){var h=c.getScrollPosition();c.scrollTo({x:h.x,y:h.y+G.offsetTop-f,preserveMomentum:!0})}p.when(e.total||e.length,function(a){"queryLevel"in F||(c._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&F.count++,g(b))});c._processScroll();return d},function(b){n(a,"!");throw b;})}).call(this,
f,K,J,P);r=r.previous}}}}u&&(v=this._refreshDeferred)&&(delete this._refreshDeferred,p.when(u,function(){v.resolve(q)}))},removeRow:function(d,h){if(d){var g=d.previousSibling,e=d.nextSibling,c;if(c=g)c=g.observerIndex,c=null!=c?c:g.previousObserverIndex;g=c;if(c=e)c=e.observerIndex,c=null!=c?c:e.nextObserverIndex;e=d.observerIndex;d.observerIndex=void 0;h&&(d.nextObserverIndex=c,d.previousObserverIndex=g);if(this.cleanEmptyObservers&&-1<e&&e!==g&&e!==c&&(g=this.observers,c=g[e])){if(!h)for(var b=
c.rows,a=0;a<b.length;a++)if(b[a]!=d&&m.isDescendant(b[a],this.domNode))return this.inherited(arguments);c.cancel();this._numObservers--;g[e]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(l,d,k,t,p,m,q){function u(d){return d}function n(d){if("object"!==typeof d)d=Error(d);else if("cancel"===d.dojoType)return;d.grid=this;p.emit(this.domNode,
"dgrid-error",{grid:this,error:d,cancelable:!0,bubbles:!0})&&console.error(d)}return d("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};m.before(this,"configStructure",k.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);
this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(d){d.set&&(this._columnsWithSet[d.field]=d);this.inherited(arguments)},_updateNotifyHandle:function(d){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);d&&"function"===typeof d.notify&&this.shouldObserveStore&&(this._notifyHandle=m.after(d,"notify",k.hitch(this,"_onNotify"),!0),(d=this.get("sort"))&&d.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},
_setStore:function(d,h,g){this._updateNotifyHandle(d);this.store=d;this.dirty={};this.set("query",h,g)},_setQuery:function(d,h){var g=h&&h.sort;this.query=void 0!==d?d:this.query;this.queryOptions=h||this.queryOptions;this._started&&(g?this.set("sort",g):this.refresh())},setStore:function(d,h,g){l.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",d,h,g)},setQuery:function(d,h){l.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",
d,h)},_getQueryOptions:function(){var d=k.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)d.sort=this._sort;return d},_getQuery:function(){var d=this.query;return"object"==typeof d&&null!=d?k.delegate(d,{}):d},_setSort:function(d,h){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(d,h){this.inherited(arguments);d&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var d=this.inherited(arguments);
this.store||(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return d},renderArray:function(){var d=this,h=this.inherited(arguments);this.store||t.when(h,function(g){g.length&&d.noDataNode&&q(d.noDataNode,"!")});return h},insertRow:function(d,h,g,e,c){var b=this.store,a=this.dirty,b=b&&b.getIdentity(d),f;b in a&&!(b in this._updating)&&(f=a[b]);f&&(d=k.delegate(d,f));return this.inherited(arguments)},updateDirty:function(d,h,g){var e=this.dirty,
c=e[d];c||(c=e[d]={});c[h]=g},setDirty:function(d,h,g){l.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(d,h,g)},save:function(){function d(a,b){return function(c){var f=h._columnsWithSet,d=h._updating,r,k;if("function"===typeof c.set)c.set(b);else for(r in b)c[r]=b[r];for(r in f)k=f[r].set(c),void 0!==k&&(c[r]=k);d[a]=!0;return t.when(g.put(c),function(){delete e[a];delete d[a]})}}var h=this,g=this.store,e=this.dirty,c=new t,b=c.promise,a=function(a){var b;return h.getBeforePut||
!(b=h.row(a).data)?function(){return g.get(a)}:function(){return b}},f;for(f in e)var r=d(f,e[f]),b=b.then(a(f)).then(r);c.resolve();return b},revert:function(){this.dirty={};this.refresh()},_trackError:function(d){var h;"string"==typeof d&&(d=k.hitch(this,d));try{h=d()}catch(g){n.call(this,g)}return t.when(h,u,k.hitch(this,n))},newRow:function(){var d=this.inherited(arguments);this.noDataNode&&(q(this.noDataNode,"!"),delete this.noDataNode);return d},removeRow:function(d,h){var g={element:d};!h&&
this.noDataMessage&&this.up(g).element===d&&this.down(g).element===d&&(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(l,d,k,t,p,m,q,u,n){function v(a,b){b=
a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function h(a,b){var c=a.bodyNode,f=b?"text":21>p("ff")?"-moz-none":"none";e&&"msUserSelect"!==e?c.style[e]=f:p("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=t(c,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==
b&&a.preventDefault()}):(v(c,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=m.after(a,"renderRow",function(a){v(a,!0);return a})}p.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});p.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});p.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;
var f="userSelect";do if("undefined"!==typeof a[f])return f;while(c--&&(f=b[c]+"UserSelect"));return!1});p.add("dom-selectstart","undefined"!==typeof document.onselectstart);var g=p("mac")?"metaKey":"ctrlKey",e=p("css-user-select"),c=(q=p("pointer"))&&"MS"===q.slice(0,2),b=q?q+(c?"Down":"down"):"mousedown",a=q?q+(c?"Up":"up"):"mouseup";"WebkitUserSelect"===e&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(e=!1);return d("dgrid.Selection",null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",
selectionEvents:b+","+a+",dgrid-cellfocusin",selectionTouchEvents:p("touch")?u.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&
this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){l.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",
a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?h(this,a):h(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(c,e){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(e))&&("dgrid-cellfocusin"!==c.type||"mousedown"!==c.parentType)&&(c.type!==a||e==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=c;if(!c.keyCode||!c.ctrlKey||32==c.keyCode)if(!c.shiftKey&&c.type===b&&this.isSelected(e))this._waitForMouseUp=e;else this[this._selectionHandlerName](c,
e);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[g];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,f=a.keyCode?a.ctrlKey:a[g],e;a.shiftKey||(e=f?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[g])||
this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,c=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};p("touch")&&!p("pointer")&&this.selectionTouchEvents?(t(c,u.selector(e,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),t(c,t.selector(e,this.selectionEvents),function(c){b._ignoreMouseSelect!==
this?b._handleSelect(c,this):c.type===a&&(b._ignoreMouseSelect=null)})):t(c,t.selector(e,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a[g]&&65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className)&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&m.after(this,"_setStore",function(){b._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,f){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[f](a,null,c)}var b=this,c=this.store,e,d;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(e=m.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),d=m.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){e.remove();d.remove()}):(e=m.before(this,"removeRow",function(a,b){b||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){e.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,f;f={bubbles:!0,grid:this};c&&(f.parentType=c.type);f[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];t.emit(this.contentNode,"dgrid-"+a,f)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,c){var f,e,d;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(f=this.selection,e=!!f[a.id],null===c&&(c=!e),d=a.element,c||this.allSelected?f[a.id]=c:delete this.selection[a.id],d&&(c?n(d,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):n(d,"!dgrid-selected!ui-state-active")),c!==e&&d&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(f=this._determineSelectionDirection(d,
b),f||(b=document.getElementById(b.id),f=this._determineSelectionDirection(d,b));a.element!=b&&(a=this[f](a));)this._select(a,null,c)}else this._lastSelected=d,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:p("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);k.when(b,function(b){var c=a.selection,
f,e,d;for(f=0;f<b.length;f++)e=a.row(b[f]),(d=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,d);a._fireSelectionEvents()});return b}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(l,d,k,t,p,m){var q,u,n=d("ie"),v=n&&d("quirks"),h=8>n||v?"htmlFor":"for";return l("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,
i18nColumnHider:m,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var d=this.subRows,e=!0,c,b,a,f;delete this._columnHiderFirstCheckbox;a=0;for(c=d.length;a<c;a++)for(f=0,b=d[a].length;f<b;f++)this._renderHiderMenuEntry(d[a][f]),e&&(e=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[d[a][f].id])},_renderHiderMenuEntry:function(d){var e=d.id,c=t.escapeCssIdentifier(e,"-"),b,a;d.hidden&&(d.hidden=!1,this._hideColumn(e),d.hidden=
!0);d.unhidable||(b=p("div.dgrid-hider-menu-row"),a=this.domNode.id+"-hider-menu-check-"+c,e=this._columnHiderCheckboxes[e]=p(b,"input.dgrid-hider-menu-check.hider-menu-check-"+c+"[type\x3dcheckbox]"),e.id=a,p(b,"label.dgrid-hider-menu-label.hider-menu-label-"+c+"["+h+"\x3d"+a+"]",d.label||d.field||""),p(this.hiderMenuNode,b),d.hidden||(e.checked=!0))},renderHeader:function(){function d(a){a.stopPropagation()}var e=this,c=this.hiderMenuNode,b=this.hiderToggleNode,a;this.inherited(arguments);if(c){for(a in this._columnHiderRules)this._columnHiderRules[a].remove();
c.innerHTML=""}else b=this.hiderToggleNode=p(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(k(b,"click",function(a){e._toggleColumnHiderMenu(a)})),c=this.hiderMenuNode=p("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),c.id=this.id+"-hider-menu",this._listeners.push(k(c,"keyup",function(a){27===(a.charCode||a.keyCode)&&(e._toggleColumnHiderMenu(a),b.focus())})),
c.style.display="none",p(this.domNode,c),this._listeners.push(k(c,".dgrid-hider-menu-check:"+(9>n||v?"click":"change"),function(a){e._updateColumnHiddenState(a.target.id.substr(e.id.length+18),!a.target.checked)})),this._listeners.push(k(c,"mousedown",d),k(b,"mousedown",d)),u||(u=k.pausable(document,"mousedown",function(a){q&&q._toggleColumnHiderMenu(a)}),u.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var d in this._columnHiderRules)this._columnHiderRules[d].remove()},left:function(d,e){return this.right(d,-e)},right:function(d,e){d.element||(d=this.cell(d));for(var c=this.inherited(arguments),b=d;c.column.hidden;){c=this.inherited(arguments,[c,0<e?1:-1]);if(b.element===c.element)return d;b=c}return c},isColumnHidden:function(d){return!!this._columnHiderRules[d]},_toggleColumnHiderMenu:function(){var d=this._hiderMenuOpened,e=this.hiderMenuNode,c=this.domNode,b;e.style.display=d?"none":"";
d?e.style.height="":(e.offsetHeight>c.offsetHeight-12&&(e.style.height=c.offsetHeight-12+"px"),(b=this._columnHiderFirstCheckbox)&&b.focus());u[d?"pause":"resume"]();q=d?null:this;this._hiderMenuOpened=!d},_hideColumn:function(g){var e=this,c="#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",b;this._columnHiderRules[g]||(this._columnHiderRules[g]=t.addCssRule(c+t.escapeCssIdentifier(g,"-"),"display: none;"),8!==d("ie")&&10!==d("ie")||d("quirks")||(b=t.addCssRule(".dgrid-row-table","display: inline-table;"),
window.setTimeout(function(){b.remove();e.resize()},0)))},_showColumn:function(d){this._columnHiderRules[d]&&(this._columnHiderRules[d].remove(),delete this._columnHiderRules[d])},_updateColumnHiddenState:function(d,e){this[e?"_hideColumn":"_showColumn"](d);this.columns[d].hidden=e;k.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[d],hidden:e,bubbles:!0});this.resize()},toggleColumnHiddenState:function(d,e){"undefined"===typeof e&&(e=!this._columnHiderRules[d]);this._updateColumnHiddenState(d,
e);this._columnHiderCheckboxes[d].checked=!e}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(l,d,k,t,p,m,q,u,n){function v(b){for(var a=b.length,c=a,d=b[0].length,e=Array(a);a--;)e[a]=Array(d);for(var g={},a=0;a<c;a++)for(var h=e[a],k=b[a],l=0,m=0;l<d;l++){var y=k[m],n;if("undefined"==typeof h[l]){h[l]=
y.id;if(y.rowSpan&&1<y.rowSpan){n=e;for(var q=y.rowSpan,p=a,u=l,t=y.id,v=1;v<q;v++)n[p+v][u]=t}if(0<a&&y.colSpan&&1<y.colSpan)for(n=1;n<y.colSpan;n++)if(h[++l]=y.id,y.rowSpan&&1<y.rowSpan)for(var q=e,p=y.rowSpan,u=a,t=l,v=y.id,K=1;K<p;K++)q[u+K][t]=v;g[y.id]=b[0][l].id;m++}}return g}function h(b,a,c,e,g){if(!(0>=c)){var f=b.columns[a],h;if(f&&(h={grid:b,columnId:a,width:c,bubbles:!0,cancelable:!0},e&&(h.parentType=e),!b._resizedColumns||d.emit(b.headerNode,"dgrid-columnresize",h)))return"auto"===
c?delete f.width:(f.width=c,c+="px"),(e=b._columnSizes[a])?e.set("width",c):e=u.addCssRule("#"+u.escapeCssIdentifier(b.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(a,"-"),"width: "+c+";"),b._columnSizes[a]=e,!1!==g&&b.resize(),!0}}var g,e=0,c={create:function(){g=n("div.dgrid-column-resizer")},destroy:function(){n(g,"!");g=null},show:function(b){b=m.position(b.domNode,!0);g.style.top=b.y+"px";g.style.height=b.h+"px";n(document.body,g)},move:function(b){g.style.left=b+"px"},hide:function(){g.parentNode.removeChild(g)}};
return l("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);e++||c.create()},destroy:function(){this.inherited(arguments);for(var b in this._columnSizes)this._columnSizes[b].remove();--e||c.destroy()},resizeColumnWidth:function(b,a){return h(this,b,a)},configStructure:function(){var b=this._oldColumnSizes=t.mixin({},this._columnSizes),a;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(a in b)a in this._columnSizes||b[a].remove();delete this._oldColumnSizes},_configColumn:function(b){this.inherited(arguments);var a=b.id,c;"width"in b&&((c=this._oldColumnSizes[a])?c.set("width",b.width+"px"):c=u.addCssRule("#"+u.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(a,"-"),"width: "+b.width+"px;"),this._columnSizes[a]=c)},renderHeader:function(){this.inherited(arguments);var b=this,a;if(this.columnSets&&this.columnSets.length)for(var c=this.columnSets.length;c--;)a=
t.mixin(a||{},v(this.columnSets[c]));else this.subRows&&1<this.subRows.length&&(a=v(this.subRows));for(var c=k(".dgrid-cell",b.headerNode),e=c.length;e--;){var g=c[e],h=g.columnId,l=b.columns[h],m=g.childNodes;if(l&&!1!==l.resizable){l=n("div.dgrid-resize-header-container");for(g.contents=l;0<m.length;)n(l,m[0]);n(g,l,"div.dgrid-resize-handle.resizeNode-"+u.escapeCssIdentifier(h,"-")).columnId=a&&a[h]||h}}b.mouseMoveListen||(d(b.headerNode,".dgrid-resize-handle:mousedown"+(q("touch")?",.dgrid-resize-handle:touchstart":
""),function(a){b._resizeMouseDown(a,this);b.mouseMoveListen.resume();b.mouseUpListen.resume()}),b._listeners.push(b.mouseMoveListen=d.pausable(document,"mousemove"+(q("touch")?",touchmove":""),u.throttleDelayed(function(a){b._updateResizerPosition(a)}))),b._listeners.push(b.mouseUpListen=d.pausable(document,"mouseup"+(q("touch")?",touchend":""),function(a){b._resizeMouseUp(a);b.mouseMoveListen.pause();b.mouseUpListen.pause()})),b.mouseMoveListen.pause(),b.mouseUpListen.pause())},_resizeMouseDown:function(b,
a){b.preventDefault();p.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(b);this._targetCell=k(".dgrid-column-"+u.escapeCssIdentifier(a.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(b);c.show(this)},_resizeMouseUp:function(b){var a=this._columnSizes,e,d,g;this.adjustLastColumn&&(g=this.headerNode.clientWidth-1);this._resizedColumns||(e=k(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?e=e.filter(function(b){return"0"==b.columnId.split("-")[0]&&
!(b.columnId in a)}):this.subRows&&1<this.subRows.length&&(e=e.filter(function(b){return"0"==b.columnId.charAt(0)&&!(b.columnId in a)})),d=e.map(function(a){return a.offsetWidth}),e.forEach(function(a,b){h(this,a.columnId,d[b],null,!1)},this),this._resizedColumns=!0);p.setSelectable(this.domNode,!0);e=this._targetCell;var l=this._getResizeMouseLocation(b)-this._startX,m=e.offsetWidth+l,n=this._getResizedColumnWidths(),q=n.totalWidth,n=n.lastColId,t=k(".dgrid-column-"+u.escapeCssIdentifier(n,"-"),
this.headerNode)[0].offsetWidth;m<this.minWidth&&(m=this.minWidth);h(this,e.columnId,m,b.type)&&e.columnId!=n&&this.adjustLastColumn&&(q+l<g?h(this,n,"auto",b.type):t-l<=this.minWidth&&h(this,n,this.minWidth,b.type));c.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(b){if(this._targetCell){b=this._getResizeMouseLocation(b);var a=this._targetCell.offsetWidth,e=b;a+(b-this._startX)<this.minWidth&&(e=this._startX-(a-this.minWidth));c.move(e)}},_getResizeMouseLocation:function(b){var a=
0;b.pageX?a=b.pageX:b.clientX&&(a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return a},_getResizedColumnWidths:function(){var b=0,a=k((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=a.length;if(!c)return{};for(var e=a[c-1].columnId;c--;)b+=a[c].offsetWidth;return{totalWidth:b,lastColId:e}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(l,d,k,t,p,m,q){function u(d,e){var c=e[2];d=d[c?"columnSets":"subRows"][e[1]];return c?d[e[2]]:d}function n(d,e,c){e[2]?d.columnSets[e[1]][e[2]]=c:d.subRows[e[1]]=c}function v(d,e){return e.slice(("dgrid-"+d+"-").length)}var h=/(\d+)(?:-(\d+))?$/;l=d(m,{copyState:function(){return!1},checkAcceptance:function(d,e){return d==this},_legalMouseDown:function(d){return-1<d.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(d){var e=this.grid,c=
h.exec(v(e.id,d[0].getAttribute("dndType"))),b=c[2]?"columnSets":"subRows",a=u(e,c),f=e.columns;this.inherited(arguments);c&&setTimeout(function(){var g=k.map(d[0].parentNode.childNodes,function(a){return f[a.columnId]});n(e,c,g);g={grid:e,subRow:g,column:f[d[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};g[b]=e[b];t.emit(e.domNode,"dgrid-columnreorder",g)?e.set(b,e[b]):(n(e,c,a),e.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});d=d("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:l,_initSubRowDnd:function(d,e){var c,b,a,f;b=0;for(a=d.length;b<a;b++)f=d[b],!1!==f.reorderable&&(f=f.headerNode,"TH"!=f.tagName&&(f=f.parentNode),q(f,".dojoDndItem[dndType\x3d"+e+"]"),c||(c=f.parentNode));c&&this._columnDndSources.push(new this.columnDndConstructor(c,{horizontal:!0,grid:this}))},renderHeader:function(){var d="dgrid-"+this.id+"-",e,c;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(c=0,e=this.columnSets.length;c<e;c++)k.forEach(this.columnSets[c],
function(b,a){this._initSubRowDnd(b,d+c+"-"+a)},this);else k.forEach(this.subRows,function(b,a){this._initSubRowDnd(b,d+a)},this)},_destroyColumns:function(){this._columnDndSources&&k.forEach(this._columnDndSources,function(d){d.destroy()});this.inherited(arguments)}});d.ColumnDndSource=l;return d})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(l,
d,k,t,p,m,q,u,n,v,h,g){k.isAsync||u(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var e=d("dojo.dnd.Source",h,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(c,b){t.mixin(this,t.mixin({},b));c=this.accept;if(c.length)for(this.accept={},b=0;b<c.length;++b)this.accept[c[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=
this._lastX=0;this.sourceState="";this.isSource&&p.add(this.node,"dojoDndSource");this.targetState="";this.accept&&p.add(this.node,"dojoDndTarget");this.horizontal&&p.add(this.node,"dojoDndHorizontal");this.topics=[n.subscribe("/dnd/source/over",t.hitch(this,"onDndSourceOver")),n.subscribe("/dnd/start",t.hitch(this,"onDndStart")),n.subscribe("/dnd/drop",t.hitch(this,"onDndDrop")),n.subscribe("/dnd/cancel",t.hitch(this,"onDndCancel"))]},checkAcceptance:function(c,b){if(this==c)return!this.copyOnly||
this.selfAccept;for(var a=0;a<b.length;++a){for(var d=c.getItem(b[a].id).type,e=!1,g=0;g<d.length;++g)if(d[g]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(c,b){if(c)return!0;2>arguments.length&&(b=this==g.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){e.superclass.destroy.call(this);l.forEach(this.topics,function(c){c.remove()});this.targetAnchor=null},onMouseMove:function(c){if(!this.isDragging||"Disabled"!=
this.targetState){e.superclass.onMouseMove.call(this,c);var b=g.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(c.pageX-this._lastX)>this.delay||Math.abs(c.pageY-this._lastY)>this.delay)){var a=this.getSelectedNodes();a.length&&b.startDrag(this,a,this.copyState(v.getCopyKeyState(c),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=m.position(this.current,!0)),a=this.horizontal?c.pageX-this.targetBox.x<this.targetBox.w/
2==m.isBodyLtr(this.current.ownerDocument):c.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),b.canDrop(!this.current||b.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(c){this.mouseDown||!this._legalMouseDown(c)||this.skipForm&&v.isFormElement(c)||(this.mouseDown=!0,this._lastX=c.pageX,this._lastY=c.pageY,e.superclass.onMouseDown.call(this,c))},onMouseUp:function(c){this.mouseDown&&(this.mouseDown=
!1,e.superclass.onMouseUp.call(this,c))},onDndSourceOver:function(c){this!==c?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(c=g.manager(),c.canDrop("Disabled"!=this.targetState&&(!this.current||c.source!=this||!(this.current.id in this.selection))))},onDndStart:function(c,b,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==c?a?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(c,b);this._changeState("Target",b?"":"Disabled");
this==c&&g.manager().overSource(this);this.isDragging=!0},onDndDrop:function(c,b,a,d){if(this==d)this.onDrop(c,b,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(c,b,a){if(this!=c)this.onDropExternal(c,b,a);else this.onDropInternal(b,a)},onDropExternal:function(c,b,a){var d=this._normalizedCreator;this._normalizedCreator=
this.creator?function(a,b){return d.call(this,c.getItem(a.id).data,b)}:a?function(a){var b=c.getItem(a.id);a=a.cloneNode(!0);a.id=v.getUniqueId();return{node:a,data:b.data,type:b.type}}:function(a){var b=c.getItem(a.id);c.delItem(a.id);return{node:a,data:b.data,type:b.type}};this.selectNone();a||this.creator||c.selectNone();this.insertNodes(!0,b,this.before,this.current);!a&&this.creator&&c.deleteSelectedNodes();this._normalizedCreator=d},onDropInternal:function(c,b){var a=this._normalizedCreator;
if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(b,c){return a.call(this,this.getItem(b.id).data,c)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=v.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,c,this.before,this.current);this._normalizedCreator=a}},
onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){e.superclass.onOverEvent.call(this);g.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){e.superclass.onOutEvent.call(this);g.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(c){if(this.current!=this.targetAnchor||this.before!=c)this.targetAnchor&&this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=c,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(c){this._changeState("Source",c?"Copied":"Moved")},_legalMouseDown:function(c){if("touchstart"!=c.type&&!q.isLeft(c))return!1;
if(!this.withHandles)return!0;for(c=c.target;c&&c!==this.node;c=c.parentNode){if(p.contains(c,"dojoDndHandle"))return!0;if(p.contains(c,"dojoDndItem")||p.contains(c,"dojoDndIgnore"))break}return!1}});return e})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g){var e=d("dojo.dnd.Selector",g,{constructor:function(c,b){b||
(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(n(this.node,v.press,t.hitch(this,"onMouseDown")),n(this.node,v.release,t.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var c=new u,b=h._empty,a;for(a in this.selection)a in b||c.push(p.byId(a));return c},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(c,b){this._addItemClass(p.byId(b),
"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var c=h._empty,b;for(b in this.selection)if(!(b in c)){var a=p.byId(b);this.delItem(b);m.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(c,b){b=b||k.global;var a=this.selection,d=h._empty,e;for(e in a)e in d||c.call(b,this.getItem(e),e,this)},sync:function(){e.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var c=[],b=h._empty,
a;for(a in this.selection)a in b||this.getItem(a)||c.push(a);l.forEach(c,function(a){delete this.selection[a]},this);return this},insertNodes:function(c,b,a,d){var f=this._normalizedCreator;this._normalizedCreator=function(a,b){a=f.call(this,a,b);c?(this.anchor?this.anchor!=a.node&&(this._removeItemClass(a.node,"Anchor"),this._addItemClass(a.node,"Selected")):(this.anchor=a.node,this._removeItemClass(a.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[a.node.id]=1):(this._removeItemClass(a.node,
"Selected"),this._removeItemClass(a.node,"Anchor"));return a};e.superclass.insertNodes.call(this,b,a,d);this._normalizedCreator=f;return this},destroy:function(){e.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(c){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!h.getCopyKeyState(c)&&!c.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,q.isLeft(c)&&(c.stopPropagation(),c.preventDefault());else{if(!this.singular&&c.shiftKey){h.getCopyKeyState(c)||
this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,d;a<b.length&&(d=b[a],d!=this.anchor&&d!=this.current);++a);for(++a;a<b.length;++a){d=b[a];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==
this.current?h.getCopyKeyState(c)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):h.getCopyKeyState(c)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),
this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);c.stopPropagation();c.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},
onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=n(this.node,v.move,t.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var c=h._empty,b;for(b in this.selection)if(!(b in c)){var a=p.byId(b);a&&this._removeItemClass(a,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),
this.anchor=null);return this}});return e})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){d=d("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(b,a){this.node=m.byId(b);a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&m.byId(a.dropParent);
this.map={};this.current=null;this.containerState="";q.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[h(this.node,e.over,t.hitch(this,"onMouseOver")),h(this.node,e.out,t.hitch(this,"onMouseOut")),h(this.node,"dragstart",t.hitch(this,"onSelectStart")),h(this.node,"selectstart",t.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(b){return this.map[b]},setItem:function(b,a){this.map[b]=a},delItem:function(b){delete this.map[b]},forInItems:function(b,
a){a=a||k.global;var d=this.map,e=c._empty,g;for(g in d)g in e||b.call(a,d[g],g,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return g((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var b={};this.getAllNodes().forEach(function(a){if(a.id){var d=this.getItem(a.id);if(d){b[a.id]=d;return}}else a.id=c.getUniqueId();var d=a.getAttribute("dndType"),e=a.getAttribute("dndData");b[a.id]={data:e||a.innerHTML,type:d?d.split(/\s*,\s*/):["text"]}},this);
this.map=b;return this},insertNodes:function(b,a,c){this.parent.firstChild?a?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(a=0;a<b.length;++a)d=this._normalizedCreator(b[a]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(a=0;a<b.length;++a)d=this._normalizedCreator(b[a]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){l.forEach(this.events,function(b){b.remove()});
this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(b,a,c){b._skipStartup=!0;return new c(a,b)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var b=this.parent.getElementsByTagName("tbody");b&&b.length&&(this.parent=b[0])}this.defaultCreator=c._defaultCreator(this.parent);this.sync()},onMouseOver:function(b){for(var a=b.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(f){a=null}a||(this._changeState("Container",
"Over"),this.onOverEvent());a=this._getChildByEvent(b);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(b){for(b=b.relatedTarget;b;){if(b==this.node)return;try{b=b.parentNode}catch(a){b=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(b){this.withHandles||this.skipForm&&c.isFormElement(b)||(b.stopPropagation(),
b.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(b,a){var c="dojoDnd"+b;b=b.toLowerCase()+"State";q.replace(this.node,c+a,c+this[b]);this[b]=a},_addItemClass:function(b,a){q.add(b,"dojoDndItem"+a)},_removeItemClass:function(b,a){q.remove(b,"dojoDndItem"+a)},_getChildByEvent:function(b){if(b=b.target)for(var a=b.parentNode;a;b=a,a=b.parentNode)if((a==this.parent||this.allowNested)&&q.contains(b,"dojoDndItem"))return b;return null},_normalizedCreator:function(b,
a){b=(this.creator||this.defaultCreator).call(this,b,a);t.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=c.getUniqueId());q.add(b.node,"dojoDndItem");return b}});c._createNode=function(b){return b?function(a){return u.create(b,{innerHTML:a})}:c._createSpan};c._createTrTd=function(b){var a=u.create("tr");u.create("td",{innerHTML:b},a);return a};c._createSpan=function(b){return u.create("span",{innerHTML:b})};c._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};c._defaultCreator=function(b){b=
b.tagName.toLowerCase();var a="tbody"==b||"thead"==b?c._createTrTd:c._createNode(c._defaultCreatorNodes[b]);return function(b,d){var e=b&&t.isObject(b),f;e&&b.tagName&&b.nodeType&&b.getAttribute?(f=b.getAttribute("dndData")||b.innerHTML,e=(e=b.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"]):(f=e&&b.data?b.data:b,e=e&&b.type?b.type:["text"],b=("avatar"==d?c._createSpan:a)(String(f)));b.id||(b.id=c.getUniqueId());return{node:b,data:f,type:e}}};return d})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){var b=d("dojo.dnd.Manager",[m],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:q("touch")?4:16,OFFSET_Y:q("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());v.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=
!1,this.avatar.update(),v.publish("/dnd/source/over",null)):v.publish("/dnd/source/over",null)},startDrag:function(a,b,c){function d(a){a.preventDefault();a.stopPropagation()}e.autoScrollStart(t.doc);this.source=a;this.nodes=b;this.copy=!!c;this.avatar=this.makeAvatar();t.body().appendChild(this.avatar.node);v.publish("/dnd/start",a,b,this.copy);this.events=[n(t.doc,h.move,k.hitch(this,"onMouseMove")),n(t.doc,h.release,k.hitch(this,"onMouseUp")),n(t.doc,"keydown",k.hitch(this,"onKeyDown")),n(t.doc,
"keyup",k.hitch(this,"onKeyUp")),n(t.doc,"dragstart",d),n(t.body(),"selectstart",d)];a="dojoDnd"+(c?"Copy":"Move");p.add(t.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){p.remove(t.body(),["dojoDndCopy","dojoDndMove"]);l.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new c(this)},updateAvatar:function(){this.avatar.update()},
onMouseMove:function(a){var b=this.avatar;b&&(e.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(g.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));q("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=!!this.source.copyState(g.getCopyKeyState(a));v.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);v.publish("/dnd/drop",this.source,this.nodes,
b,this.target,a)}else v.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case u.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case u.ESCAPE:v.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==u.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();p.replace(t.body(),"dojoDnd"+
(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});g._manager=null;b.manager=g.manager=function(){g._manager||(g._manager=new b);return g._manager};return b})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(l,d,k,t,p,m,q,u){return l("dojo.dnd.Avatar",null,{constructor:function(d){this.manager=d;this.construct()},construct:function(){var d=m.create("table",{"class":"dojoDndAvatar",
style:{position:"absolute",zIndex:"1999",margin:"0px"}}),k=this.manager.source,h,g=m.create("tbody",null,d),e=m.create("tr",null,g),c=m.create("td",null,e),b=Math.min(5,this.manager.nodes.length),a=0;q("highcontrast")&&m.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},c);m.create("span",{innerHTML:k.generateText?this._generateText():""},c);for(t.set(e,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});a<b;++a)k.creator?h=k._normalizedCreator(k.getItem(this.manager.nodes[a].id).data,
"avatar").node:(h=this.manager.nodes[a].cloneNode(!0),"tr"==h.tagName.toLowerCase()&&(e=m.create("table"),m.create("tbody",null,e).appendChild(h),h=e)),h.id="",e=m.create("tr",null,g),c=m.create("td",null,e),c.appendChild(h),t.set(e,{"class":"dojoDndAvatarItem",style:{opacity:(9-a)/10}});this.node=d},destroy:function(){m.destroy(this.node);this.node=!1},update:function(){p.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(q("highcontrast")){var d=k.byId("a11yIcon"),l="+";this.manager.canDropFlag&&
!this.manager.copy?l="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(l="x"):l="o";d.innerHTML=l}u("tr.dojoDndAvatarHeader td span"+(q("highcontrast")?" span":""),this.node).forEach(function(d){d.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(l,d,k,t,p,m,q,u){k("dijit-legacy-requires")&&p(0,function(){l(["dijit/ToolbarSeparator"])});return d("dijit.Toolbar",[m,u,q],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(l,d,k,t,p,m,q){l=l(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var d=k.map(this.geometries1,function(d){return d.toJson()}),l=k.map(this.geometries2,function(d){return d.toJson()}),m={},h=this.geometries1;h&&0<h.length&&(m.geometries1=t.toJson({geometryType:q.getJsonType(h[0]),geometries:d}),d=this.geometries1[0].spatialReference,m.sr=d.wkid?d.wkid:t.toJson(d.toJson()));d=this.geometries2;return d&&
0<d.length&&(m.geometries2=t.toJson({geometryType:q.getJsonType(d[0]),geometries:l})),this.relation&&(m.relation=this.relation),this.relationParam&&(m.relationParam=this.relationParam),m}});return d.mixin(l,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"}),p("extend-esri")&&d.setObject("tasks.RelationParameters",l,m),l})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g){function e(c){var b=d.clone(c.attributes);(c=c.geometry)&&"point"===c.type&&("x"in b?b._x=c.x:b.x=c.x,"y"in b?b._y=c.y:b.y=c.y);return b}l.exportCSV=function(c,b,a){return l._createCSVStr(b,a).then(function(a){return l._download(c+".csv",a)})};l.exportCSVFromFeatureLayer=function(c,b,a){a=a||{};return l._getExportData(b,{datas:a.datas,objectIds:a.objectIds,fromClient:a.fromClient,withGeometry:a.withGeometry,outFields:a.outFields,filterExpression:a.filterExpression,
outSpatialReference:a.outSpatialReference,arcadeExpressions:a.arcadeExpressions}).then(function(d){return l._formattedData(b,d,{formatNumber:a.formatNumber,formatDate:a.formatDate,formatCodedValue:a.formatCodedValue,richText:{clearFormat:a.richTextFieldsToClear&&!!a.richTextFieldsToClear.length,fieldsToClear:a.richTextFieldsToClear||[]},popupInfo:a.popupInfo}).then(function(a){return l.exportCSV(c,a.datas,a.columns)})})};l.exportCSVByAttributes=function(c,b,a,e){e=d.mixin({},e);e.datas=a;return l.exportCSVFromFeatureLayer(c,
b,e)};l.exportCSVByGraphics=function(c,b,a,d){a=k.map(a,function(a){return a.attributes});return l.exportCSVByAttributes(c,b,a,d)};l._createCSVStr=function(c,b){var a=new m,d="",e=0,g=0,h="",l="";try{b=k.map(b,function(a){return"string"===typeof a?{name:a}:a});k.forEach(b,function(a){a=a.alias||a.name;-1<a.toString().indexOf(",")&&(a='"'+a+'"');d=d+h+a;h=","});for(var d=d+"\r\n",e=c.length,g=b.length,n=0;n<e;n++){for(var h="",q=0;q<g;q++)(l=c[n][b[q].name])||"number"===typeof l||(l=""),l&&/[",\r\n]/g.test(l)&&
(l='"'+l.replace(/(")/g,'""')+'"'),d=d+h+l,h=",";d+="\r\n"}a.resolve(d)}catch(E){console.error(E),a.resolve("")}return a};l._isIE11=function(){return 11===q.has("ie")};l._isEdge=function(){return q.has("edge")};l._getDownloadUrl=function(c){return window.Blob&&window.URL&&window.URL.createObjectURL?(c=new Blob(["\ufeff"+c],{type:"text/csv"}),URL.createObjectURL(c)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(c)};l._download=function(c,b){var a=new m;try{if(p("ie")&&10>p("ie")){var d=
window.top.open("about:blank","_blank");d.document.write("sep\x3d,\r\n"+b);d.document.close();d.document.execCommand("SaveAs",!0,c);d.close()}else if(10===p("ie")||l._isIE11()||l._isEdge()){var e=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(e,c)}else{var g=t.create("a",{href:l._getDownloadUrl(b),target:"_blank",download:c},document.body);if(p("safari")){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);g.dispatchEvent(h)}else g.click();t.destroy(g)}a.resolve()}catch(N){a.reject(N)}return a};
l._getExportData=function(c,b){var a=new m,f=null,g=[],h=b.datas,n=b.withGeometry,q=!!b.arcadeExpressions,f=b.outFields;f&&f.length||(f=c.fields);f=d.clone(f);if(n&&!(h&&0<h.length)){q?(g=k.filter(c.fields,function(a){return-1===a.name.indexOf("expression/")}),g=d.clone(g)):g=d.clone(f);var p="",p=-1!==f.indexOf("x")?"_x":"x";f.push({name:p,alias:p,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});p=-1!==f.indexOf("y")?"_y":"y";f.push({name:p,alias:p,format:{digitSeparator:!1,
places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?(q&&(h=l._getAttrsWithExpressionsBatch(h,b.arcadeExpressions)),a.resolve({data:h||[],outFields:f})):b.fromClient?(h=k.map(c.graphics,function(a){a=n?e(a):d.clone(a);return a=q?l._getAttrsWithExpressions(a,b.arcadeExpressions):a}),a.resolve({data:h||[],outFields:f})):l._getExportDataFromServer(c,g,b).then(function(c){q&&(c=l._getAttrsWithExpressionsBatch(c,b.arcadeExpressions));a.resolve({data:c||[],outFields:f})});return a};l._getExportDataFromServer=
function(c,b,a){var d=new m;if("esri.layers.FeatureLayer"!==c.declaredClass)return d.resolve([]),d;var g=new n(c.url),h=new v;h.where=a.filterExpression||c.getDefinitionExpression&&c.getDefinitionExpression()||"1\x3d1";0<b.length?(c=k.map(b,function(a){return a.name}),h.outFields=c):h.outFields=["*"];h.objectIds=a.objectIds;h.returnGeometry=a.withGeometry;h.outSR=a.spatialReference;g.execute(h,function(a){a=k.map(a.features,function(a){return e(a)});d.resolve(a)},function(a){console.error(a);d.resolve([])});
return d};l._formattedData=function(c,b,a){var d=new m,e=[],g=b.data;b=b.outFields;for(var h=0,n=g.length;h<n;h++){for(var q={},p=0;p<b.length;p++){var u=b[p];q[u.name]=l._getExportValue(g[h][u.name],u,c.objectIdField,c.typeIdField,g[h][c.typeIdField],c.types,a)}e.push(q)}c=k.map(b,function(a){return{alias:a.alias,name:a.name}});d.resolve({datas:e,columns:c});return d};l._getExportValue=function(c,b,a,d,e,g,h){function f(a){if(m&&u.isDefined(m.fieldInfos))for(var b=0,c=m.fieldInfos.length;b<c;b++){var d=
m.fieldInfos[b];if(d.fieldName===a)return d.format}return null}function l(a){for(var b=0,c=n.length;b<c;b++)if(n[b].fieldName===a)return!0;return!1}var m=h.popupInfo,n=h.richText.fieldsToClear,y=!!b.domain&&h.formatCodedValue,r="esriFieldTypeDate"===b.type&&h.formatDate,p=a&&b.name===a;d=d&&b.name===d;l="esriFieldTypeString"===b.type&&h.richText.clearFormat&&l(b.name);return r?q.fieldFormatter.getFormattedDate(c,f(b.name)):d?q.fieldFormatter.getTypeName(c,g):y?q.fieldFormatter.getCodedValue(b.domain,
c):l?c?(b=document.createElement("span"),b.innerHTML=c,b.textContent||b.innerText||""):c:y||r||p||d||l?c:(h=null,a&&g&&0<g.length&&(a=(a=k.filter(g,function(a){return a.id===e}))&&a[0])&&a.domains&&a.domains[b.name]&&a.domains[b.name].codedValues&&(h=q.fieldFormatter.getCodedValue(a.domains[b.name],c)),null!==h?h:c)};l._getAttrsWithExpressions=function(c,b){var a=d.getObject("expressionInfos",!1,b);b=d.getObject("layerDefinition",!1,b);var e=new h(null,null,c);return g.customExpr.getAttributesFromCustomArcadeExpr(a,
e,b)||c};l._getAttrsWithExpressionsBatch=function(c,b){var a=[];return a=k.map(c,function(a){return l._getAttrsWithExpressions(a,b)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),function(l,d,k,t,p,m,q,u,n,v){var h={readExprInfo:{}};h.readExprInfo.getArcadeProfilesByType=function(d,e,c){d={map:d,layer:e};return"render"===
c?h.readExprInfo._getArcadeRender(d):"label"===c?h.readExprInfo._getArcadeLabel(d):"infoTemplate"===c?h.readExprInfo._getArcadeInfoTemplate(d):h.readExprInfo._getAllArcade(d)};h.readExprInfo._getArcadeRender=function(d){return h.readExprInfo._lookupArcadeRender({layers:h.readExprInfo._checkPassInLayer(d)})};h.readExprInfo._getArcadeInfoTemplate=function(d){return h.readExprInfo._lookupArcadeInfoTemplate({layers:h.readExprInfo._checkPassInLayer(d)})};h.readExprInfo._getArcadeLabel=function(d){return h.readExprInfo._lookupArcadeLabel({layers:h.readExprInfo._checkPassInLayer(d)})};
h.readExprInfo._getAllArcade=function(d){var e=h.readExprInfo._getArcadeRender(d),c=h.readExprInfo._getArcadeInfoTemplate(d);d=h.readExprInfo._getArcadeLabel(d);return{render:e,infoTemplate:c,label:d}};h.readExprInfo._checkPassInLayer=function(d){var e=[];return e="undefined"!==typeof d?"undefined"!==typeof d.layer?null!==d.layer&&""!==d.layer?h.readExprInfo._getAllMapLayers(d):h.readExprInfo._getAllMapLayers():h.readExprInfo._getAllMapLayers():h.readExprInfo._getAllMapLayers()};h.readExprInfo._getAllMapLayers=
function(d){var e="",c=[],b=v.getInstance();d&&d.layer&&(e=d.layer.id);""!==e?(d=b.getNodeById(e))&&c.push(d._layerInfo.layerObject):b.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&c.push(a._layerInfo.layerObject):c.push(a._layerInfo.layerObject)});return c};h.readExprInfo._lookupArcadeRender=function(g){var e=[];0<g.layers.length&&l.forEach(g.layers,d.hitch(this,function(c){var b={};if("undefined"!==typeof c.renderer){var a=
c.renderer;"undefined"!==typeof a.valueExpression&&(b.layer=c.id,b.valueExpression=a.valueExpression,b.valueExpressionTitle=a.valueExpressionTitle,"undefined"!==typeof a.values&&(b.values=a.values),"undefined"!==typeof a.visualVariables&&(b.visualVariables=a.visualVariables));1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:c.id,valueExpression:null,valueExpressionTitle:null,values:null,visualVariables:null})}}));return e};h.readExprInfo._lookupArcadeInfoTemplate=function(g){var e=
[];0<g.layers.length&&l.forEach(g.layers,d.hitch(this,function(c){var b={};if("undefined"!==typeof c.infoTemplate)"undefined"!==typeof c.infoTemplate.info.expressionInfos&&0<c.infoTemplate.info.expressionInfos.length&&(b.layer=c.id,b.expressionInfos=c.infoTemplate.info.expressionInfos);else if("undefined"!==typeof c.infoTemplates)for(var a in c.infoTemplates)if(c.infoTemplates.hasOwnProperty(a)&&"undefined"!==typeof c.infoTemplates[a].infoTemplate.info.expressionInfos){var d=c.infoTemplates[a].infoTemplate;
0<d.info.expressionInfos.length&&(b.layer=c.id,b.expressionInfos=d.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:c.id,expressionInfos:null})}));return e};h.readExprInfo._lookupArcadeLabel=function(g){var e=[];0<g.layers.length&&l.forEach(g.layers,d.hitch(this,function(c){var b={};"undefined"!==typeof c.labelingInfo&&l.forEach(c.labelingInfo,d.hitch(this,function(a){"undefined"!==typeof a.name&&(b.layer=c.id,b.name=a.name,b.labelingInfo=a,b.expression=
a.labelExpressionInfo.expression)}));1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:c.id,name:null,labelingInfo:null,expression:null})}));return e};h.customExpr={};h.customExpr.getAttributesFromCustomArcadeExpr=function(d,e,c){d=h.InfoTemplate._parseArcadeExpressions(d);return h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(e,d,c)};h.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(d,e,c){var b=[],a;for(a in e)b.push(e[a]);e=h.InfoTemplate._parseArcadeExpressions(d);
d=h.InfoTemplate._getExprNamesArrayFromPopupExprInfos(d);d.relationships=null;d.parsedExpressions=e;var f=new k;h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(b,d,c).then(function(a){f.resolve(a)});return f};h.InfoTemplate={};h.InfoTemplate.getAttributesFromInfoTemplate=function(d,e,c){var b={fields:[]};e.layerObject&&e.layerObject.fields&&(b.fields=e.layerObject.fields);d=h.readExprInfo.getArcadeProfilesByType(d,e,"infoTemplate")[0].expressionInfos;if(!d)return c.attributes;d=h.InfoTemplate._parseArcadeExpressions(d);
return h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(c,d,b)};h.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(d,e,c){var b={fields:[]};e.layerObject&&e.layerObject.fields&&(b.fields=e.layerObject.fields);var a=[],f;for(f in c)a.push(c[f]);d=h.readExprInfo.getArcadeProfilesByType(d,e,"infoTemplate")[0].expressionInfos;var g=new k;if(!d)return g.resolve([]),g;c=h.InfoTemplate._parseArcadeExpressions(d);f=null;f=e.getPopupInfo().description;null!==f?(f=h.InfoTemplate._convertPopupDescToFieldNamesArray(f),
f.relationships=h.InfoTemplate._getRelationshipQueries(e)):(f=h.InfoTemplate._getExprNamesArrayFromPopupExprInfos(d),f.relationships=null);f.parsedExpressions=c;h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(a,f,b).then(function(a){g.resolve(a)});return g};h.InfoTemplate._getRelationshipQueries=function(d){var e=!1,c={},b=/\d+/,a;if(a=d.getPopupInfo().description.match(/\{relationships\/\d+\//gm))e=!0,l.forEach(a,function(a){var e=a.match(b)[0];c.hasOwnProperty(e)||(a=new u,a.outFields=["*"],
a.relationshipId=e,a.returnGeometry=!1,c[e]={operLayer:d,relatedQuery:a})});return e?c:null};h.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(d){var e=[],c;for(c in d)e.push("${expression/"+d[c].name+"}");return e};h.InfoTemplate._convertPopupDescToFieldNamesArray=function(d){d=h.InfoTemplate._convertEndParasToEOLs(d);d=h.InfoTemplate._convertBreaksToEOLs(d);d=h.InfoTemplate._sanitizeNoTags(d).trim();d=d.replace(/\{/gi,"${");d=d.replace(/\u00a0/gi," ");d=d.split("\n");return d=l.map(d,
function(d){return d.trim()})};h.InfoTemplate._sanitizeNoTags=function(d){var e;e=n.sanitizeHTML(d);d=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var c;do c=e,e=e.replace(d,"");while(e!==c);return e=e.replace(/</g,"\x26lt;")};h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(d,e,c){var b=new k,a=[],f=[],g=0;e.relationships?(l.forEach(d,function(a){h.InfoTemplate._objEach(e.relationships,
function(b,d){var g=new k,m=b.relatedQuery,n;f.push(g);n=a.attributes[b.operLayer.layerObject.objectIdField];m.objectIds=[n];b.operLayer.layerObject.queryRelatedFeatures(m,function(b){var f=[];b[n]&&b[n].features&&(b=b[n].features,l.forEach(b,function(b){var g=[],k,m,n;k=a.attributes;m="relationships/"+d+"/";h.InfoTemplate._objEach(b.attributes,function(a,b){n=m+b;k[n]=a});l.forEach(e,function(b){g.push(p.substitute(b,h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,e.parsedExpressions,
c),h.InfoTemplate._useEmptyStringForNull))});f.push(g)}));g.resolve(f)})})}),t(f).then(function(c){l.forEach(c,function(b){l.forEach(b,function(b){++g;a.push(b)})});console.log(g+" related address features found");b.resolve(a)})):(l.forEach(d,function(b){var d=[];l.forEach(e,function(a){d.push(p.substitute(a,h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,e.parsedExpressions,c),h.InfoTemplate._useEmptyStringForNull))});a.push(d)}),b.resolve(a));return b};h.InfoTemplate._parseArcadeExpressions=
function(d){var e;Array.isArray(d)&&0<d.length&&(e={},l.forEach(d,function(c){e[c.name]=m.parseScript(c.expression)}));return e};h.InfoTemplate._initArcadeContext=function(d,e){var c={vars:{}};c.vars.$feature=q.createFromGraphicLikeObject(d.geometry,d.attributes,e);return c};h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(g,e,c){var b,a;b=d.mixin({},g.attributes);if(e)for(a in g=h.InfoTemplate._initArcadeContext(g,c),e)c=m.executeScript(e[a],g),b["expression/"+a]=c?c.toString():
"";return b};h.InfoTemplate._convertEndParasToEOLs=function(d){var e=d;d=d.match(/<\/p>/gi);l.forEach(d,function(c){e=e.replace(c,"\n")});return e};h.InfoTemplate._convertBreaksToEOLs=function(d){var e=d;d=d.match(/<br\s*\/?>/gi);l.forEach(d,function(c){e=e.replace(c,"\n")});return e};h.InfoTemplate._useEmptyStringForNull=function(d){return d?d:""};h.InfoTemplate._objEach=function(d,e,c){for(var b in d)d.hasOwnProperty(b)&&e.call(c,d[b],b)};return h})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic".split(" "),
function(l,d,k,t,p,m,q,u,n,v,h,g,e,c){function b(a,b){if(!a||!a.length)return b||[];if(!b||!b.length)return a;for(var c=[],d=0,e=a.length;d<e;d++)for(var f=a[d],g=0,h=b.length;g<h;g++){var k=b[g];if(k.name===f.name){k.alias!==f.alias&&(f.alias=k.alias);c.push(f);break}}return c}m.readLayerInfosObj=function(a){return k.getInstance(a,a.itemInfo)};m.readLayerInfosFromMap=function(a,b,c){var e=new t;k.getInstance(a,a.itemInfo).then(l.hitch(this,function(a){var f=[];b?a.traversalLayerInfosOfWebmap(function(a){f.push(a)}):
a.traversal(function(a){f.push(a)});if(c){var g=[],h=a.getMapNotesLayerInfoArray();d.forEach(h,function(a){g.push(a.id);a.traversal(function(a){g.push(a.id)})});f=d.filter(f,function(a){return-1===g.indexOf(a.id)})}a=a.getTableInfoArray();f=f.concat(a);e.resolve(f)}),l.hitch(this,function(a){console.error(a);e.reject(a)}));return e.promise};m.generateColumnsFromFields=function(a,b,c,g,h,k,n,q){function f(a){if(y&&v.isDefined(y.fieldInfos))for(var b=0,c=y.fieldInfos.length;b<c;b++){var d=y.fieldInfos[b];
if(d.fieldName===a)return d.format}return null}var y=b.getPopupInfo(),p={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,filed:"selection-handle-column",sortable:!1,_cache:{sortable:!1,statistics:!1}}};d.forEach(c,l.hitch(m,function(c,y,r){y="field"+y;var u=!!c.domain,t="esriFieldTypeDate"===c.type,w=g&&c.name===g,A="esriFieldTypeDouble"===c.type||"esriFieldTypeSingle"===c.type||"esriFieldTypeInteger"===c.type||"esriFieldTypeSmallInteger"===c.type,C="esriFieldTypeString"===
c.type,F=0===c.name.indexOf("expression/"),x=c.alias||c.name,z;z=1===r.length?!1:a&&a[y]?a[y].hidden:c?!c.show&&v.isDefined(c.show):!1;p[y]={label:x,className:y,hidden:z,unhidable:1===r.length?!1:!c.show&&v.isDefined(c.show)&&c._pk,field:c.name,sortable:!1,_cache:{sortable:!!k,statistics:n&&!u&&A}};C?p[y].formatter=l.hitch(m,m.urlFormatter):t?p[y].formatter=l.hitch(m,m.dateFormatter,f(c.name)):A&&(p[y].formatter=l.hitch(m,m.numberFormatter,f(c.name)));u?p[y].get=l.hitch(m,function(a,b,c){return this.getCodeValue(a,
b.name,c)},q,c):w?p[y].get=l.hitch(m,function(a,b,c){return this.getTypeName(c[a.name],b)},c,h):F?(r=this.arcade.getExpressionInfosFromLayerInfo(b),u=e.getFeatureLayerDefinition(q),p[y]._cache.sortable=!1,p[y].get=l.hitch(m,function(a,b,c,d){return this.arcade.getAttributes(d,a,c)[b.name]||""},r,c,u)):u||t||w||F||(p[y].get=l.hitch(m,function(a,b,c,e,f){var g=null;c&&e&&0<e.length&&(e=(e=d.filter(e,l.hitch(m,function(a){return a.id===f[c]})))&&e[0]||null)&&e.domains&&e.domains[b.name]&&e.domains[b.name].codedValues&&
(g=this.getCodeValue(a,b.name,f));return(a=null!==g?g:f[b.name])||isFinite(a)?a:""},q,c,g,h))}));return p};m.getTypeName=function(a,b){return e.fieldFormatter.getTypeName(a,b)};m.getCodeValue=function(a,b,c){return(a=e.getDisplayValueForCodedValueOrSubtype(a,b,c))&&a.isCodedValueOrSubtype?a.displayValue||"":""};m.urlFormatter=function(a){return e.fieldFormatter.getFormattedUrl(a)};m.dateFormatter=function(a,b){return e.fieldFormatter.getFormattedDate(b,a)};m.numberFormatter=function(a,b){return e.fieldFormatter.getFormattedNumber(b,
a)};m.readLayerObjectsFromMap=function(a,b,c){var e=new t,f=[];this.readLayerInfosFromMap(a,b,c).then(l.hitch(this,function(a){d.forEach(a,l.hitch(this,function(a){f.push(a.getLayerObject())}));p(f).then(l.hitch(this,function(a){e.resolve(a)}),l.hitch(this,function(a){e.reject(a);console.error(a)}))}),l.hitch(this,function(a){e.reject(a)}));return e.promise};m.readSupportTableInfoFromLayerInfos=function(a){var b=new t,c=[];d.forEach(a,l.hitch(this,function(a){c.push(a.getSupportTableInfo())}));p(c).then(l.hitch(this,
function(c){c=l.clone(c);d.forEach(c,function(b,c){b.id=a[c].id});b.resolve(c)}),function(a){b.reject(a)});return b.promise};m.readConfigLayerInfosFromMap=function(a,b,c){var e=new t,f=[];this.readLayerInfosFromMap(a,b,c).then(l.hitch(this,function(a){var b=[];d.forEach(a,function(a){f.push(a.getSupportTableInfo())});p(f).then(l.hitch(this,function(c){d.forEach(c,l.hitch(this,function(c,d){c.isSupportedLayer&&(a[d].name=a[d].title,b.push(a[d]))}));e.resolve(b)}),l.hitch(this,function(a){e.reject(a)}))}),
l.hitch(this,function(a){e.reject(a)}));return e.promise};m.getConfigInfosFromLayerInfos=function(a){return d.map(a,function(a){return m.getConfigInfoFromLayerInfo(a)})};m.getConfigInfoFromLayerInfo=function(a){var c={};c.name=a.name||a.title;c.id=a.id;c.show=a.isShowInMap();c.layer={url:a.getUrl()};var e=a.getPopupInfo();e&&!e.description&&(c.layer.fields=d.map(e.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),a=l.getObject("layerObject.fields",!1,a),
c.layer.fields=b(c.layer.fields,a),d.some(c.layer.fields,function(a){return a.show})||(c.layer.fields&&0<c.layer.fields.length?c.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return c};m.generateCacheStore=function(a,b,c,d,e){a=new h({layer:a,objectIds:a._objectIds||null,totalCount:b,batchCount:c,where:d||"1\x3d1",spatialFilter:e});b=new n;return new u(a,b,{})};m.generateMemoryStore=function(a,b){return new q(new n({data:a||[],idProperty:b}))};m.merge=function(a,b,c,e){for(var f=
d.map(b,function(a){return a[c]}),g=0,h=a.length;g<h;g++){var k=f.indexOf(a[g][c]);-1<k&&e(a[g],b[k])}};m.syncOrderWith=function(a,b,c){function e(a,b){return d.map(a,function(a){return a[b]})}if(!l.isArray(b)||!c)return a;for(var f=e(a,c),g=[],h=0,k=b.length;h<k;h++){var m=f.indexOf(b[h][c]);-1<m&&(g=g.concat(a.splice(m,1)),f=e(a,c))}return g.concat(a)};m.arcade={};m.arcade.getExpressionInfosFromLayer=function(a,b){a=g.readExprInfo.getArcadeProfilesByType(a,b,"infoTemplate");return 0<a.length&&a[0].expressionInfos?
a[0].expressionInfos:[]};m.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};m.arcade.getAttributes=function(a,b,d){var e=new c(null,null,a);return g.customExpr.getAttributesFromCustomArcadeExpr(b,e,d)||a};m.arcade.appendArcadeExpressionsToFields=function(a,b){b=m.arcade.getExpressionInfosFromLayerInfo(b);if(0<b.length){var c=/^expression\//;d.forEach(b,function(b){d.some(a,function(a){if(c.test(a.name))return a=a.name.substr(11),b.name===a})||
a.push({name:"expression/"+b.name,alias:b.title,show:!0})})}return a};m.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")}})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(l,d,k,t){l=function(l){function m(d,g){var e=l[d];e&&(l[d]=function(c){var b;"put"===d&&(b=l.getIdentity(c));if(v)return e.apply(this,arguments);v=!0;try{var a=e.apply(this,arguments);k(a,function(a){g("object"==
typeof a&&a||c,b)});return a}finally{v=!1}})}var q=[],p=0;l=d.delegate(l);l.notify=function(d,g){p++;for(var e=q.slice(),c=0,b=e.length;c<b;c++)e[c](d,g)};var n=l.query;l.query=function(h,g){g=g||{};var e=n.apply(this,arguments);if(e&&e.forEach){var c=d.mixin({},g);delete c.start;delete c.count;var b=l.queryEngine&&l.queryEngine(h,c),a=p,f=[],m;e.observe=function(c,d){1==f.push(c)&&q.push(m=function(c,h){k(e,function(e){var k=e.length!=g.count,m,n;if(++a!=p)throw Error("Query is out of date, you must observe() the query prior to any data modifications");
var q,u=-1,r=-1;if(void 0!==h){var v=[].concat(e);b&&!c&&(v=b(e));m=0;for(n=e.length;m<n;m++){var w=e[m];if(l.getIdentity(w)==h&&!(0>v.indexOf(w))){q=w;u=m;!b&&c||e.splice(m,1);break}}}b?c&&(b.matches?b.matches(c):b([c]).length)&&(m=-1<u?u:e.length,e.splice(m,0,c),r=t.indexOf(b(e),c),e.splice(m,1),g.start&&0==r||!k&&r==e.length?r=-1:e.splice(r,0,c)):c&&(void 0!==h?r=u:g.start||(r=l.defaultIndex||0,e.splice(r,0,c)));if((-1<u||-1<r)&&(d||!b||u!=r))for(k=f.slice(),m=0;e=k[m];m++)e(c||q,u,r)})});var h=
{};h.remove=h.cancel=function(){var a=t.indexOf(f,c);-1<a&&(f.splice(a,1),f.length||q.splice(t.indexOf(q,m),1))};return h}}return e};var v;m("put",function(d,g){l.notify(d,g)});m("add",function(d){l.notify(d)});m("remove",function(d){l.notify(void 0,d)});return l};d.setObject("dojo.store.Observable",l);return l})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(l,d){var k=function(k,p,m){m=m||{};return l.delegate(k,{query:function(d,l){d=k.query(d,l);d.forEach(function(d){m.isLoaded&&
!m.isLoaded(d)||p.put(d)});return d},queryEngine:k.queryEngine||p.queryEngine,get:function(l,m){return d(p.get(l),function(n){return n||d(k.get(l,m),function(d){d&&p.put(d,{id:l});return d})})},add:function(l,m){return d(k.add(l,m),function(d){p.add(d&&"object"==typeof d?d:l,m);return d})},put:function(l,m){p.remove(m&&m.id||this.getIdentity(l));return d(k.put(l,m),function(d){p.put(d&&"object"==typeof d?d:l,m);return d})},remove:function(l,m){return d(k.remove(l,m),function(d){return p.remove(l,
m)})},evict:function(d){return p.remove(d)}})};l.setObject("dojo.store.Cache",k);return k})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(l,d,k,t,p,m){return l(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(d){l.safeMixin(this,d);this.data=[];this._entityData=[];this.layer=d.layer;this.objectIds=d.objectIds;
this.where=d.where;this.orderByFields=d.orderByFields;this.totalCount=d.totalCount;this.batchCount=d.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=d.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new p(this.layer.url))},get:function(d){return this.data[d]},getIdentity:function(d){return d[this.idProperty]},query:function(l,p){var n=new t,q=p&&p.start||0,h=p._export_count||this.batchCount,g=null;"function"===typeof l?g=l(this._entityData):"[object Array]"===
Object.prototype.toString.call(l)&&(g=l);this.objectIds?(g=g?g:this.objectIds,n.objectIds=g.length>=q+this.batchCount?g.slice(q,q+h):g.slice(q)):(g&&0<g.length?n.objectIds=g.length>=q+this.batchCount?g.slice(q,q+h):g.slice(q):(n.start=q,n.num=h,n.where=this.where,n.geometry=this.spatialFilter,n.spatialRelationship=t.SPATIAL_REL_INTERSECTS),(l=p.sort)&&0<l.length&&(l=k.map(l,function(c){return c.attribute+" "+(c.descending?"DESC":"ASC")}),n.orderByFields=l));n.returnGeometry="esriGeometryPoint"===
this.layer.geometryType;n.outFields=["*"];var e=this.totalCount;l=null;l=!n.where;if(!(n.objectIds&&0<n.objectIds.length)&&l)return new m([]);l=this.queryTask?this.queryTask.execute(n):this.layer.queryFeatures(n);l.total=l.then(d.hitch(this,function(c){var b=0,a=this.layer.objectIdField;if(this.objectIds){if(!a)for(b=0;b<c.fields.length;b++)if("esriFieldTypeOID"===c.fields[b].type){a=c.fields[b].name;break}for(var f={},b=0;b<c.features.length;b++)f[c.features[b].attributes[a]]=c.features[b];c.features=
k.map(n.objectIds,function(a){return f[a]})}for(b=0;b<c.features.length;b++)if(c.features[b]){var g=c.features[b];c.features[b]=d.mixin(d.clone(g.attributes),{geometry:g.geometry});this.data[c.features[b][a]]=c.features[b];this._entityData.push(c.features[b])}c=c.features;return e}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new m(l)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),
function(l,d,k,t){var p=function(m){function q(d){m[d]||(m[d]=function(){var l=arguments;return t.when(m,function(m){Array.prototype.unshift.call(l,m.features||m);return p(k[d].apply(k,l))})})}if(!m)return m;m.then&&(m=d.delegate(m));m.total||(m.total=t.when(m,function(d){return l._isDefined(d.total)?d.total:d.length||0}));q("forEach");q("filter");q("map");q("some");q("every");return m};return p})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings",
"dojo/text!./config.json"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\n\x3c/div\x3e\n',"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\n\t\t  role\x3d"presentation"\x3e\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\n\t\t\t\t\x3e\x3c/span\x3e\n\x3c/div\x3e\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\n\t\t class\x3d"tabStripButton-${tabPosition}"\n\t\t id\x3d"${id}_menuBtn"\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\n\t\t class\x3d"tabStripButton-${tabPosition}"\n\t\t id\x3d"${id}_leftBtn"\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\n\t\t class\x3d"tabStripButton-${tabPosition}"\n\t\t id\x3d"${id}_rightBtn"\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\n\x3c/div\x3e',"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" data-dojo-attach-point\x3d"btnAddExpDesktop"\r\n\t\t\t class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" data-dojo-attach-point\x3d"btnAddSetDesktop"\r\n\t\t\t class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateValueSelector.html":'\x3cdiv\x3e\r\n\t\x3cinput data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-point\x3d"dateTextBox" class\x3d"custom-date-text-box" data-dojo-attach-event\x3d"change:_onDateTextBoxChanged" data-dojo-props\x3d\'required:false,trim:true\' /\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\n\t\x3c/div\x3e\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\n\t\t\x3cthead\x3e\n\t\t\t\x3ctr role\x3d"row"\x3e\n\t\t\t\t${!dayCellsHtml}\n\t\t\t\x3c/tr\x3e\n\t\t\x3c/thead\x3e\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\n\t\t\t\t${!dateRowsHtml}\n\t\t\x3c/tbody\x3e\n\t\x3c/table\x3e\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/ListValueProvider.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"valuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"input:_onFilteringSelectInput"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" tabindex\x3d"0"\x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list items-content" data-dojo-attach-point\x3d"selectedListContent" tabindex\x3d"0"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" tabindex\x3d"0"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent" tabindex\x3d"0"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}" data-dojo-attach-point\x3d"showAllIconBtn"  tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}" data-dojo-attach-point\x3d"showSelectedIconBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv tabindex\x3d"0"\x3e\r\n   \x3cdiv class\x3d"checkBtn" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;"data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\n\t\t/\x3e\x3c/div\x3e\x3c/td\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\n\x3e\x3c/div\x3e\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\n\t\x3e\x3c/div\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\n\t\x3e\x3c/div\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\n\t\x3e\x3cinput\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\n\t\tdata-dojo-attach-point\x3d"focusNode"\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\n/\x3e\x3c/div\x3e\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting" data-dojo-attach-event\x3d"click:_onValueTypeSetClick"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"click:_destroySelf"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"onclick:_destroySelf"\r\n\t\t\t\t\t class\x3d"jimu-icon jimu-icon-delete"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAdd" class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}',
"url:widgets/AttributeTable/config.json":'{\r\n  "layerInfos": [],\r\n  "table": {\r\n    "pageSizeOptions": [25, 50, 100, 1000]\r\n  },\r\n  "hideExportButton": true,\r\n  "initiallyExpand": false,\r\n  "filterByMapExtent": true,\r\n  "allowTextSelection": true,\r\n  "syncWithLayers": false\r\n}\r\n',"*now":function(l){l(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/keys dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils".split(" "),function(l,d,k,t,p,m,q,u,n,v,h,g,e,c,b,a,f,r,w,z,N,H,I,E){l=l([t,k],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);d.setAttr(this.domNode,"aria-label",this.nls._widgetLabel);q.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=
this._loadInfoDef=null;this._delayedLayerInfos=[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=H.getInstance();this._createUtilitiesUI();this._resourceManager=new I({map:this.map,nls:this.nls});
this._resourceManager.setConfig(this.config);this.own(f.subscribe("changeMapPosition",e.hitch(this,this._onMapPositionChange)));E.readLayerInfosObj(this.map).then(e.hitch(this,function(a){this.domNode&&a&&(this.own(c(a,"layerInfosIsShowInMapChanged",e.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",e.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",e.hitch(this,this.onLayerInfosFilterChanged))))}));this.own(c(this.domNode,"keydown",
e.hitch(this,function(a){d.hasClass(a.target,this.baseClass)&&a.keyCode===b.ENTER&&(this.focusToDisplay=!1)})));this.focusToDisplay=!0;this.own(c(this.domNode,"focus",e.hitch(this,function(){q.isInNavMode()&&this.focusToDisplay&&10>d.getStyle(this.domNode,"height")&&this._switchTable()})));this.own(c(this.domNode,"blur",e.hitch(this,function(){q.isInNavMode()&&this.focusToDisplay&&this._switchTable()})))},_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=
d.create("div");d.addClass(this.arrowDiv,"jimu-widget-attributetable-move");d.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);d.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var b=d.getMarginBox(this.arrowDiv);this.arrowDivHeight=b&&b.h?b.h:7}this.own(c(this.arrowDiv,"mousedown",e.hitch(this,this._onDragStart)));this.own(c(this.arrowDiv,a.press,e.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||
(this.switchBtn=d.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0"},this.domNode),q.initFirstFocusNode(this.domNode,this.switchBtn),this.own(c(this.switchBtn,"click",e.hitch(this,this._switchTable))),this.own(c(this.switchBtn,"keydown",e.hitch(this,function(a){a.keyCode===b.ENTER&&(this._switchTable(),this.focusToDisplay=this.showing?!1:!0)}))))},_processOpenBarUI:function(){this._isOnlyTable()||(d.removeClass(this.switchBtn,"close"),d.addClass(this.switchBtn,"open"),d.setAttr(this.switchBtn,
"title",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(d.removeClass(this.switchBtn,"open"),d.addClass(this.switchBtn,"close"),d.setAttr(this.switchBtn,"title",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){d.removeClass(this.domNode,"closed");this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):
(this._loadInfoDef=new n,this.own(this._loadInfoDef),this.loading||(this.loading=new N),this.loading.placeAt(this.domNode),this.loading.show(),this._resourceManager.updateLayerInfoResources(!0).then(e.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),e.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&
this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){d.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;d.setStyle(this.arrowDiv,"display","none");d.setStyle(this.domNode,"overflow","hidden");setTimeout(e.hitch(this,function(){this.domNode&&(d.setStyle(this.domNode,"overflow",
"visible"),d.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(c(window.document,"mouseup",e.hitch(this,this._onDragEnd)));this.own(c(window.document,"mousemove",e.hitch(this,this._onDraging)));this.own(c(window.document,a.move,e.hitch(this,this._onDraging)));this.own(c(window.document,a.release,e.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(w.forEach(this._delayedLayerInfos,
e.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(a){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&w.forEach(a,e.hitch(this,function(a){if(!a.getSubLayers().length){var b=a.isShowInMap(),c=E.getConfigInfoFromLayerInfo(a),d=this.getExistLayerTabPage(c.id);if(b)if(d)d.closable&&d.set("closable",!1);else{var f=this._resourceManager.getVisivleLayerInfoIndexById(a.id),b=this._resourceManager.getLayerInfoById(a.id),
g={layer:a,closeable:!1,isActive:!1,index:f};b?this._addLayerToTable(g):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){f=this._resourceManager.getVisivleLayerInfoIndexById(a.id);g.index=f;this._addLayerToTable(g)}))}else d&&this.layerTabPageClose(c.id,!0)}}))},onLayerInfosChanged:function(a,b,c){c&&a&&("added"===b?c.getSupportTableInfo().then(e.hitch(this,function(a){a.isSupportedLayer&&this._resourceManager.addLayerInfo(c)})):"removed"===b&&(a=c.id,this.getExistLayerTabPage(a)&&
this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){w.some(a,e.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},destroy:function(){if(!this._destroyed){var a,b;if(this.layerTabPages&&0<this.layerTabPages.length){a=
this.layerTabPages.length;for(b=0;b<a;b++){var c=this.layerTabPages[b].paneId,d=e.getObject("_resourceManager.featureTableSet."+c,!1,this);d&&(d=d.getFilterObj())&&g.isDefined(d.expr)&&this.filterManager.applyWidgetFilter(c,this.id,"");this.layerTabPages[b].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},
onOpen:function(){!this.showing&&this._isOnlyTable()&&this._openTable()},onClose:function(){this.showing&&this._closeTable()},_changeHeight:function(a){d.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&d.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);f.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+
this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?d.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):d.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?d.setStyle(this.domNode,"left",parseFloat(a.right)+"px"):d.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},
setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(d.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));d.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||setTimeout(e.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=d.getStyle(this.domNode,
"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(a,b){var c=this._resourceManager.getLayerInfoById(a),f=this.getExistLayerTabPage(a);c&&f&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton,this.config.allowTextSelection).then(e.hitch(this,function(c){this._activeLayerInfoId===a&&c&&(f=this.getExistLayerTabPage(a),c.isSupportQuery?(c=c.table,c.getParent()!==f&&c.placeAt(f),this.setActiveTable(c,
{h:this.openHeight-this.noGridHeight,featureSet:b})):(c=d.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),f.set("content",c),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),e.hitch(this,function(a){new u({message:a.message||a});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(a,b,c,f){var g=this._resourceManager.getLayerInfoById(f),h=this.getExistLayerTabPage(a);g&&g.layerObject&&h&&this._resourceManager.getRelationTable(f,b,
!1,this.config.hideExportButton,this.config.allowTextSelection).then(e.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(h=this.getExistLayerTabPage(a),b.isSupportQuery?(b=b.table,b.getParent()!==h&&b.placeAt(h),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,layer:g.layerObject,selectedIds:c})):(b=d.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),h.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&
this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,d=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=
c,this._startQueryOnRelationTab(c,d,b,a))}},showRefreshing:function(a){this.loading&&(a?this.loading.show():this.loading.hide())},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=d.getStyle(this.domNode,"height");d.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([c(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),c(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},
_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;d.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){d.setStyle(this.domNode,"top","auto");d.setStyle(this.domNode,"left","0px");d.setStyle(this.domNode,
"right","0px");d.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(c(a._activeTable,"show-related-records",function(b){a._showRelatedRecords(b.layerInfoId,b.objectIds)})),a._activeTableHandles.push(c(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=a._layerTypes.FEATURELAYER})),
a._activeTableHandles.push(c(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(c(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(a,b){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(b.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&b.featureSet||b.layer&&b.selectedIds)if(a=e.getObject("featureSet.features.length",!1,b),b.layer&&b.selectedIds)this._activeTable.queryRecordsByRelationship(b);else if(a){var c=
b.featureSet.displayFieldName;b=w.map(b.featureSet.features,function(a){return a.attributes[c]});this._activeTable.startQuery(b)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=d.create("div",{},this.domNode);d.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=d.create("div");d.place(a,this.AttributeTableDiv);this.tabContainer=new p({style:"width: 100%;"},a);d.setStyle(this.tabContainer.domNode,
"height",this.normalHeight+"px");this.tabContainer.startup();for(var a=this._resourceManager.getConfigInfos(),b=a.length,c=0;c<b;c++){var f=a[c];if(f.show){var f=e.clone(f),g={};g.paneId=f.id;g.title=f.name;g.name=f.name;g.layerType=this._layerTypes.FEATURELAYER;g.style="height: 100%; width: 100%; overflow: visible;";f=new m(g);this.layerTabPages[c]=f;this.tabContainer.addChild(f)}}0<b?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);q.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(r.after(this.tabContainer,"selectChild",e.hitch(this,this.tabChanged)))},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=z(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=d.position(this.domNode).y;return d.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=w.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecords:function(a,
b){var c=this._activeTable;if(c&&(c=c.layerInfo)&&c.id===a&&c.layerObject){a=c.layerObject.relationships;for(var d=0,e=a.length;d<e;d++)this.addNewRelationTab(b,a[d],c.id,!0,!0)}},addNewLayerTab:function(a,b,d,f,g){var h=this._resourceManager.getLayerInfoById(a);if(h){a=this.getExistLayerTabPage(a);var k={};k.title=this.getLayerInfoLabel(h);k.name=k.title;k.paneId=this.getLayerInfoId(h);k.closable=d;k.layerType=this._layerTypes.FEATURELAYER;k.featureSet=b;a?(e.mixin(a.params,k),this.onOpen()):(this._resourceManager.getConfigInfoById(h.id)||
this._resourceManager.addConfigInfo(h),this._resourceManager.getLayerInfoById(h.id)||this._resourceManager.addLayerInfo(h),this.onOpen(),k.style="height: 100%; width: 100%; overflow: visible",a=new m(k),this.layerTabPages.push(a),a.set("title",k.name),this.own(c(a,"close",e.hitch(this,this.layerTabPageClose,k.paneId,!0))),this.tabContainer.addChild(a,g));f&&this.tabContainer.selectChild(a);1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(a,b,d,f,g){var h=
this._resourceManager.getRelationShipInfo(b),k=b&&h;if(k){var h=this.getExistLayerTabPage(h.id),l={};l.oids=a;l.title=k.title||k.name||b.name;l.name=l.title;l.paneId=k.id;l.relKey=b._relKey;l.originalInfoId=d;l.closable=f;l.layerType=this._layerTypes.RELATIONSHIPTABLE;h?e.mixin(h.params,l):(this._resourceManager.getConfigInfoById(k.id)||this._resourceManager.addConfigInfo(k),this._resourceManager.getLayerInfoById(k.id)||this._resourceManager.addLayerInfo(k),l.style="height: 100%; width: 100%; overflow: visible",
h=new m(l),this.layerTabPages.push(h),h.set("title",l.name),this.own(c(h,"close",e.hitch(this,this.layerTabPageClose,l.paneId,!0))),this.tabContainer.addChild(h));g&&this.tabContainer.selectChild(h)}},onReceiveData:function(a,b,c){c&&"AttributeTable"===c.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(c.layer=c.layer||c.layerInfo,c.closeable=!0,c.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(c)})):
this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(c.layer.id)?this._addLayerToTable(c):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(c)}))}))))},_addLayerToTable:function(a){var b=null;if(e.getObject("layer.id",!1,a)||e.getObject("layerInfo.id",!1,a)){var d=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);d.getLayerObject().then(e.hitch(this,function(f){f?(f.id=a.layer.id,
f.loaded?this.addNewLayerTab(d.id,a.featureSet,!!a.closeable,!!a.isActive,a.index):this.own(c(f,"load",e.hitch(this,this.addNewLayerTab,d.id,a.featureSet,!!a.closeable,!!a.isActive,a.index)))):a.url&&(b=new h(a.url),this.own(c(b,"load",e.hitch(this,this.addNewLayerTab,d.id,a.featureSet,!!a.closeable,!!a.isActive,a.index))))}),e.hitch(this,function(a){new u({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===
a)return this.layerTabPages[c];return null},layerTabPageClose:function(a,b){var c=this.layerTabPages.length;e.getObject("_activeTable.layerInfo.id",!1,this)===a&&this.setActiveTable(null);for(var d=0;d<c;d++)if(this.layerTabPages[d]&&this.layerTabPages[d].paneId===a){var f=e.getObject("_resourceManager.featureTableSet."+a,!1,this);f&&(f=f.getFilterObj())&&g.isDefined(f.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===b&&(this.tabContainer.removeChild(this.layerTabPages[d]),this.layerTabPages[d].destroyRecursive());
this.layerTabPages&&this.layerTabPages[d]&&this.layerTabPages.splice(d,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);if(1===c){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[c-2]);break}},_processRelatedRecordsFromPopup:function(a,b){if(a){var c=[];c.push(a.getLayerObject());c.push(a.getRelatedTableInfoArray());v(c).then(e.hitch(this,function(c){if(c){var d=
c[0];this._resourceManager.collectRelationShips(a,c[1]);c=d.relationships;for(var d=0,e=c.length;d<e;d++)this.addNewRelationTab(b,c[d],a.id,!0,!0)}}))}},showRelatedRecordsFromPopup:function(a,b){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)})):this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,b):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,
function(){this._processRelatedRecordsFromPopup(a,b)}))}))},_toggleNoTableMessage:function(a){if(!this.NoTableMessageDiv){var b=this.AttributeTableDiv||this.domNode;this.NoTableMessageDiv=d.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});d.place(this.NoTableMessageDiv,b)}d[a?"removeClass":"addClass"](this.NoTableMessageDiv,
"hidden")}});l.inPanel=!1;l.hasUIFile=!1;return l});