//>>built
define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/_base/lang dojo/Deferred dojo/on jimu/BaseWidgetSetting jimu/dijit/LayerChooserFromMapLite jimu/LayerInfos/LayerInfos dijit/_WidgetsInTemplateMixin dijit/form/NumberTextBox dijit/form/CheckBox".split(" "),function(e,f,g,h,k,l,m,d,n,p){return e([m,p],{baseClass:"jimu-widget-legend-setting",startup:function(){this.inherited(arguments);this.config.legend||(this.config.legend={});this.setConfig(this.config)},setConfig:function(a){this.config=
a;void 0!==a.legend.arrangement&&this.selectArrangement.set("value",a.legend.arrangement);this.autoUpdate.setValue(a.legend.autoUpdate);this.respectCurrentMapScale.setValue(a.legend.respectCurrentMapScale);this.showLegendForBasemap.setValue(a.showLegendForBasemap);this._setLayerChooser(this.config.layerState);this.syncWithWebmapToggle.setValue(a.syncWithWebmap);a.syncWithWebmap&&(this._setLayerChooser(null),this.layerChooser.setViewMode(!0));this.own(l(this.syncWithWebmapToggle,"change",h.hitch(this,
this._onSyncWithWebmapToggleChange)))},getConfig:function(){this.config.legend.arrangement=parseInt(this.selectArrangement.get("value"),10);this.config.legend.autoUpdate=this.autoUpdate.checked;this.config.legend.respectCurrentMapScale=this.respectCurrentMapScale.checked;this.config.showLegendForBasemap=this.showLegendForBasemap.checked;this.config.syncWithWebmap=this.syncWithWebmapToggle.checked;this.config.syncWithWebmap||(this.config.layerState=this.layerChooser.getState());return this.config},
_setLayerChooser:function(a){this.layerChooser?this.layerChooser.restoreState(a):(this.layerChooser=new d({customFilter:function(a){var b=new k,c=null;a.isTable?b.resolve(!1):a.isRootLayer()?b.resolve(!0):(c=a.getRootLayerInfo())&&c.layerObject&&("esri.layers.ArcGISDynamicMapServiceLayer"===c.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===c.layerObject.declaredClass||"esri.layers.FeatureCollection"===c.layerObject.declaredClass)?b.resolve(!0):b.resolve(!1);return b},layerState:a,
layerStateController:d.layerLegendStateController,onlyShowWebMapLayers:!0,onlySelectLeafLayer:!0}),this.layerChooser.placeAt(this.layerChooserDiv));this._updateLayerChooserUI()},_updateLayerChooserUI:function(){var a=n.getInstanceSync();f.forEach(a.getLayerInfoArray(),function(a){a&&a.layerObject&&"esri.layers.ArcGISDynamicMapServiceLayer"!==a.layerObject.declaredClass&&"esri.layers.ArcGISTiledMapServiceLayer"!==a.layerObject.declaredClass&&"esri.layers.FeatureCollection"!==a.layerObject.declaredClass&&
(a=this.layerChooser.getLayerAssociateDomNodesById(a.id))&&a.collapseIcon&&g.setStyle(a.collapseIcon,"background-image","none")},this)},_onSyncWithWebmapToggleChange:function(a){a?(this._setLayerChooser(null),this.layerChooser.setViewMode(!0)):(this.layerChooser.setViewMode(!1),this._setLayerChooser(this.config.layerState))},_onRefreshButtonClick:function(){this.syncWithWebmapToggle.checked||this._setLayerChooser()}})});