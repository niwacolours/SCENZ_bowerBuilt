//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/GpSource jimu/dijit/ViewStack jimu/dijit/Popup jimu/utils ./SettingDetail ../utils dijit/form/ValidationTextBox".split(" "),function(g,b,h,d,e,k,l,m,n,p,q,r,t){return g([l,k],{baseClass:"jimu-widget-setting-gp",postMixInProperties:function(){this.inherited(arguments);b.mixin(this.nls,window.jimuNls.common);b.mixin(this.nls,window.jimuNls.units)},startup:function(){this.inherited(arguments);
this.settingDetail=new r({config:b.clone(this.config),nls:this.nls,map:this.map},this.settingDetailNode);this.viewStack=new n({viewType:"dijit",views:[this.settingDetail]},this.stackNode);this.viewStack.startup();this.setConfig(this.config);setTimeout(b.hitch(this,function(){this.resize();this.config.taskUrl||this._onChooseTaskClicked()}),100)},_onChooseTaskClicked:function(){var a=new m({portalUrl:this.appConfig.portalUrl}),f=new p({titleLabel:this.nls.setTaskTitle,width:830,height:560,content:a});
this.own(e(a,"ok",b.hitch(this,function(a){0!==a.length&&this.config.taskUrl!==a[0].url&&(this.config.taskUrl=a[0].url,this.urlTextBox.set("value",this.config.taskUrl),this.settingDetail.setConfig(this.config));f.close()})));this.own(e(a,"cancel",b.hitch(this,function(){f.close()})))},resize:function(){var a=d.getContentBox(this.domNode);d.setStyle(this.stackNode,{height:a.h-40-3+"px"})},setConfig:function(a){a.taskUrl&&(this.settingDetail.setConfig(a),this.urlTextBox.set("value",a.taskUrl))},getConfig:function(){return this.settingDetail.getConfig()},
getDataSources:function(){var a=this.getConfig();if(a.useResultMapServer)return[];var b=[];h.forEach(a.outputParams,function(c){c.visible&&("GPFeatureRecordSetLayer"===c.dataType||"GPRecordSet"===c.dataType)&&c.defaultValue&&c.defaultValue.fields&&(t.useDynamicSchema(c,a)||b.push({id:"filter-"+c.name,type:"Features",label:c.name,dataSchema:q.getDataSchemaFromLayerDefinition(c.defaultValue)}))});return b},_onServiceSelected:function(a){this.config.taskUrl!==a.url&&(this.config.taskUrl=a.url,this.settingDetail.setConfig(this.config))}})});