//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../../../../webgl/VertexArrayObject".split(" "),function(l,n,q,p,h,r,t){Object.defineProperty(n,"__esModule",{value:!0});l=function(k){function e(){var b=null!==k&&k.apply(this,arguments)||this;return b._attributeLocations={a_pos:0,a_color:1,a_vertexOffset:2,a_texAndSize:3,a_refSymbolAndPlacementOffset:4,a_visible:5,a_visibilityRange:6},b._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,
type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_texAndSize",count:4,type:5120,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_refSymbolAndPlacementOffset",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}],visibilityRange:[{name:"a_visibilityRange",
count:2,type:5121,offset:0,stride:2,normalized:!1,divisor:0}]},b._glyphsTextureSize=new Float32Array(2),b}return q(e,k),e.prototype.dispose=function(){},e.prototype.drawGeometry=function(b,c,m,d){if(b.requiredLevel===c.key.level){d=b.context;var g=b.painter,a=b.drawPhase,f=m.materialInfo,e=m.indexCount;m=m.indexFrom;var h=this._attributeLocations,k=b.drawPhase===p.WGLDrawPhase.LABEL_ALPHA,l=f.materialKey;k&&(l|=8);if(a=g.materialManager.getProgram(l,a,h))d.setStencilTestEnabled(!1),d.bindProgram(a),
h=this._getVAO(d,c),(d.bindVAO(h),k)?(d.setBlendingEnabled(!1),a.setUniform1f("u_fadeStep",b.labelStep)):(f=f.texBindingInfo[0],g.textureManager.bindGlyphsPage(d,f.pageId,f.unit),a.setUniform1i(f.semantic,f.unit)),f=g.textureManager.glyphs,this._glyphsTextureSize[0]=f.width/4,this._glyphsTextureSize[1]=f.height/4,g=g.extrudeNoRotationMatrix,d.bindTexture(b.labelFBO.colorTexture,3),a.setUniform1i("u_referenceTex",3),a.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),a.setUniformMatrix4fv("u_extrudeMatrix",
g),a.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),a.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),a.setUniform1f("u_pixelRatio",b.pixelRatio),a.setUniform1f("u_opacity",1),a.setUniform1f("u_zoomLevel",10*b.displayLevel),a.setUniform1f("u_mapRotation",b.state.rotation),a.setUniform1f("u_mapAligned",0),a.setUniform2fv("u_screenSize",b.state.size),d.drawElements(4,e,5125,4*m),d.bindVAO(null),d.setStencilTestEnabled(!0),d.setBlendingEnabled(!0)}},e.prototype.getGeometryType=
function(){return p.WGLGeometryType.LABEL},e.prototype._getVAO=function(b,c){if((c=c.labelGeometry)&&c.vao)return c.vao;var e=c.vertexBufferMap[h.C_VBO_GEOMETRY],d=c.vertexBufferMap[h.C_VBO_VISIBILITY],g=c.vertexBufferMap[h.C_VBO_VISIBILITY_RANGE],a=c.indexBuffer;return e&&a&&g?(c.vao=new t(b,this._attributeLocations,this._vertexAttributeLayout,{geometry:e,visibility:d,visibilityRange:g},a),c.vao):null},e}(r.default);n.default=l});