//>>built
define("require exports ../../../../core/screenUtils ./color ./enums ./Geometry ./MaterialInfoUtils ./MeshData ./number ./SymbolProperties ./TextShaping ./visualVariablesUtils ./WGLDisplayRecord".split(" "),function(V,M,G,N,R,x,K,O,c,S,T,U,P){Object.defineProperty(M,"__esModule",{value:!0});var B=[],Q=c.i8888to32(255,255,255,255);M.createTextDisplayRecords=function(g,C,L,n,q,r,H){B.length=0;var h=C.symbol;q=q.get(h);if(!q.glyphMosaicItems||0===q.glyphMosaicItems.length)return B;var u=h.text;q=(new T([q.glyphMosaicItems],
240,24,0,[24*r.offsetX,24*r.offsetY],r.hAnchor,r.vAnchor,.5)).getShaping(u,!1);if(!q||0===q.length)return B;C=C.vv;var u=c.numTo32(L),k=K.createTextMaterialInfo(q[0].glyphMosaicItem,C,H).materialKeyInfo,b=0,f=0,m=0,d=0,v=k.vvColor||k.vvOpacity||k.vvRotation||k.vvSizeMinMaxValue||k.vvSizeScaleStops||k.vvSizeFieldStops||k.vvSizeUnitValue;v&&(b=n.vvFields,m=b.rotation?n.getValue(g,b.rotation):0,f=b.opacity?n.getValue(g,b.opacity):0,d=b.color?n.getValue(g,b.color):0,b=b.size&&!k.vvSizeScaleStops?n.getValue(g,
b.size):0,k.vvSizeUnitValue&&(b=U.getVisualVariableSizeValueRepresentationRatio(b,n.vvRanges.size.unitValue.valueRepresentation)),(null===b||isNaN(b))&&(b=NaN),(null===m||isNaN(m))&&(m=NaN),(null===d||isNaN(d))&&(d=NaN),(null===f||isNaN(f))&&(f=NaN),b=c.toUint32(b),f=c.toUint32(f),m=c.toUint32(m),d=c.toUint32(d));var y,D,E;n=[b,d,f,m];g=g.centroid||g.geometry;k=g.x;d=g.y;g=h.color&&N.copyAndPremultiply(h.color);b=h.haloColor&&N.copyAndPremultiply(h.haloColor);g=g&&c.i8888to32(g[0],g[1],g[2],g[3])||
4294967295;var I=b&&c.i8888to32(b[0],b[1],b[2],b[3])||0,b=[G.pt2px(h.xoffset),G.pt2px(h.yoffset)],k=k+b[0],d=d+b[1],b=h.font.size,m=10*(null!=h.haloSize?G.pt2px(G.toPt(h.haloSize)):0);if(0<m)for(var J=c.i1616to32(2*k+1,2*d),h=0;h<q.length;h++){var e=q[h],a=[],F=[],p=e.glyphMosaicItem,f=Math.round(p.rect.x/4);y=Math.round(p.rect.y/4);D=f+Math.round(p.rect.width/4);E=y+Math.round(p.rect.height/4);var l=e.x+0+p.metrics.left,e=e.y+-17-p.metrics.top,l=new x.Point(l-4,e-4),e=new x.Point(l.x+p.rect.width,
l.y+p.rect.height),z=new x.Point(l.x,e.y),A=new x.Point(e.x,l.y);if(0!==r.angle){var t=Math.cos(r.angle),w=Math.sin(r.angle);l.rotate(t,w);e.rotate(t,w);z.rotate(t,w);A.rotate(t,w)}t=K.createTextMaterialInfo(p,C,H);p=new O;a.push(J);a.push(u);a.push(I);a.push(c.i1616to32(32*l.x,32*l.y));a.push(c.i8888to32(f,y,b,m));v&&a.push.apply(a,n);a.push(J);a.push(u);a.push(I);a.push(c.i1616to32(32*A.x,32*A.y));a.push(c.i8888to32(D,y,b,m));v&&a.push.apply(a,n);a.push(J);a.push(u);a.push(I);a.push(c.i1616to32(32*
z.x,32*z.y));a.push(c.i8888to32(f,E,b,m));v&&a.push.apply(a,n);a.push(J);a.push(u);a.push(I);a.push(c.i1616to32(32*e.x,32*e.y));a.push(c.i8888to32(D,E,b,m));v&&a.push.apply(a,n);F.push(Q);p.update({geometry:a,visibility:F},4,[0,1,2,1,3,2]);f=new P(L,R.WGLGeometryType.TEXT,t);f.meshData=p;B.push(f)}k=c.i1616to32(2*k,2*d);for(h=0;h<q.length;h++)e=q[h],a=[],F=[],d=e.glyphMosaicItem,f=Math.round(d.rect.x/4),y=Math.round(d.rect.y/4),D=f+Math.round(d.rect.width/4),E=y+Math.round(d.rect.height/4),l=e.x+
0+d.metrics.left,e=e.y+-17-d.metrics.top,l=new x.Point(l-4,e-4),e=new x.Point(l.x+d.rect.width,l.y+d.rect.height),z=new x.Point(l.x,e.y),A=new x.Point(e.x,l.y),0!==r.angle&&(t=Math.cos(r.angle),w=Math.sin(r.angle),l.rotate(t,w),e.rotate(t,w),z.rotate(t,w),A.rotate(t,w)),d=K.createTextMaterialInfo(d,C,H),p=new O,a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*l.x,32*l.y)),a.push(c.i8888to32(f,y,b,m)),v&&a.push.apply(a,n),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*A.x,32*A.y)),a.push(c.i8888to32(D,
y,b,m)),v&&a.push.apply(a,n),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*z.x,32*z.y)),a.push(c.i8888to32(f,E,b,m)),v&&a.push.apply(a,n),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*e.x,32*e.y)),a.push(c.i8888to32(D,E,b,m)),v&&a.push.apply(a,n),F.push(Q),p.update({geometry:a,visibility:F},4,[0,1,2,1,3,2]),f=new P(L,H,d),f.meshData=p,B.push(f);return S.TextProperties.pool.release(r),B}});