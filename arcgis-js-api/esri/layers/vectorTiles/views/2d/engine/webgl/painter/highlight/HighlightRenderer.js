//>>built
define("require exports ../../shaders/hlShaderSnippets ../../../../../webgl/BufferObject ../../../../../webgl/ShaderVariations ../../../../../webgl/Texture ../../../../../webgl/VertexArrayObject".split(" "),function(x,y,p,r,q,t,u){var m=[void 0,void 0,void 0,1],k=[3,4],v=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],w=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return function(){function c(){this._height=this._width=void 0;this._highlightOptions={fillColor:[.2,.6,.9,.75],outlineColor:[.2,.6,.9,.9],outlinePosition:0,outlineWidth:3.4,
innerHaloWidth:2,outerHaloWidth:3.3};this._resources=null}return c.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources.shadeTex.dispose(),this._resources=null)},c.prototype.preBlur=function(a,g){a.bindTexture(g,k[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);
this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",v);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()},c.prototype.finalBlur=function(a,g){a.bindTexture(g,k[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",w);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()},c.prototype.renderHighlight=function(a,g){a.bindTexture(g,
k[0]);a.bindTexture(this._resources.shadeTex,k[1]);a.bindProgram(this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()},c.prototype._initialize=function(a,g,d){this._width=g;this._height=d;g=new r(a,34962,35044,(new Int8Array([-128,-128,0,0,127,-128,255,0,-128,127,0,255,127,127,255,255])).buffer);d=new u(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!0},{name:"a_texcoord",count:2,type:5121,
offset:2,stride:4,normalized:!0}]},{geometry:g});var c=(new q("hl",["texturedVS","highlightFS"],[],p,a,{a_position:0,a_texcoord:1})).getProgram([]),n=(new q("hl",["texturedVS","blurFS"],[],p,a,{a_position:0,a_texcoord:1})).getProgram([]);c.setUniform1i("u_texture",k[0]);c.setUniform1i("u_shade",k[1]);c.setUniform4fv("u_sigmas",m);n.setUniform1i("u_texture",k[0]);n.setUniform4fv("u_sigmas",m);a=new t(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9728});
this._resources={quadGeometry:g,quadVAO:d,highlightProgram:c,blurProgram:n,shadeTex:a}},c.prototype.setHighlightOptions=function(a){function g(a,b,c){e[0]=(1-c)*a[0]+c*b[0];e[1]=(1-c)*a[1]+c*b[1];e[2]=(1-c)*a[2]+c*b[2];e[3]=(1-c)*a[3]+c*b[3]}if(this._highlightOptions=a,this._resources){var d=a.outlinePosition-a.outlineWidth/2-a.outerHaloWidth,c=a.outlinePosition-a.outlineWidth/2,k=a.outlinePosition+a.outlineWidth/2,l=a.outlinePosition+a.outlineWidth/2+a.innerHaloWidth,b=Math.sqrt(Math.PI/2)*m[3],
h=Math.abs(d)>b?Math.round(10*(Math.abs(d)-b))/10:0,b=Math.abs(l)>b?Math.round(10*(Math.abs(l)-b))/10:0;h&&!b?console.warn("The outer rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!h&&b?console.warn("The inner rim of the highlight is "+b+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
h&&b&&console.warn("The highlight is "+Math.max(h,b)+"px away from the edge of the feature; consider reducing some width values.");for(var b=new Uint8Array(1024),e=[void 0,void 0,void 0,void 0],f=0;256>f;++f)h=d+f/255*(l-d),h<d?(b[4*f+0]=0,b[4*f+1]=0,b[4*f+2]=0,b[4*f+3]=0):h<c?g([0,0,0,0],a.outlineColor,(h-d)/(c-d)):h<k?(e[0]=a.outlineColor[0],e[1]=a.outlineColor[1],e[2]=a.outlineColor[2],e[3]=a.outlineColor[3]):h<l?g(a.outlineColor,a.fillColor,(h-k)/(l-k)):(b[4*f+0]=a.fillColor[0],b[4*f+1]=a.fillColor[1],
b[4*f+2]=a.fillColor[2],b[4*f+3]=a.fillColor[3]),b[4*f+0]=255*e[0]*e[3],b[4*f+1]=255*e[1]*e[3],b[4*f+2]=255*e[2]*e[3],b[4*f+3]=255*e[3];this._resources.highlightProgram.setUniform2fv("u_minMaxDistance",[d,l]);this._resources.shadeTex.updateData(0,0,0,256,1,b)}},c.prototype.setup=function(a,c,d){this._resources?(this._width=c,this._height=d):(this._initialize(a,c,d),this.setHighlightOptions(this._highlightOptions))},c}()});