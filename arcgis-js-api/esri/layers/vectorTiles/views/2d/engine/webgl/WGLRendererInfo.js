//>>built
define("require exports ../../../../core/screenUtils ../../../../geometry/support/scaleUtils ../../../../renderers/support/utils ./color ./Utils".split(" "),function(u,v,h,q,r,t,n){function p(e,a){var d=a.length;if(e<a[0].value||1===d)return a[0].size;for(var b=1;b<d;b++)if(e<a[b].value)return a[b-1].size+(e-a[b-1].value)/(a[b].value-a[b-1].value)*(a[b].size-a[b-1].size);return a[d-1].size}return function(){function e(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);
this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0)}return Object.defineProperty(e.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,
configurable:!0}),Object.defineProperty(e.prototype,"heatmapParameters",{get:function(){return this._heatmapParameters},enumerable:!0,configurable:!0}),e.prototype.updateHeatmapParameters=function(a){var d=a.blurRadius,b=Math.round(4.5*a.blurRadius),f=2*b+1;this._heatmapParameters||(this._heatmapParameters={radius:d,blurRadius:b,kernelSize:f,refreshIntensityKernel:!0,intensityKernel:null,color:null,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity});for(var c=this._heatmapParameters,
e=a.colorStops,g,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;16>m;m++){var k=e[Math.min(m,e.length-1)];h[m]=k.ratio;g=4*m;l[g+0]=k.color[0]/255;l[g+1]=k.color[1]/255;l[g+2]=k.color[2]/255;l[g+3]=1<k.color[3]?k.color[3]/255:k.color[3];t.premultiplyAlpha(l,g,!0)}c.color={values:h,colors:l,refreshColorRamp:!0};1E-6<Math.abs(c.radius-a.radius)&&(c.radius=d,c.blurRadius=b,c.kernelSize=
f,c.refreshIntensityKernel=!0);c.maxPixelIntensity=a.maxPixelIntensity;c.minPixelIntensity=a.minPixelIntensity},e.prototype.updateVisualVariables=function(a,d){var b=this._vvMaterialParameters;if(b.vvOpacityEnabled=!1,b.vvSizeEnabled=!1,b.vvColorEnabled=!1,b.vvRotationEnabled=!1,a){var f=a.size;if(f){if(b.vvSizeEnabled=!0,f.minMaxValue){var c=f.minMaxValue,e=void 0,g=void 0;n.isDefined(c.minSize)&&n.isDefined(c.maxSize)&&(n.isNumber(c.minSize)&&n.isNumber(c.maxSize)?(e=h.pt2px(c.minSize),g=h.pt2px(c.maxSize)):
(g=d.scale,e=h.pt2px(p(g,c.minSize.stops)),g=h.pt2px(p(g,c.maxSize.stops))));this.vvSizeMinMaxValue.set([c.minDataValue,c.maxDataValue,e,g])}if(f.scaleStops&&(this.vvSizeScaleStopsValue=h.pt2px(p(d.scale,f.scaleStops.stops))),f.unitValue)this.vvSizeUnitValueToPixelsRatio=q.getMetersPerUnitForSR(d.spatialReference)/r.meterIn[f.unitValue.unit]/d.resolution;f.fieldStops&&(this.vvSizeFieldStopsValues.set(f.fieldStops.values),this.vvSizeFieldStopsSizes.set(f.fieldStops.sizes))}(d=a.color)&&(b.vvColorEnabled=
!0,this.vvColorValues.set(d.values),this.vvColors.set(d.colors));(d=a.opacity)&&(b.vvOpacityEnabled=!0,this.vvOpacityValues.set(d.values),this.vvOpacities.set(d.opacities));(a=a.rotation)&&(b.vvRotationEnabled=!0,b.vvRotationType=a.type)}},e}()});