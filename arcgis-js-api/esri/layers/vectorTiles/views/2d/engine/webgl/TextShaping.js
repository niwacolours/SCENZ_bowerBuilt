//>>built
define(["require","exports","./Rect"],function(y,z,u){return function(){function k(a,d,e,b,g,h,c,f){this._glyphItems=a;this._maxWidth=d;this._lineHeight=e;this._letterSpacing=b;this._offset=g;this._hAnchor=h;this._vAnchor=c;this._justify=f}return k.prototype.getShaping=function(a,d){for(var e=this._letterSpacing,b=this._lineHeight,g=this._justify,h=this._maxWidth,c=[],f=0,l=0,v=0,q=0,r=-1,t=0,k=-1,u=a.length,w=0;w<u;w++){var x=a.charCodeAt(w);if(10!==x){for(var p=void 0,n=0,m=this._glyphItems;n<m.length&&
!(p=m[n][x]);n++);if(p){if(c.push({codePoint:x,x:f,y:l,glyphMosaicItem:p}),f+=p.metrics.advance+e,0<h&&f>h&&0<=k){p=k+1;n=c[p].x;t=Math.max(n,t);for(m=p;m<c.length;m++)d?c[m].y-=b:c[m].y+=b,c[m].x-=n;g&&this._applyJustification(c,q,k);d?l-=b:l+=b;f-=n;++v;q=p;k=-1}++r;32===x&&(k=c.length-1)}}else w!==u-1&&(r>=q&&(f=c[r],n=f.x+f.glyphMosaicItem.metrics.advance,t=Math.max(n,t),g&&this._applyJustification(c,q,r),q=c.length),d?l-=b:l+=b,f=0,++v)}r>=q&&(f=c[r],t=Math.max(t,f.x+f.glyphMosaicItem.metrics.advance),
g&&this._applyJustification(c,q,r));if(0<c.length)for(a=(g-this._hAnchor)*t,e=(-this._vAnchor*(v+1)+.5)*b,d&&v&&(e+=v*b),a+=this._offset[0],e+=this._offset[1],d=0;d<c.length;d++)b=c[d],b.x+=a,b.y+=e;return c},k.getBox=function(a){var d=a.length;if(0!==d){for(var e=a[0].x+a[0].glyphMosaicItem.metrics.left,b=e,g=a[0].y,h=g,c=g,f=1;f<d;f++){var l=a[f],k=l.x+l.glyphMosaicItem.metrics.left;k<e&&(e=k);k>b&&(b=k);l=l.y;if(l<g&&(g=l),l>h&&(h=l),l!==c)b=Math.max(b,a[f-1].x+a[f-1].glyphMosaicItem.metrics.left+
a[f-1].glyphMosaicItem.metrics.width),c=l}return b=Math.max(b,a[d-1].x+a[d-1].glyphMosaicItem.metrics.left+a[d-1].glyphMosaicItem.metrics.width),g-=12,h+=12,{x:e,y:h,width:b-e,height:h-g}}},k.addDecoration=function(a,d){var e=a.length;if(0!==e){for(var b=a[0].x+a[0].glyphMosaicItem.metrics.left,g=a[0].y,h=1;h<e;h++){var c=a[h];if(c.y!==g){var f=a[h-1].x+a[h-1].glyphMosaicItem.metrics.left+a[h-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:b,y:g+d-3,glyphMosaicItem:{rect:new u(4,0,4,8),metrics:{width:f-
b,height:8,left:0,top:0,advance:0},page:0}});g=c.y;b=c.x+c.glyphMosaicItem.metrics.left}}e=a[e-1].x+a[e-1].glyphMosaicItem.metrics.left+a[e-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:b,y:g+d-3,glyphMosaicItem:{rect:new u(4,0,4,8),metrics:{width:e-b,height:8,left:0,top:0,advance:0},page:0}})}},k.prototype._applyJustification=function(a,d,e){for(var b=a[e],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;d<=e;d++)a[d].x-=b},k}()});