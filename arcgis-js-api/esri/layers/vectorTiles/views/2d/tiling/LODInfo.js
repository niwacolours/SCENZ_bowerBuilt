//>>built
define(["require","exports","../../../geometry/support/spatialReferenceUtils","./TileKey"],function(v,w,t,u){function q(b,a,c){return b[0]=a,b[1]=c,b}var d=new u("0/0/0/0");return function(){function b(a,c,b,d,f,g,h,k,l,m,n,p){this.level=a;this.resolution=c;this.scale=b;this.origin=d;this.first=f;this.last=g;this.size=h;this.norm=k;this.worldStart=l;this.worldEnd=m;this.worldSize=n;this.wrap=p}return b.create=function(a,c,e){var d=t.getInfo(a.spatialReference),f=[a.origin.x,a.origin.y],g=[a.size[0]*
c.resolution,a.size[1]*c.resolution],h=[-1/0,-1/0],k=[1/0,1/0],l=[1/0,1/0];e&&(q(h,Math.max(0,Math.floor((e.xmin-f[0])/g[0])),Math.max(0,Math.floor((f[1]-e.ymax)/g[1]))),q(k,Math.max(0,Math.floor((e.xmax-f[0])/g[0])),Math.max(0,Math.floor((f[1]-e.ymin)/g[1]))),q(l,k[0]-h[0]+1,k[1]-h[1]+1));var m,n,p,r;return a.isWrappable?(m=[Math.ceil(Math.round(2*d.origin[1]/c.resolution)/a.size[0]),l[1]],n=[Math.floor((d.origin[0]-f[0])/g[0]),h[1]],p=[m[0]+n[0]-1,k[1]],r=!0):(n=h,p=k,m=l,r=!1),new b(c.level,c.resolution,
c.scale,f,h,k,l,g,n,p,m,r)},b.prototype.normalizeCol=function(a){if(!this.wrap)return a;var c=this.worldSize[0];return 0>a?c-1-Math.abs((a+1)%c):a%c},b.prototype.denormalizeCol=function(a,c){return this.wrap?this.worldSize[0]*c+a:a},b.prototype.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):0},b.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]},b.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+
this.size[0]-1},b.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]},b.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]},b.prototype.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]},b.prototype.getYForRow=function(a){return this.origin[1]-a*this.norm[1]},b.prototype.getTileBounds=function(a,c,b){void 0===b&&(b=!1);d.set(c);var e=b?d.col:this.denormalizeCol(d.col,d.world),f=d.row;c=this.getXForColumn(e);b=this.getYForRow(f+1);e=this.getXForColumn(e+
1);f=this.getYForRow(f);return a[0]=c,a[1]=b,a[2]=e,a[3]=f,a},b.prototype.getTileCoords=function(a,b,e){void 0===e&&(e=!1);d.set(b);b=e?d.col:this.denormalizeCol(d.col,d.world);return Array.isArray(a)?q(a,this.getXForColumn(b),this.getYForRow(d.row)):(a.x=this.getXForColumn(b),a.y=this.getYForRow(d.row)),a},b}()});