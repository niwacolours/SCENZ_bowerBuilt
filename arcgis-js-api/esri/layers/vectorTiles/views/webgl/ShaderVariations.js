//>>built
define(["require","exports","./Program","./ShaderSourceVariator","./Util"],function(p,q,l,n,h){function m(c){return c.reduce(function(a,b,d){return b&&(a|=1<<d),a},0)}return function(){function c(a,b,d,e,c,f){"string"==typeof a?this._initParams(a,b,d,e,c,f):this._initObject({programNamePrefix:a.programNamePrefix,shaderSnippetPrefixes:a.shaderSnippetPrefixes,baseDefines:a.baseDefines,snippets:a.snippets,rctx:a.rctx,vertexAttribLocs:a.vertexAttribLocs})}return c.prototype.dispose=function(){this._programCache&&
(this._programCache.forEach(function(a){return a.dispose()}),this._programCache.clear())},c.prototype._initObject=function(a){this._initParams(a.programNamePrefix,a.shaderSnippetPrefixes,a.baseDefines,a.snippets,a.rctx,a.vertexAttribLocs)},c.prototype._initParams=function(a,b,d,e,c,f){this._defaultSnippets=e;this._defaultRctx=c;this._defaultVertexAttribLocs=f;this._programCache=new Map;this._variationInfo=new Map;this._shaderSourceVariator=new n(a,b,d)},c.prototype.addDefine=function(a,b,d,e){this._shaderSourceVariator.addDefine(a,
b,d,e)},c.prototype.addBinaryShaderSnippetSuffix=function(a,b,d){this._shaderSourceVariator.addBinaryShaderSnippetSuffix(a,b,d)},c.prototype.addNaryShaderSnippetSuffix=function(a,b){this._shaderSourceVariator.addNaryShaderSnippetSuffix(a,b)},c.prototype.getProgram=function(a,b,d,e){if(b=b||this._defaultSnippets,d=d||this._defaultRctx,e=e||this._defaultVertexAttribLocs,!b)throw Error("No ShaderSnippets provided to getProgram nor to ShaderVariations constructor.");if(!d)throw Error("No RenderingContext provided to getProgram nor to ShaderVariations constructor.");
if(!e)throw Error("No VertexAttributeLocations provided to getProgram nor to ShaderVariations constructor.");var c=m(a);if(this._programCache.has(c))return this._programCache.get(c);var f,g=this._shaderSourceVariator.getShaderVariation(a);a=g.shaderSnippetNames[0];f=b[a];h.assert(null!=f,"shader snippet '"+a+"' does not exist");a=g.shaderSnippetNames[1];b=b[a];h.assert(null!=b,"shader snippet '"+a+"' does not exist");d=new l(d,f,b,e,g.defines);return this._programCache.set(c,d),d},c.prototype.getProgramByKey=
function(a){if(this._programCache.has(a))return this._programCache.get(a);if(!this._variationInfo[a])return null;var b,d,c,k=this._variationInfo[a];c=this._defaultSnippets;var f=this._defaultRctx,g=this._defaultVertexAttribLocs;b=k.shaderSnippetNames[0];d=c[b];h.assert(null!=d,"shader snippet '"+b+"' does not exist");b=k.shaderSnippetNames[1];c=c[b];h.assert(null!=c,"shader snippet '"+b+"' does not exist");b=new l(f,d,c,g,k.defines);return this._programCache.set(a,b),b},c.prototype.getProgramInfo=
function(a){var b=this._shaderSourceVariator.getShaderVariation(a);a=m(a);return this._variationInfo[a]||(this._variationInfo[a]=b),{name:b.programName,key:a}},c}()});