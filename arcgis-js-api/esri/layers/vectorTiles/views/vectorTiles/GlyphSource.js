//>>built
define(["require","exports","../../request","../../core/pbf","../../core/promiseUtils"],function(t,u,n,p,q){var e=function(){function b(a){if(this._metrics=[],this._bitmaps=[],a)for(;a.next();)switch(a.tag()){case 1:for(var c=a.getMessage();c.next();)switch(c.tag()){case 3:for(var d=c.getMessage(),b=void 0,f=void 0,h=void 0,e=void 0,k=void 0,l=void 0,m=void 0;d.next();)switch(d.tag()){case 1:b=d.getUInt32();break;case 2:f=d.getBytes();break;case 3:h=d.getUInt32();break;case 4:e=d.getUInt32();break;
case 5:k=d.getSInt32();break;case 6:l=d.getSInt32();break;case 7:m=d.getUInt32();break;default:d.skip()}b&&(this._metrics[b]={width:h,height:e,left:k,top:l,advance:m},this._bitmaps[b]=f);break;default:c.skip()}break;default:a.skip()}}return b.prototype.getMetrics=function(a){return this._metrics[a]},b.prototype.getBitmap=function(a){return this._bitmaps[a]},b}(),r=function(){function b(){this._ranges=[]}return b.prototype.getRange=function(a){return this._ranges[a]},b.prototype.addRange=function(a,
c){this._ranges[a]=c},b}();return function(){function b(a){this._glyphInfo={};this._baseURL=a}return b.prototype.getRange=function(a,c){var b=this._getFontStack(a);if(b.getRange(c))return q.resolve();var g=256*c,f=g+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",g+"-"+f);return n(a,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){b.addRange(c,new e(new p(new Uint8Array(a.data),new DataView(a.data))))}).catch(function(){b.addRange(c,new e)})},b.prototype.getGlyph=
function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}},b.prototype._getFontStack=function(a){var b=this._glyphInfo[a];return b||(b=this._glyphInfo[a]=new r),b},b}()});