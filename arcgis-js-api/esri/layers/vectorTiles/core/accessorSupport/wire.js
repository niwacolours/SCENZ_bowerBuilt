//>>built
define(["require","exports","./utils"],function(q,g,e){function k(a,b,c){b=e.splitPath(b);if(Array.isArray(b)){for(var f=[],d=0;d<b.length;d++)f.push((new h(b[d],c)).install(a));return new l(f)}a=(new h(b,c)).install(a);return new m(a)}Object.defineProperty(g,"__esModule",{value:!0});var h=function(){function a(b,a){return this.path=b,this.callback=a,this.chain=null,this.path=b,-1<b.indexOf(".")&&(this.chain=e.pathToArray(b)),this.callback=a,this}return a.prototype.install=function(b){return this.chain?
new n(this,b):new p(this,b)},a.prototype.notify=function(b){this.callback(b,this.path)},a}(),p=function(){function a(b,a){this.binding=b;this.target=a;e.getProperties(a).addCursor(this.binding.path,this)}return a.prototype.destroy=function(){this.target&&(e.getProperties(this.target).removeCursor(this.binding.path,this),this.target=this.binding=null)},a.prototype.propertyDestroyed=function(b,a){e.getProperties(this.target).removeCursor(a,this)},a.prototype.propertyInvalidated=function(b,a){this.binding&&
this.binding.notify(this.target)},a.prototype.propertyCommitted=function(b,a){this.binding&&this.binding.notify(this.target)},a}(),n=function(){function a(b,a){return this.binding=b,this.target=a,this.stack=[],this.properties=e.getProperties(a),this.stack.push({properties:this.properties,propertyName:b.chain[0]}),this.properties.addCursor(b.chain[0],this),this.moveForward(),this}return a.prototype.destroy=function(){for(;;){var b=this.stack.pop();if(null==b)break;b.properties.removeCursor(b.propertyName,
this)}this.target=this.binding=null},a.prototype.propertyDestroyed=function(b,a){this.moveBackward(b,a)},a.prototype.propertyInvalidated=function(b,a){this.binding&&this.binding.notify(this.target)},a.prototype.propertyCommitted=function(b,a){this.binding&&(this.moveBackward(b,a),this.moveForward(),this.binding.notify(this.target))},a.prototype.moveBackward=function(b,a){for(var c=this.stack,d=c[c.length-1];d.properties!==b&&d.propertyName!==a;)d.properties.removeCursor(d.propertyName,this),c.pop(),
d=c[c.length-1]},a.prototype.moveForward=function(){var a=this.stack,c=a[a.length-1],c=c.properties.internalGet(c.propertyName);(c=e.getProperties(c))&&a.length<this.binding.chain.length&&(a=this.binding.chain[a.length],this.stack.push({properties:c,propertyName:a}),c.addCursor(a,this),this.moveForward())},a}(),l=function(){function a(a){this.cursors=a}return a.prototype.remove=function(){for(var a=this.cursors;0<a.length;)a.pop().destroy();this.cursors=null},a}(),m=function(){function a(a){this.cursor=
a}return a.prototype.remove=function(){this.cursor.destroy();this.cursor=null},a}();g.create=function(a,b){a=e.splitPath(a);if(Array.isArray(a)){for(var c=[],f=0;f<a.length;f++)c.push(new h(a[f],b));return function(a){for(var b=[],d=0;d<c.length;d++)b[d]=c[d].install(a);return new l(b)}}var d=new h(a,b);return function(a){return new m(d.install(a))}};g.wire=k;g.default=k});