//>>built
define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(p,b,c,q,r,h,e,t,u){function k(){if(g)return g;for(var b=l+m,d=[],c=0;c<b;c++)!function(b){var a=u.create(b).then(function(a){return f[b]=a,a});d.push(a)}(c);return g=q(d).then(function(){})}Object.defineProperty(b,"__esModule",{value:!0});b.Connection=e;b.RemoteClient=t;(e=c("host-browser")?navigator.hardwareConcurrency:0)||(e=c("safari")&&c("mac")||c("trident")?
8:2);var l=c("esri-workers-debug")?1:Math.max(1,Math.ceil(e/2)),m=c("esri-workers-debug")?1:Math.max(1,Math.floor(e/2)),v=r.getLogger("esri.core.workers"),n=0,f=[];b.initialize=function(){k()};b.open=function(a,d,c){if(void 0===d&&(d={}),Array.isArray(a))return new b.Connection(a.map(function(a){return new b.RemoteClient(a,d.client)}));"string"!=typeof a&&(v.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature."),a=d,d={client:a,strategy:c?"dedicated":"distributed"});
var e=d.strategy||"distributed";return"local"===e?h.create(function(c){p([a],function(a){c(b.RemoteClient.connect(a))})}).then(function(a){return new b.Connection([new b.RemoteClient(a,d.client)])}):k().then(function(){if("dedicated"===e){var c=l+n++;return n%=m,f[c].open(a).then(function(a){return new b.Connection([new b.RemoteClient(a,d.client)])})}return h.all(f.map(function(b){return b.open(a)})).then(function(a){return new b.Connection(a.map(function(a){return new b.RemoteClient(a,d.client)}))})})};
b.terminate=function(){for(var a=0;a<f.length;a++)f[a]&&f[a].terminate();f.length=0};var g});