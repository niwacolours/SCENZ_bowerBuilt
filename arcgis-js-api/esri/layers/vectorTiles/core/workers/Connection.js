//>>built
define(["require","exports","../promiseUtils"],function(k,l,e){return function(){function b(a){this._clientIdx=0;this._clients=a}return b.prototype.broadcast=function(a,g,b){for(var d=[],c=0,f=this._clients;c<f.length;c++)d.push(f[c].invoke(a,g,b));return d},b.prototype.close=function(){for(var a=0,b=this._clients;a<b.length;a++)b[a].close();this._clients=[]},b.prototype.invoke=function(a,b,h,d){var c=d&&d.client;if(!this._clients||!this._clients.length)return e.reject(Error("Connection closed"));
if(null==c||-1===this._clients.indexOf(c))this._clients.some(function(a){return!a.isBusy()&&(c=a,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);a=c.invoke(a,b,h);return d&&(d.client=c),a},b.prototype.openPorts=function(){return e.all(this._clients.map(function(a){return a.openPort()}))},b}()});